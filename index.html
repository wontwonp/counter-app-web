<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë¥˜ì¥ ì¹´ìš´í„°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .container {
            text-align: center;
            padding: 20px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        h2 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        h3 {
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        /* ì •ë¥˜ì¥ ê°œìˆ˜ ì…ë ¥ í˜ì´ì§€ */
        .station-count-input {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .number-input {
            font-size: 1.5rem;
            padding: 15px 20px;
            margin: 20px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            text-align: center;
            width: 200px;
        }

        .submit-btn {
            font-size: 1.2rem;
            padding: 15px 30px;
            margin: 20px;
            border: none;
            border-radius: 10px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        /* ì •ë¥˜ì¥ ì´ë¦„ ì…ë ¥ í˜ì´ì§€ */
        .station-names-input {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
        }

        .station-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .station-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .station-input-group label {
            min-width: 100px;
            text-align: left;
            font-size: 1.1rem;
        }

        .station-name-input {
            flex: 1;
            font-size: 1.1rem;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .button-group {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .start-btn, .reset-btn {
            font-size: 1.2rem;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-btn {
            background: #4CAF50;
            color: white;
        }

        .start-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }

        .start-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .reset-btn {
            background: #f44336;
            color: white;
        }

        .reset-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        /* í‚¤íŒ¨ë“œ í˜ì´ì§€ */
        .current-station {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .current-station h2 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .current-station p {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .clock-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: 'Courier New', monospace;
        }

        .clock-time {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
        }

        .clock-date {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .input-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .number-display {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .keypad {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .keypad-row {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .keypad-btn {
            width: 90px;
            height: 90px;
            font-size: 1.8rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.3);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .keypad-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .keypad-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px) scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .enter-btn {
            width: 285px;
            height: 90px;
            font-size: 1.8rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .enter-btn:hover {
            background: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .enter-btn:active {
            background: #3d8b40;
            transform: translateY(-1px) scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* ì •ë¥˜ì¥ ìš”ì•½ */
        .station-summary {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 400px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .summary-item {
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .summary-item.current {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
            font-weight: bold;
        }

        .reset-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .reset-counts-btn, .reset-app-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-previous-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #9C27B0;
        }

        .delete-previous-btn:hover {
            background: #7B1FA2;
            transform: translateY(-2px);
        }

        .reset-counts-btn {
            background: #ff9800;
        }

        .reset-counts-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .reset-app-btn {
            background: #f44336;
        }

        .reset-app-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .station-count-input, .station-names-input {
                padding: 20px;
            }
            
            .station-input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .station-input-group label {
                text-align: center;
                min-width: auto;
            }
            
            .keypad-btn {
                width: 70px;
                height: 70px;
                font-size: 1.4rem;
            }
            
            .enter-btn {
                width: 225px;
                height: 70px;
                font-size: 1.4rem;
            }
            
            .number-display {
                font-size: 1.8rem;
            }
        }

        .hidden {
            display: none;
        }

        /* ì €ì¥ëœ ë…¸ì„  ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .saved-route-item {
            position: relative;
            margin-bottom: 10px;
        }

        .saved-route-btn {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .saved-route-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .route-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .route-info {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .delete-route-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: none;
            background: #f44336;
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .delete-route-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .save-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .save-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        /* ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
        .theme-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 1.3rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        /* ë‹¤í¬ëª¨ë“œì—ì„œì˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ ì¡°ì • */
        body.dark-mode .station-count-input,
        body.dark-mode .station-names-input,
        body.dark-mode .current-station,
        body.dark-mode .clock-display,
        body.dark-mode .input-display,
        body.dark-mode .station-summary {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .keypad-btn {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.dark-mode .keypad-btn:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        /* ê³µìœ  ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .share-btn, .download-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-btn {
            background: #FEE500;
            color: #3C1E1E;
        }

        .share-btn:hover {
            background: #FFD700;
            transform: translateY(-2px);
        }

        /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .image-modal.show {
            display: flex;
        }

        .image-modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
        }

        .image-modal img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2rem;
            color: white;
            cursor: pointer;
        }

        /* ì‹œê°„ëŒ€ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .time-period-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .time-period-btn.active {
            background: #4CAF50;
            border: 2px solid #4CAF50;
            transform: translateY(-2px);
        }

        .time-period-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .time-period-btn.active:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">ğŸŒ™</button>
    <div class="container">
        <h1>ì •ë¥˜ì¥ ì¹´ìš´í„°</h1>
        
        <!-- ì •ë¥˜ì¥ ê°œìˆ˜ ì…ë ¥ í˜ì´ì§€ -->
        <div id="station-count-page">
            <!-- ì €ì¥ëœ ë…¸ì„  ëª©ë¡ -->
            <div class="station-count-input" style="margin-bottom: 20px;">
                <h2>ì €ì¥ëœ ë…¸ì„ </h2>
                <div id="saved-routes-container">
                    <p style="color: #999; text-align: center; margin: 10px 0;">ì €ì¥ëœ ë…¸ì„ ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
            
            <div class="station-count-input">
                <h2>ë…¸ì„  ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
                <div style="margin-bottom: 20px;">
                    <label for="route-name" style="display: block; margin-bottom: 10px; font-size: 1.1rem;">ë…¸ì„  ì´ë¦„:</label>
                    <input type="text" id="route-name" placeholder="ì˜ˆ: ëª…ì§€2 ë…¸ì„ " class="number-input" style="width: 300px;" lang="ko" ime-mode="active">
                </div>
                <h3>ì •ë¥˜ì¥ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h3>
                <input type="number" id="station-count" min="1" max="20" placeholder="ì •ë¥˜ì¥ ê°œìˆ˜" class="number-input" oninput="updateStationCount()">
                <button id="count-submit" class="submit-btn" onclick="submitStationCount()" disabled>í™•ì¸</button>
            </div>
        </div>

        <!-- ì •ë¥˜ì¥ ì´ë¦„ ì…ë ¥ í˜ì´ì§€ -->
        <div id="station-names-page" class="hidden">
            <div class="station-names-input">
                <h2>ì •ë¥˜ì¥ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</h2>
                <div id="station-inputs" class="station-inputs"></div>
                <div class="button-group">
                    <button id="start-counting" class="start-btn" onclick="startCounting()" disabled>ì¹´ìš´íŒ… ì‹œì‘</button>
                    <button id="save-route" class="save-btn" onclick="saveRoute()" disabled>ë…¸ì„  ì €ì¥</button>
                    <button id="reset-setup" class="reset-btn" onclick="resetSetup()">ë‹¤ì‹œ ì„¤ì •</button>
                </div>
            </div>
        </div>

        <!-- í‚¤íŒ¨ë“œ í˜ì´ì§€ -->
        <div id="keypad-page" class="hidden">
            <div class="current-station">
                <h2 id="current-station-name">í˜„ì¬ ì •ë¥˜ì¥: </h2>
                <p id="current-station-count">ì´ íƒ‘ìŠ¹ììˆ˜: 0</p>
            </div>

            <!-- ì‹œê°„ëŒ€ í† ê¸€ ë²„íŠ¼ -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button id="morning-btn-keypad" class="time-period-btn active" onclick="selectTimePeriod('morning')">ì˜¤ì „ ìš´í–‰</button>
                    <button id="afternoon-btn-keypad" class="time-period-btn" onclick="selectTimePeriod('afternoon')">ì˜¤í›„ ìš´í–‰</button>
                </div>
            </div>

            <div class="clock-display">
                <div id="clock-time" class="clock-time">00:00:00</div>
                <div id="clock-date" class="clock-date">2024ë…„ 1ì›” 1ì¼ ì›”ìš”ì¼</div>
            </div>

            <div class="input-display">
                <div id="number-display" class="number-display">0</div>
            </div>

            <div class="keypad">
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="inputDigit('1')">1</button>
                    <button class="keypad-btn" onclick="inputDigit('2')">2</button>
                    <button class="keypad-btn" onclick="inputDigit('3')">3</button>
                </div>
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="inputDigit('4')">4</button>
                    <button class="keypad-btn" onclick="inputDigit('5')">5</button>
                    <button class="keypad-btn" onclick="inputDigit('6')">6</button>
                </div>
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="inputDigit('7')">7</button>
                    <button class="keypad-btn" onclick="inputDigit('8')">8</button>
                    <button class="keypad-btn" onclick="inputDigit('9')">9</button>
                </div>
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="clearInput()">C</button>
                    <button class="keypad-btn" onclick="inputDigit('0')">0</button>
                    <button class="keypad-btn" onclick="backspace()">âŒ«</button>
                </div>
                <div class="keypad-row">
                    <button class="enter-btn" onclick="enterNumber()">ENTER</button>
                </div>
            </div>

            <div class="station-summary">
                <h3>ì •ë¥˜ì¥ë³„ ì¹´ìš´íŠ¸</h3>
                <div id="summary-list" class="summary-list"></div>
            </div>

            <div class="reset-buttons">
                <button onclick="deletePreviousStation()" class="delete-previous-btn">ì§ì „ ì •ë¥˜ì¥ ì‚­ì œ</button>
                <button onclick="resetCounts()" class="reset-counts-btn">ì •ë¥˜ì¥ ëª…ìˆ˜ ì´ˆê¸°í™”</button>
                <button onclick="resetApp()" class="reset-app-btn">ì²˜ìŒìœ¼ë¡œ</button>
            </div>

            <div class="share-buttons">
                <button onclick="generateAndShareImage()" class="share-btn" id="kakao-share-btn">
                    ğŸ“± ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
                </button>
            </div>
        </div>
    </div>

    <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
    <div id="image-modal" class="image-modal">
        <button class="modal-close" onclick="closeImageModal()">&times;</button>
        <div class="image-modal-content">
            <img id="generated-image" src="" alt="ìƒì„±ëœ ì´ë¯¸ì§€">
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let stations = [];
        let stationNames = [];
        let currentStationIndex = 0;
        let currentInput = '';
        let stationCount = 0;
        let isDarkMode = false;
        let routeName = '';
        let stationDepartureTimes = [];
        let selectedTimePeriod = 'morning'; // 'morning' ë˜ëŠ” 'afternoon'

        // ë‹¤í¬ëª¨ë“œ í† ê¸€ í•¨ìˆ˜
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            
            if (isDarkMode) {
                body.classList.add('dark-mode');
                themeToggle.textContent = 'â˜€ï¸';
                localStorage.setItem('darkMode', 'true');
            } else {
                body.classList.remove('dark-mode');
                themeToggle.textContent = 'ğŸŒ™';
                localStorage.setItem('darkMode', 'false');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í…Œë§ˆ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadTheme() {
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'true') {
                isDarkMode = true;
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }
        }

        // ì •ë¥˜ì¥ ê°œìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStationCount() {
            stationCount = parseInt(document.getElementById('station-count').value) || 0;
            routeName = document.getElementById('route-name').value.trim();
            document.getElementById('count-submit').disabled = stationCount <= 0 || routeName === '';
        }

        // ë‚ ì§œ ë³€ê²½ í™•ì¸ ë° ì™„ì „ ì´ˆê¸°í™”
        function checkDateChangeAndReset() {
            const now = new Date();
            const currentDate = now.toDateString(); // "Mon Jan 01 2024" í˜•ì‹
            const savedDate = localStorage.getItem('lastResetDate');
            
            if (savedDate && savedDate !== currentDate) {
                console.log(`ë‚ ì§œ ë³€ê²½ ê°ì§€: ${savedDate} â†’ ${currentDate}`);
                console.log('24ì‹œê°€ ì§€ë‚˜ ì™„ì „ ì´ˆê¸°í™”ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.');
                
                // ì™„ì „ ì´ˆê¸°í™” ì‹¤í–‰
                completeReset();
                
                // ìƒˆë¡œìš´ ë‚ ì§œ ì €ì¥
                localStorage.setItem('lastResetDate', currentDate);
            } else if (!savedDate) {
                // ì²˜ìŒ ì‹¤í–‰í•˜ëŠ” ê²½ìš° í˜„ì¬ ë‚ ì§œ ì €ì¥
                localStorage.setItem('lastResetDate', currentDate);
            }
        }

        // ì™„ì „ ì´ˆê¸°í™” í•¨ìˆ˜
        function completeReset() {
            if (stations && stations.length > 0) {
                stations.forEach(station => {
                    station.count = 0;
                    station.morningCount = 0;
                    station.afternoonCount = 0;
                });
                currentStationIndex = 0;
                currentInput = '';
                enableKeypad();
                updateKeypadPage();
                localStorage.setItem('savedStations', JSON.stringify(stations));
                console.log('24ì‹œ ê²½ê³¼ë¡œ ì¸í•œ ì™„ì „ ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜„ì¬ ì‹œê°„ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì‹œê°„ëŒ€ ì„ íƒ
        function autoSelectTimePeriod() {
            // ë¨¼ì € ë‚ ì§œ ë³€ê²½ í™•ì¸
            checkDateChangeAndReset();
            
            const now = new Date();
            const currentHour = now.getHours();
            
            // ì˜¤ì „: 6ì‹œ~12ì‹œ, ì˜¤í›„: 13ì‹œ~22ì‹œ
            if (currentHour >= 6 && currentHour < 12) {
                selectedTimePeriod = 'morning';
            } else if (currentHour >= 13 && currentHour < 22) {
                selectedTimePeriod = 'afternoon';
            } else {
                // ìƒˆë²½ì´ë‚˜ ë°¤ ì‹œê°„ëŒ€ëŠ” ì˜¤ì „ìœ¼ë¡œ ê¸°ë³¸ ì„¤ì •
                selectedTimePeriod = 'morning';
            }
            
            console.log(`í˜„ì¬ ì‹œê°„: ${currentHour}ì‹œ, ìë™ ì„ íƒëœ ì‹œê°„ëŒ€: ${selectedTimePeriod}`);
            
            // ë²„íŠ¼ ì—…ë°ì´íŠ¸
            updateTimePeriodButtons();
            
            // localStorageì— ì €ì¥
            localStorage.setItem('selectedTimePeriod', selectedTimePeriod);
        }

        // ì‹œê°„ëŒ€ ì„ íƒ í•¨ìˆ˜ (ìˆ˜ë™ ì„ íƒìš©)
        function selectTimePeriod(period) {
            // ë‚ ì§œ ë³€ê²½ í™•ì¸
            checkDateChangeAndReset();
            
            const previousPeriod = selectedTimePeriod;
            selectedTimePeriod = period;
            updateTimePeriodButtons();
            
            // í‚¤íŒ¨ë“œ í˜ì´ì§€ ì—…ë°ì´íŠ¸ (ì‹œê°„ í‘œì‹œ ë³€ê²½)
            if (!document.getElementById('keypad-page').classList.contains('hidden')) {
                // ì˜¤ì „ì—ì„œ ì˜¤í›„ë¡œ ì „í™˜í•˜ê±°ë‚˜ ì˜¤í›„ì—ì„œ ì˜¤ì „ìœ¼ë¡œ ì „í™˜í•  ë•Œ í‚¤íŒ¨ë“œ ì¬í™œì„±í™” ë° ì²« ë²ˆì§¸ ì •ë¥˜ì¥ìœ¼ë¡œ ì´ë™
                if (previousPeriod !== period) {
                    enableKeypad();
                    currentStationIndex = 0; // ì²« ë²ˆì§¸ ì •ë¥˜ì¥ë¶€í„° ì‹œì‘
                    currentInput = ''; // ì…ë ¥ ì´ˆê¸°í™”
                    console.log(`${previousPeriod}ì—ì„œ ${period}ë¡œ ì „í™˜ - í‚¤íŒ¨ë“œ ì¬í™œì„±í™”, ì²« ë²ˆì§¸ ì •ë¥˜ì¥ìœ¼ë¡œ ì´ë™`);
                }
                
                updateKeypadPage();
            }
            
            // localStorageì— ì €ì¥
            localStorage.setItem('selectedTimePeriod', period);
        }

        // ì‹œê°„ëŒ€ ë²„íŠ¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateTimePeriodButtons() {
            // í‚¤íŒ¨ë“œ í™”ë©´ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const morningBtnKeypad = document.getElementById('morning-btn-keypad');
            const afternoonBtnKeypad = document.getElementById('afternoon-btn-keypad');
            if (morningBtnKeypad && afternoonBtnKeypad) {
                morningBtnKeypad.classList.remove('active');
                afternoonBtnKeypad.classList.remove('active');
                
                if (selectedTimePeriod === 'morning') {
                    morningBtnKeypad.classList.add('active');
                } else {
                    afternoonBtnKeypad.classList.add('active');
                }
            }
        }

        // ì •ë¥˜ì¥ ê°œìˆ˜ ì œì¶œ í•¨ìˆ˜
        function submitStationCount() {
            stationCount = parseInt(document.getElementById('station-count').value) || 0;
            routeName = document.getElementById('route-name').value.trim();
            
            if (routeName === '') {
                return;
            }
            
            if (stationCount > 0) {
                // ì €ì¥ëœ ì •ë¥˜ì¥ ì´ë¦„ ë¶ˆëŸ¬ì˜¤ê¸°
                const savedStations = JSON.parse(localStorage.getItem('savedStations') || '[]');
                const savedDepartureTimes = JSON.parse(localStorage.getItem('savedDepartureTimes') || '[]');
                
                stations = Array.from({ length: stationCount }, (_, index) => ({
                    id: index,
                    name: savedStations[index] || '',
                    count: 0,
                    morningCount: 0,
                    afternoonCount: 0,
                    departureTime: savedDepartureTimes[index] || { 
                        morningHour: 8, 
                        afternoonHour: 17, 
                        minute: Math.min(index * 5, 59) 
                    }
                }));
                stationNames = new Array(stationCount).fill('');
                stationDepartureTimes = new Array(stationCount).fill({ hour: 8, minute: 0, ampm: 'AM' });
                createStationInputs();
                document.getElementById('station-count-page').classList.add('hidden');
                document.getElementById('station-names-page').classList.remove('hidden');
            }
        }

        // ì •ë¥˜ì¥ ì´ë¦„ ì…ë ¥ í•„ë“œ ìƒì„±
        function createStationInputs() {
            const stationInputs = document.getElementById('station-inputs');
            stationInputs.innerHTML = '';
            stations.forEach((station, index) => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'station-input-group';
                inputGroup.style.flexDirection = 'column';
                inputGroup.style.alignItems = 'stretch';
                inputGroup.style.gap = '10px';
                inputGroup.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">ì •ë¥˜ì¥ ${index + 1}:</label>
                        <input type="text" class="station-name-input" placeholder="ì •ë¥˜ì¥ ${index + 1} ì´ë¦„" 
                               value="${station.name}" onchange="updateStationName(${index}, this.value)" lang="ko" ime-mode="active">
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">ì˜¤ì „ì‹œê°„:</label>
                        <input type="number" min="1" max="12" placeholder="ì‹œ" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.morningHour || 8}" onchange="updateDepartureTime(${index}, 'morningHour', this.value)">
                        <span style="color: white;">ì‹œ</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">ì˜¤í›„ì‹œê°„:</label>
                        <input type="number" min="1" max="12" placeholder="ì‹œ" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.afternoonHour || 5}" onchange="updateDepartureTime(${index}, 'afternoonHour', this.value)">
                        <span style="color: white;">ì‹œ</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">ë¶„:</label>
                        <input type="number" min="0" max="59" placeholder="ë¶„" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.minute || 0}" onchange="updateDepartureTime(${index}, 'minute', this.value)">
                        <span style="color: white;">ë¶„</span>
                    </div>
                `;
                stationInputs.appendChild(inputGroup);
            });
        }

        // ì •ë¥˜ì¥ ì´ë¦„ ì—…ë°ì´íŠ¸
        function updateStationName(index, name) {
            stationNames[index] = name;
            stations[index].name = name;
            
            // ì •ë¥˜ì¥ ì´ë¦„ì„ localStorageì— ì €ì¥
            const savedStations = stations.map(station => station.name);
            localStorage.setItem('savedStations', JSON.stringify(savedStations));
            
            checkAllNamesFilled();
        }

        // ì¶œë°œ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateDepartureTime(index, type, value) {
            if (!stations[index].departureTime) {
                stations[index].departureTime = { morningHour: 8, afternoonHour: 5, minute: 0 };
            }
            
            if (type === 'morningHour') {
                stations[index].departureTime.morningHour = parseInt(value) || 8;
            } else if (type === 'afternoonHour') {
                stations[index].departureTime.afternoonHour = parseInt(value) || 5;
            } else if (type === 'minute') {
                stations[index].departureTime.minute = parseInt(value) || 0;
            }
            
            // ì¶œë°œ ì‹œê°„ì„ localStorageì— ì €ì¥
            const savedDepartureTimes = stations.map(station => station.departureTime);
            localStorage.setItem('savedDepartureTimes', JSON.stringify(savedDepartureTimes));
        }

        // ëª¨ë“  ì •ë¥˜ì¥ ì´ë¦„ì´ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
        function checkAllNamesFilled() {
            const allFilled = stations.every(station => station.name.trim() !== '');
            document.getElementById('start-counting').disabled = !allFilled;
            document.getElementById('save-route').disabled = !allFilled;
        }

        // ì¹´ìš´íŒ… ì‹œì‘
        function startCounting() {
            if (stations.every(station => station.name.trim() !== '')) {
                // ì •ë¥˜ì¥ ê°œìˆ˜ì™€ ë…¸ì„ ì´ë¦„ì„ localStorageì— ì €ì¥
                localStorage.setItem('savedStationCount', stationCount.toString());
                localStorage.setItem('savedRouteName', routeName);
                
                currentStationIndex = 0;
                updateKeypadPage();
                document.getElementById('station-names-page').classList.add('hidden');
                document.getElementById('keypad-page').classList.remove('hidden');
                
                // ì‹œê³„ ì‹œì‘
                updateClock();
                setInterval(updateClock, 1000);
            }
        }

        // ë‹¤ì‹œ ì„¤ì •
        function resetSetup() {
            stationCount = 0;
            stations = [];
            stationNames = [];
            document.getElementById('station-count').value = '';
            document.getElementById('count-submit').disabled = true;
            document.getElementById('station-names-page').classList.add('hidden');
            document.getElementById('station-count-page').classList.remove('hidden');
        }

        // ì‹œê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            const weekdays = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
            const weekday = weekdays[now.getDay()];
            
            document.getElementById('clock-time').textContent = `${hours}:${minutes}:${seconds}`;
            document.getElementById('clock-date').textContent = `${year}ë…„ ${month}ì›” ${day}ì¼ ${weekday}`;
        }

        // í‚¤íŒ¨ë“œ í˜ì´ì§€ ì—…ë°ì´íŠ¸
        function updateKeypadPage() {
            // ì„ íƒëœ ì‹œê°„ëŒ€ì— ë”°ë¥¸ ì´ ì¹´ìš´íŠ¸ ê³„ì‚°
            const totalCount = selectedTimePeriod === 'morning' ? 
                stations.reduce((sum, station) => sum + (station.morningCount || 0), 0) :
                stations.reduce((sum, station) => sum + (station.afternoonCount || 0), 0);
            
            const currentStation = stations[currentStationIndex];
            
            // í˜„ì¬ ì •ë¥˜ì¥ ì´ë¦„ê³¼ ìš´í–‰ ì‹œê°„ í‘œì‹œ
            let timeDisplay = '';
            if (currentStation && currentStation.departureTime) {
                const hour = selectedTimePeriod === 'morning' ? 
                    (currentStation.departureTime.morningHour || 8) : 
                    (currentStation.departureTime.afternoonHour || 17);
                const minute = currentStation.departureTime.minute || 0;
                const timeStr = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                timeDisplay = ` (${timeStr})`;
            }
            
            document.getElementById('current-station-name').textContent = `${currentStation.name}${timeDisplay}`;
            document.getElementById('current-station-count').textContent = `ì´ íƒ‘ìŠ¹ììˆ˜: ${totalCount}`;
            updateSummary();
        }

        // ìš”ì•½ ì—…ë°ì´íŠ¸ (ì˜¤ì „/ì˜¤í›„ ì¹´ìš´íŠ¸ ë¶„ë¦¬ í‘œì‹œ)
        function updateSummary() {
            const summaryList = document.getElementById('summary-list');
            summaryList.innerHTML = '';
            stations.forEach((station, index) => {
                const summaryItem = document.createElement('div');
                summaryItem.className = `summary-item ${index === currentStationIndex ? 'current' : ''}`;
                
                // ì˜¤ì „/ì˜¤í›„ ì¹´ìš´íŠ¸ë¥¼ ë¶„ë¦¬í•˜ì—¬ í‘œì‹œ
                const morningCount = station.morningCount || 0;
                const afternoonCount = station.afternoonCount || 0;
                summaryItem.textContent = `${index + 1}. ${station.name}: ì˜¤ì „ ${morningCount}ëª…, ì˜¤í›„ ${afternoonCount}ëª…`;
                
                summaryList.appendChild(summaryItem);
            });
        }

        // í–…í‹± í”¼ë“œë°± í•¨ìˆ˜ (ì§„ë™ + ì‹œê°ì  í”¼ë“œë°±)
        function hapticFeedback(pattern = 50) {
            // ì§„ë™ ì‹œë„
            if (navigator.vibrate) {
                try {
                    navigator.vibrate(pattern);
                    console.log('ì§„ë™ ì‹¤í–‰ë¨:', pattern + 'ms');
                } catch (e) {
                    console.log('ì§„ë™ ì‹¤í–‰ ì‹¤íŒ¨:', e);
                }
            } else {
                console.log('ì´ ê¸°ê¸°ëŠ” ì§„ë™ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
            }
            
            // iOS Safari/PWAì—ì„œ ì§„ë™ì´ ì•ˆ ë  ë•Œ ì‹œê°ì  í”¼ë“œë°±
            if (window.navigator && window.navigator.userAgent.includes('iPhone')) {
                // í™”ë©´ ì „ì²´ì— ì§§ì€ í”Œë˜ì‹œ íš¨ê³¼
                document.body.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                setTimeout(() => {
                    document.body.style.backgroundColor = '';
                }, 100);
            }
        }

        // ìˆ«ì ì…ë ¥
        function inputDigit(digit) {
            // í–…í‹± í”¼ë“œë°±
            hapticFeedback(50);
            
            currentInput += digit;
            document.getElementById('number-display').textContent = currentInput || '0';
        }

        // ì…ë ¥ ì´ˆê¸°í™”
        function clearInput() {
            // í–…í‹± í”¼ë“œë°±
            hapticFeedback(30);
            
            currentInput = '';
            document.getElementById('number-display').textContent = '0';
        }

        // ë°±ìŠ¤í˜ì´ìŠ¤
        function backspace() {
            // í–…í‹± í”¼ë“œë°±
            hapticFeedback(30);
            
            currentInput = currentInput.slice(0, -1);
            document.getElementById('number-display').textContent = currentInput || '0';
        }

        // ì—”í„° (ìˆ«ì ì…ë ¥ ì™„ë£Œ)
        function enterNumber() {
            // í–…í‹± í”¼ë“œë°± (ë” ê°•í•œ ì§„ë™)
            hapticFeedback([50, 30, 50]);
            
            if (currentStationIndex < stations.length) {
                // ì…ë ¥ëœ ìˆ«ìê°€ ìˆìœ¼ë©´ ê·¸ ê°’ì„, ì—†ìœ¼ë©´ 0ì„ ì¶”ê°€
                const inputValue = currentInput ? parseInt(currentInput) : 0;
                
                // ì„ íƒëœ ì‹œê°„ëŒ€ì— ë”°ë¼ ì¹´ìš´íŠ¸ ì €ì¥
                if (selectedTimePeriod === 'morning') {
                    stations[currentStationIndex].morningCount += inputValue;
                } else {
                    stations[currentStationIndex].afternoonCount += inputValue;
                }
                
                // ê¸°ì¡´ countë„ ì—…ë°ì´íŠ¸ (í˜¸í™˜ì„±)
                stations[currentStationIndex].count += inputValue;
                
                currentInput = '';
                document.getElementById('number-display').textContent = '0';
                
                // ë§ˆì§€ë§‰ ì •ë¥˜ì¥ì—ì„œ ë¨¸ë¬¼ë„ë¡ ìˆ˜ì •
                if (currentStationIndex < stations.length - 1) {
                    currentStationIndex++;
                } else {
                    // ë§ˆì§€ë§‰ ì •ë¥˜ì¥ì—ì„œëŠ” ì…ë ¥ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ (í•˜ì§€ë§Œ ì‹œê°„ëŒ€ ì „í™˜ ì‹œ ì¬í™œì„±í™” ê°€ëŠ¥)
                    disableKeypad();
                }
                
                updateKeypadPage();
                
                // localStorageì— ì €ì¥ (ì˜¤ë¥˜ ì²˜ë¦¬ í¬í•¨)
                saveToLocalStorage('savedStations', JSON.stringify(stations));
            }
        }

        // í‚¤íŒ¨ë“œ ë¹„í™œì„±í™” í•¨ìˆ˜
        function disableKeypad() {
            const keypadButtons = document.querySelectorAll('.keypad-btn, .enter-btn');
            keypadButtons.forEach(button => {
                button.disabled = true;
                button.style.opacity = '0.5';
                button.style.cursor = 'not-allowed';
            });
            
            // ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
            const inputDisplay = document.getElementById('number-display');
            inputDisplay.textContent = 'ì™„ë£Œ';
            inputDisplay.style.color = '#4CAF50';
            inputDisplay.style.fontSize = '2rem';
            
            // í‚¤íŒ¨ë“œ ë¹„í™œì„±í™” ìƒíƒœ ì €ì¥
            saveToLocalStorage('keypadDisabled', 'true');
        }

        // í‚¤íŒ¨ë“œ í™œì„±í™” í•¨ìˆ˜
        function enableKeypad() {
            const keypadButtons = document.querySelectorAll('.keypad-btn, .enter-btn');
            keypadButtons.forEach(button => {
                button.disabled = false;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
            });
            
            // ì…ë ¥ í‘œì‹œ ë³µì›
            const inputDisplay = document.getElementById('number-display');
            inputDisplay.textContent = '0';
            inputDisplay.style.color = '#fff';
            inputDisplay.style.fontSize = '3rem';
            
            // í‚¤íŒ¨ë“œ í™œì„±í™” ìƒíƒœ ì €ì¥
            saveToLocalStorage('keypadDisabled', 'false');
        }

        // ì •ë¥˜ì¥ ëª…ìˆ˜ë§Œ ì´ˆê¸°í™” (ìˆ˜ë™ ì´ˆê¸°í™”: ì˜¤ì „/ì˜¤í›„ ëª¨ë‘ ì´ˆê¸°í™”)
        function resetCounts() {
            if (confirm('ì •ë¥˜ì¥ë³„ ì¹´ìš´íŠ¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì˜¤ì „/ì˜¤í›„ ëª¨ë“  ì¹´ìš´íŒ…ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤)')) {
                stations.forEach(station => {
                    station.count = 0;
                    station.morningCount = 0;
                    station.afternoonCount = 0;
                });
                currentStationIndex = 0;
                currentInput = '';
                enableKeypad(); // í‚¤íŒ¨ë“œ ë‹¤ì‹œ í™œì„±í™”
                updateKeypadPage();
                localStorage.setItem('savedStations', JSON.stringify(stations));
                
                console.log('ìˆ˜ë™ ì´ˆê¸°í™”: ì˜¤ì „/ì˜¤í›„ ëª¨ë“  ì¹´ìš´íŒ…ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì•± ì´ˆê¸°í™”
        function resetApp() {
            stationCount = 0;
            stations = [];
            stationNames = [];
            currentStationIndex = 0;
            currentInput = '';
            
            // ì €ì¥ëœ ì •ë¥˜ì¥ ì´ë¦„ê³¼ ê°œìˆ˜ ì‚­ì œ
            localStorage.removeItem('savedStations');
            localStorage.removeItem('savedStationCount');
            
            document.getElementById('station-count').value = '';
            document.getElementById('count-submit').disabled = true;
            
            document.getElementById('keypad-page').classList.add('hidden');
            document.getElementById('station-names-page').classList.add('hidden');
            document.getElementById('station-count-page').classList.remove('hidden');
        }

        // ì§ì „ ì •ë¥˜ì¥ ì‚­ì œ í•¨ìˆ˜
        function deletePreviousStation() {
            // ì™„ë£Œ ìƒíƒœ í™•ì¸: ë§ˆì§€ë§‰ ì •ë¥˜ì¥ì— ìˆê³  í‚¤íŒ¨ë“œê°€ ë¹„í™œì„±í™”ëœ ê²½ìš°
            const isCompleted = (currentStationIndex === stations.length - 1);
            const enterBtn = document.querySelector('.enter-btn');
            const isKeypadDisabled = enterBtn && enterBtn.disabled;
            
            if (isCompleted && isKeypadDisabled) {
                alert('ëª¨ë“  ì •ë¥˜ì¥ ì¹´ìš´íŒ…ì´ ì™„ë£Œëœ ìƒíƒœì—ì„œëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (currentStationIndex === 0) {
                alert('ì²« ë²ˆì§¸ ì •ë¥˜ì¥ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì§ì „ ì •ë¥˜ì¥ì˜ ì¹´ìš´íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì§ì „ ì •ë¥˜ì¥ì˜ ëª¨ë“  ì¹´ìš´íŠ¸ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”
                stations[currentStationIndex - 1].count = 0;
                stations[currentStationIndex - 1].morningCount = 0;
                stations[currentStationIndex - 1].afternoonCount = 0;
                
                // í˜„ì¬ ì •ë¥˜ì¥ì„ ì§ì „ ì •ë¥˜ì¥ìœ¼ë¡œ ì´ë™
                currentStationIndex--;
                
                // localStorageì— ì €ì¥
                saveToLocalStorage('savedStations', JSON.stringify(stations));
                
                // í‚¤íŒ¨ë“œ í˜ì´ì§€ ì—…ë°ì´íŠ¸
                updateKeypadPage();
                
                console.log('ì§ì „ ì •ë¥˜ì¥ ì¹´ìš´íŠ¸ ì‚­ì œ ì™„ë£Œ');
            }
        }


        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', function(event) {
            if (document.getElementById('keypad-page').classList.contains('hidden')) return;
            
            // í‚¤íŒ¨ë“œê°€ ë¹„í™œì„±í™”ëœ ìƒíƒœì—ì„œëŠ” í‚¤ë³´ë“œ ì…ë ¥ ë¬´ì‹œ
            const enterBtn = document.querySelector('.enter-btn');
            if (enterBtn && enterBtn.disabled) return;
            
            if (event.key >= '0' && event.key <= '9') {
                inputDigit(event.key);
            } else if (event.key === 'Enter') {
                enterNumber();
            } else if (event.key === 'Escape') {
                clearInput();
            } else if (event.key === 'Backspace') {
                backspace();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            loadTheme();
            loadSavedTimePeriod();
            loadSavedStations();
            setKoreanInputMode();
            
            // ê³µìœ  ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const kakaoShareBtn = document.getElementById('kakao-share-btn');
            if (kakaoShareBtn) {
                kakaoShareBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë²„íŠ¼ í´ë¦­ë¨');
                    generateAndShareImage();
                });
            }
        });

        // í•œê¸€ ì…ë ¥ ëª¨ë“œ ìë™ ì„¤ì •
        function setKoreanInputMode() {
            // ëª¨ë“  í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì— í•œê¸€ ì…ë ¥ ëª¨ë“œ ì„¤ì •
            const textInputs = document.querySelectorAll('input[type="text"]');
            textInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    // í•œê¸€ ì…ë ¥ ëª¨ë“œ í™œì„±í™”
                    this.setAttribute('lang', 'ko');
                    this.style.imeMode = 'active';
                });
            });
        }

        // ì˜¤í›„ ë§ˆì§€ë§‰ ì •ë¥˜ì¥ ì¶œë°œì‹œê°„ 50ë¶„ í›„ ì´ˆê¸°í™” ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        function checkAfternoonResetAvailability() {
            if (stations.length === 0) return false;
            
            const lastStation = stations[stations.length - 1];
            const afternoonHour = lastStation.departureTime?.afternoonHour || 17;
            const afternoonMinute = lastStation.departureTime?.minute || 0;
            
            // ì˜¤í›„ ë§ˆì§€ë§‰ ì •ë¥˜ì¥ ì¶œë°œì‹œê°„ + 50ë¶„
            const resetTime = new Date();
            resetTime.setHours(afternoonHour, afternoonMinute + 50, 0, 0);
            
            const now = new Date();
            const canReset = now >= resetTime;
            
            console.log(`ì˜¤í›„ ë§ˆì§€ë§‰ ì •ë¥˜ì¥ ì¶œë°œì‹œê°„: ${afternoonHour}:${String(afternoonMinute).padStart(2, '0')}`);
            console.log(`ì´ˆê¸°í™” ê°€ëŠ¥ ì‹œê°„: ${resetTime.getHours()}:${String(resetTime.getMinutes()).padStart(2, '0')}`);
            console.log(`í˜„ì¬ ì‹œê°„: ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`);
            console.log(`ì´ˆê¸°í™” ê°€ëŠ¥: ${canReset}`);
            
            return canReset;
        }

        // ì €ì¥ëœ ì‹œê°„ëŒ€ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSavedTimePeriod() {
            // ìë™ ì‹œê°„ëŒ€ ì„ íƒ ë¨¼ì € ì‹¤í–‰
            autoSelectTimePeriod();
            
            // ì €ì¥ëœ ì„¤ì •ì´ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸° (ìˆ˜ë™ ì„ íƒ ìš°ì„ )
            const savedPeriod = localStorage.getItem('selectedTimePeriod');
            if (savedPeriod) {
                selectedTimePeriod = savedPeriod;
                updateTimePeriodButtons();
            }
        }

        // ì €ì¥ëœ ì •ë¥˜ì¥ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSavedStations() {
            const savedStations = JSON.parse(loadFromLocalStorage('savedStations') || '[]');
            const savedStationCount = loadFromLocalStorage('savedStationCount');
            const savedDepartureTimes = JSON.parse(loadFromLocalStorage('savedDepartureTimes') || '[]');
            const savedRouteName = loadFromLocalStorage('savedRouteName');
            
            console.log('ë¡œë“œëœ ë°ì´í„°:', {
                savedStations: savedStations.length,
                savedStationCount,
                savedRouteName,
                savedDepartureTimes: savedDepartureTimes.length
            });
            
            if (savedStationCount && savedStations.length > 0) {
                // ì €ì¥ëœ ì •ë¥˜ì¥ ê°œìˆ˜ì™€ ì´ë¦„ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ í‚¤íŒ¨ë“œ í˜ì´ì§€ë¡œ ì´ë™
                stationCount = parseInt(savedStationCount);
                routeName = savedRouteName || '';
                
                console.log('ì„¤ì •ëœ routeName:', routeName);
                
                stations = Array.from({ length: stationCount }, (_, index) => {
                    const savedStation = savedStations[index];
                    const stationName = typeof savedStation === 'string' ? savedStation : (savedStation?.name || '');
                    
                    return {
                        id: index,
                        name: stationName,
                        count: savedStation?.count || 0, // ì €ì¥ëœ ì¹´ìš´íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
                        morningCount: savedStation?.morningCount || 0, // ì €ì¥ëœ ì˜¤ì „ ì¹´ìš´íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
                        afternoonCount: savedStation?.afternoonCount || 0, // ì €ì¥ëœ ì˜¤í›„ ì¹´ìš´íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
                        departureTime: savedDepartureTimes[index] || { 
                            morningHour: 8, 
                            afternoonHour: 17, 
                            minute: Math.min(index * 5, 59) 
                        }
                    };
                });
                
                // í‚¤íŒ¨ë“œ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™
                document.getElementById('station-count-page').classList.add('hidden');
                document.getElementById('station-names-page').classList.add('hidden');
                document.getElementById('keypad-page').classList.remove('hidden');
                
                // ì‹œê³„ ì‹œì‘
                updateClock();
                setInterval(updateClock, 1000);
                
                updateKeypadPage();
            }
        }

        // ì´ë¯¸ì§€ ìƒì„± ë° ê³µìœ  ê¸°ëŠ¥
        let generatedImageDataUrl = null;

        // ì´ë¯¸ì§€ ìƒì„± í•¨ìˆ˜ (ìƒ˜í”Œ ì´ë¯¸ì§€ì™€ ë™ì¼í•œ êµ¬ì¡°)
        function generateResultImage() {
            console.log('ì´ë¯¸ì§€ ìƒì„± ì‹œì‘, routeName:', routeName);
            console.log('í˜„ì¬ ì„ íƒëœ ì‹œê°„ëŒ€:', selectedTimePeriod);
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì • (ë©”ì¸ í—¤ë” ì œê±°ë¡œ ë†’ì´ ê°ì†Œ)
            canvas.width = 1300;
            canvas.height = 350 + (stations.length * 40); // ë©”ì¸ í—¤ë” ë†’ì´ë§Œí¼ ê°ì†Œ
            
            // ë°°ê²½ìƒ‰ ì„¤ì •
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // í…Œì´ë¸” ì„¤ì •
            const tableX = 50;
            const tableY = 50;
            const tableWidth = 1000; // 5ê°œ ì»¬ëŸ¼ ë„ˆë¹„ í•©ê³„: 700 + 100 + 100 + 100 + 100 = 1000
            const rowHeight = 40;
            
            // ì»¬ëŸ¼ ë„ˆë¹„ ì„¤ì • (5ê°œ ì»¬ëŸ¼)
            const colWidths = [700, 100, 100, 100, 100]; // ë…¸ì„ ëª…, ì˜¤ì „ì¶œë°œì‹œê°„, ì˜¤ì „ìŠ¹ì°¨ì¸ì›, ì˜¤í›„ì¶œë°œì‹œê°„, ì˜¤í›„ìŠ¹ì°¨ì¸ì›
            
            // í…Œì´ë¸” í…Œë‘ë¦¬
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 1;
            ctx.strokeRect(tableX, tableY, tableWidth, rowHeight + (stations.length * rowHeight) + rowHeight);
            
            // ì»¬ëŸ¼ í—¤ë” í–‰ (ì£¼í™©ìƒ‰/ì—°ë‘ìƒ‰ ë°°ê²½)
            const headerRowY = tableY;
            
            // ì»¬ëŸ¼ í—¤ë” ë°°ê²½ìƒ‰ (6ê°œ ì»¬ëŸ¼)
            let currentX = tableX;
            for (let i = 0; i < colWidths.length; i++) {
                if (i === 0) {
                    // ì²« ë²ˆì§¸ ì»¬ëŸ¼ (ë…¸ì„ ì´ë¦„ í†µí•©) - ì£¼í™©ìƒ‰
                    ctx.fillStyle = '#FF8C00';
                } else if (i === 1 || i === 3) {
                    // ì¶œë°œì‹œê°„ ì»¬ëŸ¼ - ì—°ë‘ìƒ‰
                    ctx.fillStyle = '#C6E0B4';
                } else if (i === 2 || i === 4) {
                    // ìŠ¹ì°¨ì¸ì› ì»¬ëŸ¼ - ì—°ë‘ìƒ‰
                    ctx.fillStyle = '#C6E0B4';
                } else {
                    // ë¹ˆê³µê°„ ì»¬ëŸ¼ - í°ìƒ‰
                    ctx.fillStyle = '#FFFFFF';
                }
                ctx.fillRect(currentX, headerRowY, colWidths[i], rowHeight);
                currentX += colWidths[i];
            }
            
            // í—¤ë” ì„¸ë¡œì„  ê·¸ë¦¬ê¸°
            currentX = tableX;
            for (let i = 0; i < colWidths.length; i++) {
                currentX += colWidths[i];
                ctx.beginPath();
                ctx.moveTo(currentX, headerRowY);
                ctx.lineTo(currentX, headerRowY + rowHeight);
                ctx.stroke();
            }
            
            // ì»¬ëŸ¼ í—¤ë” í…ìŠ¤íŠ¸ (ê¸€ì í¬ê¸° ì¦ê°€)
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 25px Arial';
            ctx.textAlign = 'center';
            
            currentX = tableX;
            const headers = ['', 'ì¶œë°œì‹œê°„', 'ìŠ¹ì°¨ì¸ì›', 'ì¶œë°œì‹œê°„', 'ìŠ¹ì°¨ì¸ì›'];
            for (let i = 0; i < headers.length; i++) {
                if (i === 0) {
                    // ì²« ë²ˆì§¸ ì»¬ëŸ¼ì— ë…¸ì„ ì´ë¦„ í‘œì‹œ (ê²€ì€ìƒ‰ í…ìŠ¤íŠ¸)
                    ctx.fillStyle = '#000000';
                    ctx.fillText(routeName, currentX + colWidths[i]/2, headerRowY + rowHeight/2 + 5);
                } else if (headers[i]) { // ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹Œ ê²½ìš°ë§Œ í…ìŠ¤íŠ¸ í‘œì‹œ
                    ctx.fillStyle = '#000000';
                    ctx.fillText(headers[i], currentX + colWidths[i]/2, headerRowY + rowHeight/2 + 5);
                }
                currentX += colWidths[i];
            }
            
            // ë°ì´í„° í–‰ë“¤ (ê¸€ì í¬ê¸° ì¦ê°€)
            ctx.font = '23px Arial';
            ctx.textAlign = 'left';
            
            stations.forEach((station, index) => {
                const dataRowY = headerRowY + rowHeight + (index * rowHeight);
                
                // ë°ì´í„° í–‰ ë°°ê²½ìƒ‰ ì„¤ì •
                let currentX = tableX;
                for (let i = 0; i < colWidths.length; i++) {
                    if (i === 0) {
                        // ì²« ë²ˆì§¸ ì»¬ëŸ¼ (ë…¸ì„ ì´ë¦„/ë²ˆí˜¸/ì •ë¥˜ì¥ëª…) - í°ìƒ‰
                        ctx.fillStyle = '#FFFFFF';
                    } else if ((i === 1 || i === 3) && index === 0) {
                        // ì²« ë²ˆì§¸ ì •ë¥˜ì¥ì˜ ì¶œë°œì‹œê°„ ì»¬ëŸ¼ë“¤ë§Œ - ë…¸ë€ìƒ‰
                        ctx.fillStyle = '#FFFF00';
                    } else {
                        // ë‚˜ë¨¸ì§€ ëª¨ë“  ì»¬ëŸ¼ë“¤ - í°ìƒ‰
                        ctx.fillStyle = '#FFFFFF';
                    }
                    ctx.fillRect(currentX, dataRowY, colWidths[i], rowHeight);
                    currentX += colWidths[i];
                }
                
                // í–‰ í…Œë‘ë¦¬
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 1;
                ctx.strokeRect(tableX, dataRowY, tableWidth, rowHeight);
                
                // ì„¸ë¡œì„  ê·¸ë¦¬ê¸°
                currentX = tableX;
                for (let i = 0; i < colWidths.length; i++) {
                    currentX += colWidths[i];
                    ctx.beginPath();
                    ctx.moveTo(currentX, dataRowY);
                    ctx.lineTo(currentX, dataRowY + rowHeight);
                    ctx.stroke();
                }
                
                // ë²ˆí˜¸ì™€ ì •ë¥˜ì¥ëª… í‘œì‹œ (1ì—´ì— í†µí•©)
                ctx.fillStyle = '#000000';
                ctx.fillText(`${index + 1}. ${station.name}`, tableX + 10, dataRowY + rowHeight/2 + 5);
                
                // ì˜¤ì „/ì˜¤í›„ ëª¨ë“  ë°ì´í„° í‘œì‹œ
                const morningHour = station.departureTime?.morningHour || 8;
                const morningMinute = station.departureTime?.minute || 0;
                const morningTimeStr = `${morningHour}:${String(morningMinute).padStart(2, '0')}`;
                
                const afternoonHour = station.departureTime?.afternoonHour || 17;
                const afternoonMinute = station.departureTime?.minute || 0;
                const afternoonTimeStr = `${afternoonHour}:${String(afternoonMinute).padStart(2, '0')}`;
                
                ctx.textAlign = 'center';
                
                // ì˜¤ì „ ì¶œë°œì‹œê°„ (2ì—´)
                ctx.fillStyle = '#000000';
                ctx.fillText(morningTimeStr, tableX + colWidths[0] + colWidths[1]/2, dataRowY + rowHeight/2 + 5);
                
                // ì˜¤ì „ ìŠ¹ì°¨ì¸ì› (3ì—´)
                ctx.fillStyle = '#000000';
                ctx.fillText(station.morningCount?.toString() || '0', tableX + colWidths[0] + colWidths[1] + colWidths[2]/2, dataRowY + rowHeight/2 + 5);
                
                // ì˜¤í›„ ì¶œë°œì‹œê°„ (4ì—´)
                ctx.fillStyle = '#000000';
                ctx.fillText(afternoonTimeStr, tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3]/2, dataRowY + rowHeight/2 + 5);
                
                // ì˜¤í›„ ìŠ¹ì°¨ì¸ì› (5ì—´)
                ctx.fillStyle = '#000000';
                ctx.fillText(station.afternoonCount?.toString() || '0', tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4]/2, dataRowY + rowHeight/2 + 5);
                
                ctx.textAlign = 'left';
            });
            
            // ì´ê³„ í–‰ (í°ìƒ‰ ë°°ê²½)
            const totalRowY = headerRowY + rowHeight + (stations.length * rowHeight);
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(tableX, totalRowY, tableWidth, rowHeight);
            
            // ì´ê³„ í–‰ ì„¸ë¡œì„  ê·¸ë¦¬ê¸°
            currentX = tableX;
            for (let i = 0; i < colWidths.length; i++) {
                currentX += colWidths[i];
                ctx.beginPath();
                ctx.moveTo(currentX, totalRowY);
                ctx.lineTo(currentX, totalRowY + rowHeight);
                ctx.stroke();
            }
            
            // "ê³„" í…ìŠ¤íŠ¸ (ê¸€ì í¬ê¸° ì¦ê°€)
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 25px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('ê³„', tableX + 10, totalRowY + rowHeight/2 + 5);
            
            // ì´ê³„ ê³„ì‚° ë° í‘œì‹œ (ì˜¤ì „/ì˜¤í›„ ëª¨ë“  ë°ì´í„°)
            ctx.textAlign = 'center';
            const morningTotal = stations.reduce((sum, station) => sum + (station.morningCount || 0), 0);
            const afternoonTotal = stations.reduce((sum, station) => sum + (station.afternoonCount || 0), 0);
            
            // ì˜¤ì „ ì´ê³„ (3ì—´)
            ctx.fillText(morningTotal.toString(), tableX + colWidths[0] + colWidths[1] + colWidths[2]/2, totalRowY + rowHeight/2 + 5);
            
            // ì˜¤í›„ ì´ê³„ (5ì—´)
            ctx.fillText(afternoonTotal.toString(), tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4]/2, totalRowY + rowHeight/2 + 5);
            
            return canvas.toDataURL('image/png');
        }

        // ì´ë¯¸ì§€ ìƒì„± ë° ê³µìœ 
        function generateAndShareImage() {
            if (stations.length === 0) {
                return;
            }
            
            try {
                generatedImageDataUrl = generateResultImage();
                
                // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                const modal = document.getElementById('image-modal');
                const img = document.getElementById('generated-image');
                img.src = generatedImageDataUrl;
                modal.classList.add('show');
                
                console.log('ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ:', generatedImageDataUrl ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
                
                // ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì‹œë„
                setTimeout(() => {
                    shareToKakao();
                }, 1000);
            } catch (error) {
                console.error('ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
            }
        }

        // ì¹´ì¹´ì˜¤í†¡ ê³µìœ  í•¨ìˆ˜
        function shareToKakao() {
            if (!generatedImageDataUrl) {
                return;
            }
            
            console.log('ê³µìœ  ì‹œë„ ì¤‘...');
            
            // ê³µìœ  ì‹œì‘
            isSharing = true;
            
            // Web Share API ì‚¬ìš© (ëª¨ë°”ì¼ì—ì„œ ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ê°€ëŠ¥)
            if (navigator.share) {
                console.log('Web Share API ì§€ì›ë¨');
                
                // ì´ë¯¸ì§€ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
                fetch(generatedImageDataUrl)
                    .then(res => res.blob())
                    .then(blob => {
                        console.log('Blob ìƒì„± ì™„ë£Œ:', blob.size, 'bytes');
                        const file = new File([blob], 'bus-count-result.png', { type: 'image/png' });
                        
                        navigator.share({
                            files: [file]
                        }).then(() => {
                            console.log('ê³µìœ  ì„±ê³µ');
                            // ê³µìœ  ì™„ë£Œ í›„ 3ì´ˆ ë’¤ í”Œë˜ê·¸ í•´ì œ
                            setTimeout(() => {
                                isSharing = false;
                            }, 3000);
                        }).catch(err => {
                            console.log('ê³µìœ  ì‹¤íŒ¨:', err);
                            isSharing = false;
                        });
                    })
                    .catch(err => {
                        console.error('Blob ìƒì„± ì‹¤íŒ¨:', err);
                        isSharing = false;
                    });
            } else {
                console.log('Web Share API ë¯¸ì§€ì›');
                isSharing = false;
            }
        }

        // ì´ë¯¸ì§€ ëª¨ë‹¬ ë‹«ê¸°
        function closeImageModal() {
            const modal = document.getElementById('image-modal');
            modal.classList.remove('show');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('image-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        // ìë™ ì¹´ìš´íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜ (ì˜¤í›„ ë§ˆì§€ë§‰ ì •ë¥˜ì¥ ì¶œë°œì‹œê°„ 50ë¶„ í›„)
        function resetAllCounts() {
            if (stations && stations.length > 0) {
                // ì˜¤í›„ ë§ˆì§€ë§‰ ì •ë¥˜ì¥ ì¶œë°œì‹œê°„ 50ë¶„ í›„ì¸ì§€ í™•ì¸
                if (checkAfternoonResetAvailability()) {
                    stations.forEach(station => {
                        // ì˜¤ì „/ì˜¤í›„ ëª¨ë“  ì¹´ìš´íŒ… ì´ˆê¸°í™”
                        station.count = 0;
                        station.morningCount = 0;
                        station.afternoonCount = 0;
                    });
                    currentStationIndex = 0;
                    currentInput = '';
                    enableKeypad();
                    updateKeypadPage();
                    localStorage.setItem('savedStations', JSON.stringify(stations));
                    console.log('ìë™ ì´ˆê¸°í™”: ì˜¤í›„ ë§ˆì§€ë§‰ ì •ë¥˜ì¥ ì¶œë°œì‹œê°„ 50ë¶„ ê²½ê³¼ë¡œ ì˜¤ì „/ì˜¤í›„ ëª¨ë“  ì¹´ìš´íŒ…ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // í‚¤íŒ¨ë“œ ìƒíƒœ ë³µì› í•¨ìˆ˜
        function restoreKeypadState() {
            const keypadDisabled = localStorage.getItem('keypadDisabled');
            if (keypadDisabled === 'true') {
                // í‚¤íŒ¨ë“œê°€ ë¹„í™œì„±í™”ëœ ìƒíƒœì˜€ë‹¤ë©´, í˜„ì¬ ì‹œê°„ëŒ€ì— ë”°ë¼ ì¬í™œì„±í™” ì—¬ë¶€ ê²°ì •
                const now = new Date();
                const currentHour = now.getHours();
                
                // ì˜¤ì „ ì‹œê°„ëŒ€(6-12ì‹œ)ì´ê³  ì˜¤ì „ ìš´í–‰ì´ ì™„ë£Œëœ ê²½ìš°, ë˜ëŠ” ì˜¤í›„ ì‹œê°„ëŒ€(13-22ì‹œ)ì´ê³  ì˜¤í›„ ìš´í–‰ì´ ì™„ë£Œëœ ê²½ìš°
                if ((currentHour >= 6 && currentHour < 12 && selectedTimePeriod === 'morning') ||
                    (currentHour >= 13 && currentHour < 22 && selectedTimePeriod === 'afternoon')) {
                    // í•´ë‹¹ ì‹œê°„ëŒ€ ìš´í–‰ì´ ì™„ë£Œëœ ìƒíƒœì´ë¯€ë¡œ í‚¤íŒ¨ë“œ ë¹„í™œì„±í™” ìœ ì§€
                    disableKeypad();
                } else {
                    // ë‹¤ë¥¸ ì‹œê°„ëŒ€ë¡œ ì „í™˜ ê°€ëŠ¥í•˜ë¯€ë¡œ í‚¤íŒ¨ë“œ í™œì„±í™”
                    enableKeypad();
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            loadTheme();
            loadSavedStations();
            loadSavedTimePeriod();
            setKoreanInputMode();
            
            // ì €ì¥ëœ ë…¸ì„  ëª©ë¡ í‘œì‹œ
            updateSavedRoutesDisplay();
            
            // ë‚ ì§œ ë³€ê²½ í™•ì¸ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
            checkDateChangeAndReset();
            
            // í‚¤íŒ¨ë“œ ìƒíƒœ ë³µì›
            setTimeout(() => {
                restoreKeypadState();
            }, 100);
        });

        // ê³µìœ  ì¤‘ì¸ì§€ í™•ì¸í•˜ëŠ” ë³€ìˆ˜
        let isSharing = false;

        // localStorage ì €ì¥ í•¨ìˆ˜ (ì˜¤ë¥˜ ì²˜ë¦¬ í¬í•¨)
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(key, value);
                console.log(`ì €ì¥ ì„±ê³µ: ${key}`);
                return true;
            } catch (error) {
                console.error(`ì €ì¥ ì‹¤íŒ¨: ${key}`, error);
                // ì €ì¥ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                if (error.name === 'QuotaExceededError') {
                    alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë°ì´í„°ë¥¼ ì •ë¦¬í•´ì£¼ì„¸ìš”.');
                } else if (error.name === 'SecurityError') {
                    alert('ë³´ì•ˆ ì„¤ì •ìœ¼ë¡œ ì¸í•´ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                } else {
                    alert('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ë§ˆì„¸ìš”.');
                }
                return false;
            }
        }

        // localStorage ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ (ì˜¤ë¥˜ ì²˜ë¦¬ í¬í•¨)
        function loadFromLocalStorage(key, defaultValue = null) {
            try {
                const value = localStorage.getItem(key);
                console.log(`ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ: ${key}`, value);
                return value;
            } catch (error) {
                console.error(`ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${key}`, error);
                return defaultValue;
            }
        }

        // ëª¨ë°”ì¼ ê¸°ê¸° ê°ì§€ í•¨ìˆ˜
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   (navigator.maxTouchPoints && navigator.maxTouchPoints > 2) ||
                   window.innerWidth <= 768;
        }

        // ë…¸ì„  ì €ì¥ í•¨ìˆ˜
        function saveRoute() {
            if (!routeName || stations.length === 0) {
                alert('ì €ì¥í•  ë…¸ì„  ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const routeData = {
                name: routeName,
                stationCount: stationCount,
                stations: stations.map(station => ({
                    name: station.name,
                    departureTime: station.departureTime
                })),
                savedAt: new Date().toISOString()
            };
            
            const savedRoutes = JSON.parse(loadFromLocalStorage('savedRoutes') || '[]');
            savedRoutes.push(routeData);
            
            if (saveToLocalStorage('savedRoutes', JSON.stringify(savedRoutes))) {
                alert(`"${routeName}" ë…¸ì„ ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                updateSavedRoutesDisplay();
            }
        }

        // ì €ì¥ëœ ë…¸ì„  ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        function loadRoute(routeData) {
            if (confirm(`"${routeData.name}" ë…¸ì„ ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                routeName = routeData.name;
                stationCount = routeData.stationCount;
                
                // ì •ë¥˜ì¥ ë°ì´í„° ë³µì›
                stations = routeData.stations.map(station => ({
                    name: station.name,
                    count: 0,
                    morningCount: 0,
                    afternoonCount: 0,
                    departureTime: station.departureTime
                }));
                
                // ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
                document.getElementById('route-name').value = routeName;
                document.getElementById('station-count').value = stationCount;
                
                // ì •ë¥˜ì¥ ì´ë¦„ ì…ë ¥ í˜ì´ì§€ë¡œ ì´ë™
                document.getElementById('station-count-page').classList.add('hidden');
                document.getElementById('station-names-page').classList.remove('hidden');
                createStationInputs();
                
                console.log(`"${routeData.name}" ë…¸ì„ ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
            }
        }

        // ì €ì¥ëœ ë…¸ì„  ëª©ë¡ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSavedRoutesDisplay() {
            const savedRoutes = JSON.parse(loadFromLocalStorage('savedRoutes') || '[]');
            const routesContainer = document.getElementById('saved-routes-container');
            
            if (!routesContainer) return;
            
            routesContainer.innerHTML = '';
            
            if (savedRoutes.length === 0) {
                routesContainer.innerHTML = '<p style="color: #999; text-align: center; margin: 10px 0;">ì €ì¥ëœ ë…¸ì„ ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            savedRoutes.forEach((route, index) => {
                const routeButton = document.createElement('button');
                routeButton.className = 'saved-route-btn';
                routeButton.innerHTML = `
                    <div class="route-name">${route.name}</div>
                    <div class="route-info">${route.stationCount}ê°œ ì •ë¥˜ì¥</div>
                `;
                routeButton.onclick = () => loadRoute(route);
                
                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-route-btn';
                deleteButton.innerHTML = 'Ã—';
                deleteButton.onclick = (e) => {
                    e.stopPropagation();
                    deleteRoute(index);
                };
                
                const routeItem = document.createElement('div');
                routeItem.className = 'saved-route-item';
                routeItem.appendChild(routeButton);
                routeItem.appendChild(deleteButton);
                
                routesContainer.appendChild(routeItem);
            });
        }

        // ë…¸ì„  ì‚­ì œ í•¨ìˆ˜
        function deleteRoute(index) {
            const savedRoutes = JSON.parse(loadFromLocalStorage('savedRoutes') || '[]');
            const route = savedRoutes[index];
            
            if (confirm(`"${route.name}" ë…¸ì„ ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                savedRoutes.splice(index, 1);
                saveToLocalStorage('savedRoutes', JSON.stringify(savedRoutes));
                updateSavedRoutesDisplay();
                alert(`"${route.name}" ë…¸ì„ ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ìë™ ì´ˆê¸°í™” ì´ë²¤íŠ¸ ì œê±° - ëª¨ë°”ì¼ê³¼ ì»´í“¨í„° ë™ì¼í•˜ê²Œ ì²˜ë¦¬
        // ìˆ˜ë™ ì´ˆê¸°í™”ë§Œ ê°€ëŠ¥ ("ì •ë¥˜ì¥ ëª…ìˆ˜ ì´ˆê¸°í™”" ë²„íŠ¼)
        
        /*
        // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ì—ì„œë§Œ ì‘ë™)
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible' && !isSharing && isMobileDevice()) {
                // ëª¨ë°”ì¼ì—ì„œë§Œ ê³µìœ  ì¤‘ì´ ì•„ë‹ ë•Œ ì˜¤í›„ ì¹´ìš´íŒ… ì´ˆê¸°í™” (ì˜¤ì „ ì¹´ìš´íŒ… ë³´ì¡´)
                console.log('ëª¨ë°”ì¼ì—ì„œ í˜ì´ì§€ê°€ ë‹¤ì‹œ ë³´ì´ê²Œ ë¨ - ì˜¤í›„ ì¹´ìš´íŒ… ì´ˆê¸°í™”');
                resetAllCounts();
            }
        });

        // í˜ì´ì§€ í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ì—ì„œë§Œ ì‘ë™)
        window.addEventListener('focus', function() {
            if (!isSharing && isMobileDevice()) {
                console.log('ëª¨ë°”ì¼ì—ì„œ í˜ì´ì§€ í¬ì»¤ìŠ¤ - ì˜¤í›„ ì¹´ìš´íŒ… ì´ˆê¸°í™”');
                resetAllCounts();
            }
        });

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì „ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ì—ì„œë§Œ ì‘ë™)
        window.addEventListener('beforeunload', function() {
            if (!isSharing && isMobileDevice()) {
                console.log('ëª¨ë°”ì¼ì—ì„œ í˜ì´ì§€ ì–¸ë¡œë“œ - ì˜¤í›„ ì¹´ìš´íŒ… ì´ˆê¸°í™”');
                resetAllCounts();
            }
        });
        */
    </script>
</body>
</html>
</html>