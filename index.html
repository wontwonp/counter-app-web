<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>정류장 카운터</title>
    <!-- 화면 자동 꺼짐 방지 -->
    <script src="https://unpkg.com/nosleep.js@0.12.0/dist/NoSleep.min.js"></script>

    <!-- PWA 설정 -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="정류장 카운터">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="정류장 카운터">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- 매니페스트 링크 -->
    <link rel="manifest" href="manifest.json">
    
    <!-- 아이콘 링크 -->
    <link rel="icon" type="image/svg+xml" sizes="192x192" href="icons/icon-192x192.svg">
    <link rel="icon" type="image/svg+xml" sizes="512x512" href="icons/icon-512x512.svg">
    <link rel="apple-touch-icon" href="icons/icon-192x192.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 시스템 글자 크기 조정 방지 */
        html {
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
        }

        body {
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
        }

        /* 모바일 화면 최적화 */
        @media screen and (max-width: 768px) {
            body {
                padding: 0;
                margin: 0;
                overflow-x: hidden;
                align-items: center;
                justify-content: center;
            }
            
            .container {
                padding: 5px;
                margin: 0;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
                overflow-x: hidden;
            }
            
            /* 시작 페이지가 보일 때만 중앙 정렬 */
            #selection-page:not(.hidden) {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* 다른 페이지들은 숨김 상태 유지 */
            #station-count-page.hidden,
            #station-names-page.hidden,
            #kurly-station-count-page.hidden,
            #kurly-station-names-page.hidden,
            #keypad-page.hidden {
                display: none !important;
            }
            
            .station-count-input, .station-names-input, .keypad-container {
                margin: 5px;
                padding: 10px;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }
            
            /* 키패드 페이지 모바일 스타일 */
            #keypad-page {
                width: 100%;
                max-width: 100%;
                padding: 5px;
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            
            .current-station {
                width: 100%;
                max-width: 100%;
                padding: 10px;
                margin: 5px;
                box-sizing: border-box;
            }
            
            .clock-display {
                width: 100%;
                max-width: 100%;
                padding: 10px;
                margin: 5px !important;
                margin-bottom: 5px !important;
                margin-right: 5px !important;
                margin-left: 5px !important;
                margin-top: 5px !important;
                box-sizing: border-box;
            }
            
            /* keypad-page 내부의 clock-display는 margin-bottom 5px로 강제 설정 */
            #keypad-page > .clock-display,
            #keypad-page .clock-display {
                margin-bottom: 5px !important;
            }
            
            .input-display {
                width: 100%;
                max-width: 100%;
                padding: 10px;
                margin: 5px;
                box-sizing: border-box;
            }
            
            .input-display {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 80px;
            }
            
            .number-display {
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100%;
                width: 100%;
            }
            
            .keypad {
                width: 100%;
                max-width: 100%;
                padding: 5px;
                box-sizing: border-box;
                margin: 0 auto;
                gap: 2px;
            }
            
            .keypad-row {
                width: 100%;
                max-width: 100%;
                display: flex;
                justify-content: center;
                gap: 2px;
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            /* ENTER 버튼이 있는 keypad-row 설정 - 키패드 0 버튼 기준으로 양쪽 배치 */
            .keypad-row:has(.enter-btn) {
                margin-bottom: 20px !important;
                padding-bottom: 0 !important;
                display: flex !important;
                gap: 10px !important;
                justify-content: space-between !important;
                align-items: center !important;
                position: relative !important;
                padding: 0 !important;
            }
            
            /* ENTER 버튼을 키패드 0 버튼 왼쪽에 배치 */
            .keypad-row:has(.enter-btn) .enter-btn {
                flex: 0 0 auto !important;
                margin: 0 !important;
            }
            
            /* 컬리일 때 도착시간 버튼을 키패드 0 버튼 오른쪽에 배치 */
            .keypad-row:has(.enter-btn) + #arrival-time-row[style*="display: block"],
            .keypad-row:has(.enter-btn) + #arrival-time-row:not([style*="display: none"]):not([style*="display:none"]) {
                position: absolute !important;
                left: auto !important;
                right: 0 !important;
                top: 50% !important;
                transform: translateY(-50%) !important;
                margin: 0 !important;
                padding: 0 !important;
                width: auto !important;
                max-width: 200px !important;
                display: flex !important;
                z-index: 10 !important;
            }
            
            /* 키패드 마지막 줄(C, 0, ⌫)의 너비를 기준으로 ENTER와 도착시간 버튼 배치 */
            .keypad-row:has(.enter-btn) {
                max-width: 100% !important;
            }
            
            /* ENTER 버튼을 키패드 마지막 줄의 왼쪽 끝에 맞춤 */
            .keypad-row:has(.enter-btn) .enter-btn {
                margin-left: 0 !important;
            }
            
            /* 도착시간 버튼이 키패드의 숫자 위치(9번 등)에 나타나지 않도록 - 모든 경우 커버 */
            .keypad-row:has(.keypad-btn) #arrival-time-btn,
            .keypad-row:has(.keypad-btn) button[onclick*="recordArrivalTime"],
            /* 키패드의 세 번째 줄(7,8,9 위치)의 세 번째 버튼이 도착시간 버튼인 경우 숨기기 */
            .keypad > .keypad-row:nth-child(3) button[onclick*="recordArrivalTime"],
            .keypad > .keypad-row:nth-child(3) #arrival-time-btn,
            .keypad .keypad-row:nth-child(3) button:nth-child(3)[onclick*="recordArrivalTime"],
            .keypad .keypad-row:nth-child(3) button:nth-child(3)#arrival-time-btn,
            /* 세 번째 줄의 세 번째 버튼 위치에 있는 모든 도착시간 관련 버튼 숨기기 */
            .keypad .keypad-row:nth-child(3) button:nth-child(3):not(.keypad-btn) {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                width: 0 !important;
                height: 0 !important;
                padding: 0 !important;
                margin: 0 !important;
                position: absolute !important;
                left: -9999px !important;
            }
            
            /* ENTER 버튼 row 다음에 오는 arrival-time-row는 표시 */
            .keypad-row:has(.enter-btn) + #arrival-time-row[style*="display: block"],
            .keypad-row:has(.enter-btn) + #arrival-time-row:not([style*="display: none"]):not([style*="display:none"]) {
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            /* 도착시간 버튼 스타일 조정 */
            .keypad-row:has(.enter-btn) + #arrival-time-row[style*="display: block"] button,
            .keypad-row:has(.enter-btn) + #arrival-time-row:not([style*="display: none"]):not([style*="display:none"]) button {
                width: auto !important;
                min-width: 120px !important;
                max-width: 200px !important;
                margin: 0 !important;
                display: block !important;
                visibility: visible !important;
            }
            
            /* 도착시간 버튼이 있는 keypad-row는 간격 완전히 제거 */
            #arrival-time-row.keypad-row {
                margin: 0 !important;
                padding: 0 10px !important;
                padding-top: 0 !important;
                padding-bottom: 0 !important;
            }
            
            .keypad-btn, .enter-btn {
                flex: 1;
                max-width: 80px;
                box-sizing: border-box;
                margin: 0;
            }
            
            .enter-btn {
                max-width: 100%;
                margin: 0;
            }
            
            /* 도착시간 버튼의 margin 완전히 제거 */
            #arrival-time-btn {
                margin: 0 !important;
                margin-top: 0 !important;
                margin-bottom: 0 !important;
            }
            
            .station-names-input {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .station-inputs {
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .station-input-group {
                gap: 8px;
                margin-bottom: 10px;
                flex-direction: column;
                align-items: stretch;
                width: 100%;
            }
            
            .station-input-group label {
                min-width: auto;
                text-align: center;
                margin-bottom: 5px;
            }
            
            .station-name-input {
                width: calc(100% - 20px) !important;
                max-width: 100% !important;
                min-width: 200px !important;
                font-size: 16px !important;
                padding: 12px 15px !important;
                margin: 8px auto !important;
                box-sizing: border-box !important;
                border-radius: 8px !important;
                border: none !important;
                background: rgba(255, 255, 255, 0.9) !important;
                color: #333 !important;
                text-align: left !important;
                display: block !important;
                position: relative !important;
                z-index: 1 !important;
                font-family: inherit !important;
                line-height: 1.4 !important;
                resize: none !important;
                overflow: hidden !important;
            }
            
            /* 갤럭시 S8 특화 대응 */
            @media screen and (max-width: 414px) and (min-width: 360px) {
                .station-name-input {
                    width: calc(100% - 16px) !important;
                    font-size: 15px !important;
                    padding: 10px 12px !important;
                    margin: 6px auto !important;
                }
                
                /* 갤럭시 S8 ENTER 버튼 겹침 방지 */
                .enter-btn {
                    z-index: 10000 !important;
                    position: relative !important;
                    margin-top: 0px !important;
                    margin-bottom: 40px !important;
                    display: block !important;
                    clear: both !important;
                    width: calc(100% - 30px) !important;
                    max-width: 180px !important;
                    margin-left: auto !important;
                    margin-right: auto !important;
                }
            }
            
            /* 작은 화면 대응 */
            @media screen and (max-width: 375px) {
                .station-name-input {
                    width: calc(100% - 12px) !important;
                    font-size: 14px !important;
                    padding: 8px 10px !important;
                    margin: 4px auto !important;
                }
            }
            
            /* 매우 작은 화면 대응 */
            @media screen and (max-width: 320px) {
                .station-name-input {
                    width: calc(100% - 8px) !important;
                    font-size: 13px !important;
                    padding: 6px 8px !important;
                    margin: 2px auto !important;
                }
            }
            
            /* 버튼 텍스트 모바일 최적화 */
            .button-text-top, .button-text-bottom {
                display: block !important;
                line-height: 1.1 !important;
                font-size: inherit !important;
                font-weight: inherit !important;
                text-align: center !important;
            }
            
            .button-text-top {
                margin-bottom: 1px !important;
            }
            
            .button-text-bottom {
                margin-top: 1px !important;
            }
            
            /* 숫자 표시 중앙 정렬 모바일 최적화 */
            .number-display {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                height: 100% !important;
                line-height: 1 !important;
                text-align: center !important;
            }
            
            /* ENTER 버튼 겹침 방지 모바일 최적화 */
            .enter-btn {
                z-index: 10000 !important;
                position: relative !important;
                margin-top: 0px !important;
                margin-bottom: 15px !important;
                display: block !important;
                clear: both !important;
                width: calc(100% - 20px) !important;
                max-width: 200px !important;
                margin-left: auto !important;
                margin-right: auto !important;
            }
            
            /* 도착시간 버튼 모바일 스타일 - 컬리 전용 */
            #arrival-time-row {
                width: 100% !important;
                max-width: 100% !important;
                margin-top: 0 !important;
                margin-bottom: 0 !important;
                margin: 0 !important;
                padding: 0 10px !important;
                padding-top: 0 !important;
                padding-bottom: 0 !important;
                display: flex !important;
                justify-content: center !important;
                position: relative !important;
                z-index: 9999 !important;
                clear: both !important;
            }
            
            /* ENTER 버튼과 도착시간 버튼 사이 간격 완전히 제거 */
            .keypad-row:has(#arrival-time-row) {
                margin-top: 0 !important;
                margin-bottom: 0 !important;
                padding-top: 0 !important;
                padding-bottom: 0 !important;
            }
            
            .keypad-row + #arrival-time-row {
                margin-top: 0 !important;
                margin-bottom: 0 !important;
                padding-top: 0 !important;
                padding-bottom: 0 !important;
            }
            
            /* ENTER 버튼이 있는 keypad-row 다음에 오는 arrival-time-row 간격 완전히 제거 (음수 margin 사용) */
            .keypad-row:has(.enter-btn) + #arrival-time-row {
                margin-top: -5px !important;
                margin-bottom: 0 !important;
                padding-top: 0 !important;
                padding-bottom: 0 !important;
                padding: 0 10px !important;
            }
            
            /* ENTER 버튼과 도착시간 버튼 사이 간격 제거 (더 강력한 선택자, 음수 margin 사용) */
            .keypad-row:has(.enter-btn[onclick*="enterNumber"]) + #arrival-time-row {
                margin-top: -5px !important;
                margin-bottom: 0 !important;
                padding-top: 0 !important;
                padding-bottom: 0 !important;
            }
            
            /* 쿠팡일 때 도착시간 버튼 완전히 숨기기 - JavaScript에서 처리하므로 CSS는 제거 */
            
            #arrival-time-row button {
                width: calc(100% - 20px) !important;
                max-width: 200px !important;
                margin: 0 auto !important;
            }
            
            /* 정류장별 카운트 섹션 모바일 스타일 */
            .station-summary {
                width: 100% !important;
                max-width: 100% !important;
                padding: 15px !important;
                margin-top: 20px !important;
                margin-bottom: 10px !important;
                box-sizing: border-box !important;
                position: relative !important;
                z-index: 1 !important;
                clear: both !important;
            }
            
            /* keypad-page 다음에 오는 station-summary는 margin-top 강제 설정 */
            #keypad-page ~ .station-summary,
            .keypad ~ .station-summary {
                margin-top: 20px !important;
            }
            
            /* 컬리일 때 도착시간 버튼이 있을 때 정류장 카운트 섹션 간격 추가 */
            #arrival-time-row[style*="display: block"] ~ .station-summary,
            #arrival-time-row:not([style*="display: none"]):not([style*="display:none"]) ~ .station-summary {
                margin-top: 25px !important;
            }
            
            /* 버튼 그룹 모바일 스타일 */
            .reset-buttons, .share-buttons {
                width: 100% !important;
                max-width: 100% !important;
                padding: 5px !important;
                margin: 5px 0 !important;
                box-sizing: border-box !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 5px !important;
                align-items: center !important;
                position: relative !important;
                z-index: 1 !important;
            }
            
            .reset-buttons button, .share-buttons button {
                width: calc(100% - 20px) !important;
                max-width: 300px !important;
                margin: 0 !important;
            }
            
            /* 시간대 버튼 모바일 스타일 */
            .time-period-btn {
                font-size: 0.9rem !important;
                padding: 10px 15px !important;
                margin: 5px !important;
            }
            
            /* 키패드 페이지 내부 요소 간격 조정 */
            #keypad-page > *:not(.clock-display):not(.input-display) {
                margin-bottom: 15px !important;
            }
            
            /* clock-display는 margin-bottom 5px로 강제 설정 (다른 규칙보다 우선) */
            #keypad-page > .clock-display,
            #keypad-page .clock-display {
                margin-bottom: 5px !important;
            }
            
            /* input-display는 margin-bottom 5px로 강제 설정 */
            #keypad-page > .input-display,
            #keypad-page .input-display {
                margin-bottom: 5px !important;
            }
            
            #keypad-page > *:last-child {
                margin-bottom: 0 !important;
            }
            
            /* 키패드 행 간격 조정 */
            .keypad-row {
                margin-bottom: 5px !important;
            }
            
            .keypad-row:last-of-type {
                margin-bottom: 0 !important;
            }
            
            /* 현재 정류장 표시 모바일 스타일 */
            .current-station h2 {
                font-size: 1.2rem !important;
                margin: 5px 0 !important;
                word-break: break-word !important;
            }
            
            .current-station p {
                font-size: 1rem !important;
                margin: 5px 0 !important;
            }
            
            /* 시계 표시 모바일 스타일 */
            .clock-time {
                font-size: 2rem !important;
                letter-spacing: -0.05em !important;
            }
            
            .clock-date {
                font-size: 0.9rem !important;
            }
            
            /* 입력 표시 모바일 스타일 */
            .input-display {
                min-height: 60px !important;
            }
            
            .number-display {
                font-size: 1.8rem !important;
            }
            
            /* 노선 입력 텍스트창 모바일 최적화 - 모든 기기 통일 */
            .number-input {
                width: calc(100% - 20px) !important;
                max-width: 320px !important;
                min-width: 250px !important;
                font-size: 16px !important;
                padding: 14px 16px !important;
                margin: 12px auto !important;
                box-sizing: border-box !important;
                border-radius: 8px !important;
                border: none !important;
                background: rgba(255, 255, 255, 0.9) !important;
                color: #333 !important;
                text-align: center !important;
                display: block !important;
                position: relative !important;
                z-index: 1 !important;
            }
            
            /* 갤럭시 S8 특화 대응 */
            @media screen and (max-width: 414px) and (min-width: 360px) {
                .number-input {
                    width: calc(100% - 16px) !important;
                    font-size: 15px !important;
                    padding: 12px 14px !important;
                    margin: 10px auto !important;
                }
            }
            
            /* 작은 화면 대응 */
            @media screen and (max-width: 375px) {
                .number-input {
                    width: calc(100% - 12px) !important;
                    font-size: 14px !important;
                    padding: 10px 12px !important;
                    margin: 8px auto !important;
                }
            }
            
            /* 매우 작은 화면 대응 */
            @media screen and (max-width: 320px) {
                .number-input {
                    width: calc(100% - 8px) !important;
                    font-size: 13px !important;
                    padding: 8px 10px !important;
                    margin: 6px auto !important;
                }
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            color: white;
            transition: all 0.3s ease;
            padding-top: 20px;
            padding-bottom: 20px;
            overflow-x: hidden;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        /* 시작 페이지 스타일 */
        .selection-page {
            background: rgba(255, 255, 255, 0.1);
            padding: 60px 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        .selection-page h1 {
            font-size: 2.5rem;
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .selection-buttons {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        .selection-btn {
            width: 100%;
            max-width: 400px;
            padding: 30px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.95);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .selection-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 1);
        }

        .selection-btn:active {
            transform: translateY(-2px);
        }

        .selection-btn img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }

        .coupang-btn img {
            max-height: 36px;
        }

        .kurly-btn img {
            max-height: 42px;
        }

        body.dark-mode .selection-page {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .selection-page h1 {
            color: white;
        }

        @media (max-width: 768px) {
            .container {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
            }
            
            #selection-page {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
            }
            
            .selection-page {
                padding: 40px 20px;
                width: 100%;
                max-width: 90%;
            }

            .selection-page h1 {
                font-size: 2rem;
                margin-bottom: 40px;
            }

            .selection-btn {
                padding: 25px;
            }

            .coupang-btn img {
                max-height: 30px;
            }

            .kurly-btn img {
                max-height: 36px;
            }
        }


        .container {
            text-align: center;
            padding: 10px;
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        h2 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        h3 {
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        /* 정류장 개수 입력 페이지 */
        .station-count-input {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .number-input {
            font-size: 1.5rem;
            padding: 15px 20px;
            margin: 20px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            text-align: center;
            width: 200px;
        }

        .submit-btn {
            font-size: 1.2rem;
            padding: 15px 30px;
            margin: 20px;
            border: none;
            border-radius: 10px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        /* 정류장 이름 입력 페이지 */
        .station-names-input {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
        }

        .station-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .station-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .station-input-group label {
            min-width: 100px;
            text-align: left;
            font-size: 1.1rem;
        }

        .station-name-input {
            flex: 1;
            font-size: 1.1rem;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .button-group {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        /* 버튼 텍스트 상하 정렬 스타일 */
        .button-text-top, .button-text-bottom {
            display: block;
            line-height: 1.2;
            font-size: inherit;
            font-weight: inherit;
        }
        
        .button-text-top {
            margin-bottom: 2px;
        }
        
        .button-text-bottom {
            margin-top: 2px;
        }

        .start-btn, .reset-btn {
            font-size: 1.2rem;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-btn {
            background: #4CAF50;
            color: white;
        }

        .start-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }

        .start-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .reset-btn {
            background: #f44336;
            color: white;
        }

        .reset-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        /* 키패드 페이지 */
        .current-station {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 5px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .current-station h2 {
            margin-bottom: 10px;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        .current-station p {
            font-size: 1.3rem;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        /* 정류장 변경 시 색상 변화 효과 */
        .current-station.changed {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
            animation: stationChange 0.8s ease-in-out;
        }

        .current-station.changed h2 {
            color: #4CAF50;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .current-station.changed p {
            color: #81C784;
        }

        @keyframes stationChange {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .clock-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            margin: 5px !important;
            margin-bottom: 5px !important;
            margin-right: 5px !important;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: 'Courier New', monospace;
            box-sizing: border-box;
        }
        
        /* keypad-page 내부의 clock-display는 margin-bottom 5px 강제 */
        #keypad-page > .clock-display {
            margin-bottom: 5px !important;
        }
        
        /* 모든 화면 크기에서 clock-display margin 강제 */
        @media screen and (max-width: 768px) {
            .clock-display {
                margin: 5px !important;
                margin-bottom: 5px !important;
                margin-right: 5px !important;
                margin-left: 5px !important;
                margin-top: 5px !important;
            }
            
            #keypad-page > .clock-display {
                margin-bottom: 5px !important;
            }
        }
        
        @media screen and (max-width: 414px) {
            .clock-display {
                margin: 5px !important;
                margin-bottom: 5px !important;
                margin-right: 5px !important;
                margin-left: 5px !important;
                margin-top: 5px !important;
            }
            
            #keypad-page > .clock-display {
                margin-bottom: 5px !important;
            }
        }
        
        @media screen and (max-width: 360px) {
            .clock-display {
                margin: 5px !important;
                margin-bottom: 5px !important;
                margin-right: 5px !important;
                margin-left: 5px !important;
                margin-top: 5px !important;
            }
            
            #keypad-page > .clock-display {
                margin-bottom: 5px !important;
            }
        }

        .clock-time {
            font-size: clamp(1.6rem, 6vw, 2.6rem);
            font-weight: 900;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
            letter-spacing: -0.05em;
        }

        .clock-date {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .input-display {
            background: rgba(0, 0, 0, 0.3);
            padding-bottom: 0px;
            padding-top: 0px;
            border-top-width: 0px;
            border-bottom-width: 0px;
            margin-bottom: 5px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .keypad {
            margin-top: 0px;
        }

        .number-display {
            font-size: clamp(1.0rem, 3vw, 1.5rem);
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            line-height: 1;
            margin: 0;
            transition: all 0.3s ease;
        }

        .keypad {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-bottom: 2px;
            flex: 1;
            min-height: 0;
            max-height: 45vh;
            z-index: 100;
            position: relative;
        }
        
        /* 웹 버전: 기본적으로 ENTER 버튼을 가운데 정렬 (쿠팡) */
        .keypad-row:has(.enter-btn) {
            display: flex !important;
            gap: 10px !important;
            justify-content: center !important;
            align-items: center !important;
            position: relative !important;
            padding: 0 !important;
        }
        
        /* 컬리일 때: ENTER 버튼을 키패드 0 버튼 바로 아래 왼쪽에 배치 */
        .keypad-row:has(.enter-btn):has(+ #arrival-time-row[style*="display: block"]),
        .keypad-row:has(.enter-btn):has(+ #arrival-time-row:not([style*="display: none"]):not([style*="display:none"])) {
            justify-content: center !important;
            gap: 10px !important;
            width: 100% !important;
            max-width: 100% !important;
            position: relative !important;
        }
        
        /* 컬리일 때 ENTER 버튼을 키패드 0 버튼 왼쪽에 정확히 배치 (웹 버전) */
        .keypad-row:has(.enter-btn):has(+ #arrival-time-row[style*="display: block"]) .enter-btn,
        .keypad-row:has(.enter-btn):has(+ #arrival-time-row:not([style*="display: none"]):not([style*="display:none"])) .enter-btn {
            position: relative !important;
            left: -50% !important;
            margin-left: -50% !important;
            margin-right: 0 !important;
            transform: none !important;
            flex: 0 0 auto !important;
        }
        
        /* 컬리일 때 도착시간 버튼을 키패드 0 버튼 오른쪽에 정확히 배치 (웹 버전) */
        .keypad-row:has(.enter-btn):has(+ #arrival-time-row[style*="display: block"]) + #arrival-time-row,
        .keypad-row:has(.enter-btn):has(+ #arrival-time-row:not([style*="display: none"]):not([style*="display:none"])) + #arrival-time-row {
            position: absolute !important;
            left: calc(50% + 33.33%) !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            margin: 0 !important;
            padding: 0 !important;
            width: auto !important;
            max-width: 200px !important;
            display: flex !important;
            z-index: 10 !important;
            pointer-events: auto !important;
        }
        
        /* 도착시간 버튼이 키패드의 숫자 위치에 나타나지 않도록 (웹 버전) */
        .keypad-row:has(.keypad-btn) #arrival-time-btn,
        .keypad-row:has(.keypad-btn) button[onclick*="recordArrivalTime"],
        .keypad > .keypad-row:nth-child(3) button[onclick*="recordArrivalTime"],
        .keypad > .keypad-row:nth-child(3) #arrival-time-btn,
        .keypad .keypad-row:nth-child(3) button:nth-child(3)[onclick*="recordArrivalTime"],
        .keypad .keypad-row:nth-child(3) button:nth-child(3)#arrival-time-btn,
        .keypad .keypad-row:nth-child(3) button:nth-child(3):not(.keypad-btn) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* ENTER 버튼 row 다음에 오는 arrival-time-row는 표시 (웹 버전) */
        .keypad-row:has(.enter-btn) + #arrival-time-row[style*="display: block"],
        .keypad-row:has(.enter-btn) + #arrival-time-row:not([style*="display: none"]):not([style*="display:none"]) {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* 도착시간 버튼 스타일 조정 (웹 버전) */
        .keypad-row:has(.enter-btn) + #arrival-time-row[style*="display: block"] button,
        .keypad-row:has(.enter-btn) + #arrival-time-row:not([style*="display: none"]):not([style*="display:none"]) button {
            width: auto !important;
            min-width: 120px !important;
            max-width: 200px !important;
            margin: 0 !important;
            display: block !important;
            visibility: visible !important;
        }

        .keypad-row {
            display: flex;
            gap: 3px;
            justify-content: center;
            flex: 1;
        }

        .keypad-btn {
            width: clamp(40px, 9vw, 55px);
            height: clamp(30px, 7vw, 40px);
            font-size: clamp(0.8rem, 2.8vw, 1.2rem);
            font-weight: bold;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.3);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .keypad-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .keypad-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px) scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .enter-btn {
            width: clamp(130px, 55vw, 180px);
            height: clamp(35px, 7vw, 45px);
            font-size: clamp(0.8rem, 2.8vw, 1.2rem);
            font-weight: bold;
            border: none;
            border-radius: 10px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            z-index: 10000;
            position: relative;
            margin-top: 0px;
            margin-bottom: 30px;
            display: block;
            clear: both;
        }

        .enter-btn:hover {
            background: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .enter-btn:active {
            background: #3d8b40;
            transform: translateY(-1px) scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* 정류장 요약 */
        .station-summary {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 400px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .summary-item {
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .summary-item.current {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
            font-weight: bold;
        }

        .reset-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .reset-counts-btn, .reset-app-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-previous-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #9C27B0;
        }

        .delete-previous-btn:hover {
            background: #7B1FA2;
            transform: translateY(-2px);
        }

        .reset-counts-btn {
            background: #ff9800;
        }

        .reset-counts-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .reset-app-btn {
            background: #f44336;
        }

        .reset-app-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .container {
                padding: 5px;
                margin: 0;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
                overflow-x: hidden;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .station-count-input, .station-names-input {
                padding: 15px;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }
            
            .station-input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .station-input-group label {
                text-align: center;
                min-width: auto;
            }
            
            .keypad-btn {
                width: 70px;
                height: 70px;
                font-size: 1.4rem;
            }
            
            .enter-btn {
                width: 225px;
                height: 70px;
                font-size: 1.4rem;
            }
            
            .number-display {
                font-size: 1.8rem;
            }
            
            /* 시간대 토글 버튼 모바일 스타일 */
            .time-period-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            /* 리셋 버튼 모바일 스타일 */
            .reset-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }

        .hidden {
            display: none !important;
        }
        
        /* 모바일에서도 hidden 클래스가 확실히 적용되도록 */
        @media screen and (max-width: 768px) {
            .hidden {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                height: 0 !important;
                overflow: hidden !important;
            }
            
            #selection-page.hidden,
            #station-count-page.hidden,
            #station-names-page.hidden,
            #keypad-page.hidden {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                position: absolute !important;
                left: -9999px !important;
                width: 0 !important;
                height: 0 !important;
                overflow: hidden !important;
            }
        }

        /* 시작 페이지 스타일 */
        .selection-page {
            background: rgba(255, 255, 255, 0.1);
            padding: 60px 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        .selection-page h1 {
            font-size: 2.5rem;
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .selection-buttons {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        .selection-btn {
            width: 100%;
            max-width: 400px;
            padding: 30px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.95);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .selection-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 1);
        }

        .selection-btn:active {
            transform: translateY(-2px);
        }

        .selection-btn img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }

        .coupang-btn img {
            max-height: 36px;
        }

        .kurly-btn img {
            max-height: 42px;
        }

        @media (max-width: 768px) {
            .container {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
            }
            
            #selection-page {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
            }
            
            .selection-page {
                padding: 40px 20px;
                width: 100%;
                max-width: 90%;
            }

            .selection-page h1 {
                font-size: 2rem;
                margin-bottom: 40px;
            }

            .selection-btn {
                padding: 25px;
            }

            .coupang-btn img {
                max-height: 30px;
            }

            .kurly-btn img {
                max-height: 36px;
            }
        }

        /* 저장된 노선 관련 스타일 */
        .saved-route-item {
            position: relative;
            margin-bottom: 10px;
        }

        .saved-route-btn {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .saved-route-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .route-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .route-info {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .delete-route-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: none;
            background: #f44336;
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .delete-route-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .save-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .save-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        /* 다크모드 토글 버튼 */
        .theme-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 1.3rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.5s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            opacity: 1;
            transform: translateX(0);
        }

        /* 다크모드 버튼 숨김 상태 */
        .theme-toggle.hidden {
            opacity: 0;
            transform: translateX(100px);
            pointer-events: none;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* 다크모드 버튼 영역 호버 시 다시 나타나기 */
        .theme-toggle-area {
            position: fixed;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            z-index: 999;
            cursor: pointer;
        }

        /* 왼쪽 상단 관리자 영역 */
        .admin-trigger-area {
            position: fixed;
            top: 0;
            left: 0;
            width: 100px;
            height: 100px;
            z-index: 999;
            cursor: pointer;
            background: transparent;
        }

        /* 비밀번호 입력 모달 */
        .password-modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .password-modal.show {
            display: flex !important;
        }

        /* 택시 인원 입력 키패드 모달 */
        .taxi-keypad-modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10001;
            align-items: center;
            justify-content: center;
        }

        .taxi-keypad-modal.show {
            display: flex !important;
        }

        .taxi-keypad-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .taxi-keypad-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .taxi-keypad-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .taxi-keypad-display h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .taxi-keypad-number-display {
            font-size: 3rem;
            color: white;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .taxi-keypad-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .taxi-keypad-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 8px;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .taxi-keypad-btn:hover {
            background: white;
            transform: scale(1.05);
        }

        .taxi-keypad-actions {
            display: flex;
            gap: 10px;
        }

        .taxi-keypad-action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .taxi-keypad-action-btn.confirm {
            background: #4CAF50;
            color: white;
        }

        .taxi-keypad-action-btn.confirm:hover {
            background: #45a049;
        }

        .taxi-keypad-action-btn.cancel {
            background: #f44336;
            color: white;
        }

        .taxi-keypad-action-btn.cancel:hover {
            background: #da190b;
        }

        .password-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .password-modal-content {
            background: #2a2a2a;
            color: white;
        }

        .password-modal-content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        body.dark-mode .password-modal-content h2 {
            color: white;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        body.dark-mode .password-input {
            background: #1a1a1a;
            color: white;
            border-color: #555;
        }

        .password-modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .password-modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .password-modal-btn.confirm {
            background: #4CAF50;
            color: white;
        }

        .password-modal-btn.confirm:hover {
            background: #45a049;
        }

        .password-modal-btn.cancel {
            background: #f44336;
            color: white;
        }

        .password-modal-btn.cancel:hover {
            background: #da190b;
        }

        /* 공지사항 관리 모달 */
        .notice-admin-modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10001;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px;
        }

        .notice-admin-modal.show {
            display: flex !important;
        }

        .notice-admin-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .notice-admin-content {
            background: #2a2a2a;
            color: white;
        }

        .notice-admin-content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        body.dark-mode .notice-admin-content h2 {
            color: white;
        }

        .notice-list {
            margin-bottom: 20px;
        }

        .notice-item {
            background: #f5f5f5;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        body.dark-mode .notice-item {
            background: #1a1a1a;
            border-left-color: #4CAF50;
        }

        .notice-item-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .notice-item-content {
            color: #666;
            margin-bottom: 10px;
        }

        body.dark-mode .notice-item-content {
            color: #aaa;
        }

        .notice-item-actions {
            display: flex;
            gap: 10px;
        }

        .notice-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .notice-btn.edit {
            background: #2196F3;
            color: white;
        }

        .notice-btn.delete {
            background: #f44336;
            color: white;
        }

        .notice-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        body.dark-mode .notice-form {
            border-top-color: #555;
        }

        .notice-form input,
        .notice-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        body.dark-mode .notice-form input,
        body.dark-mode .notice-form textarea {
            background: #1a1a1a;
            color: white;
            border-color: #555;
        }

        .notice-form textarea {
            min-height: 100px;
            resize: vertical;
        }

        .notice-form h3 {
            margin-bottom: 15px;
            color: #333;
        }

        body.dark-mode .notice-form h3 {
            color: white;
        }

        /* 공지사항 모달 (사용자용) */
        .notice-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 4000;
        }

        .notice-modal.show {
            display: flex;
        }

        .notice-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            color: #333;
        }
        
        /* 라이트 모드에서 공지사항 텍스트 색상 */
        .notice-modal-content h2 {
            color: #333 !important;
        }
        
        .notice-modal-content p {
            color: #555 !important;
        }
        
        .notice-modal-content span {
            color: #666 !important;
        }
        
        .notice-modal-content div {
            color: #555 !important;
        }
        
        .notice-modal-content label {
            color: #666 !important;
        }
        
        #notice-content-display {
            color: #555 !important;
        }
        
        #notice-content-display * {
            color: #555 !important;
        }
        
        .notice-title {
            color: #333 !important;
        }
        
        .notice-content {
            color: #555 !important;
        }
        
        .notice-label {
            color: #666 !important;
        }
        
        .notice-checkbox-text {
            color: #666 !important;
        }

        body.dark-mode .notice-modal-content {
            background: #2a2a2a;
            color: white !important;
        }

        body.dark-mode .notice-modal-content h2 {
            color: white !important;
        }

        body.dark-mode .notice-modal-content p {
            color: #ffffff !important;
        }

        body.dark-mode .notice-modal-content span {
            color: #ffffff !important;
        }
        
        body.dark-mode .notice-modal-content div {
            color: #ffffff !important;
        }
        
        body.dark-mode .notice-modal-content label {
            color: #ffffff !important;
        }
        
        body.dark-mode #notice-content-display {
            color: #ffffff !important;
        }
        
        body.dark-mode #notice-content-display * {
            color: #ffffff !important;
        }
        
        body.dark-mode .notice-title {
            color: #ffffff !important;
        }
        
        body.dark-mode .notice-content {
            color: #ffffff !important;
        }
        
        body.dark-mode .notice-label {
            color: #ffffff !important;
        }
        
        body.dark-mode .notice-checkbox-text {
            color: #ffffff !important;
        }

        /* 차량현황 페이지 다크모드 */
        body.dark-mode #vehicle-status-1-page,
        body.dark-mode #vehicle-status-3-page,
        body.dark-mode #vehicle-status-4-page {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%) !important;
        }

        body.dark-mode #vehicle-status-1-page > div > div,
        body.dark-mode #vehicle-status-3-page > div > div,
        body.dark-mode #vehicle-status-4-page > div > div {
            background: transparent !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3) !important;
        }

        body.dark-mode #vehicle-status-1-page h1,
        body.dark-mode #vehicle-status-3-page h1,
        body.dark-mode #vehicle-status-4-page h1 {
            color: #fff !important;
        }

        body.dark-mode #vehicle-status-1-page .route-item,
        body.dark-mode #vehicle-status-3-page .route-item,
        body.dark-mode #vehicle-status-4-page .route-item {
            background: rgba(255, 255, 255, 0.2) !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
            color: #fff !important;
        }

        body.dark-mode #vehicle-status-1-page button,
        body.dark-mode #vehicle-status-3-page button,
        body.dark-mode #vehicle-status-4-page button {
            color: #fff !important;
        }

        /* 차량입차현황 페이지 */
        #vehicle-status-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body.dark-mode #vehicle-status-page {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-mode #vehicle-status-page h2 {
            color: white;
        }

        body.dark-mode #vehicle-status-page .station-count-input {
            color: white;
        }

        body.dark-mode #vehicle-status-page button {
            color: white;
        }

        #vehicle-status-page.hidden {
            display: none !important;
        }

        #vehicle-status-page button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        }

        .vehicle-status-btn {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            font-size: 1rem;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .vehicle-status-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .theme-toggle-area:hover .theme-toggle {
            opacity: 1 !important;
            transform: translateX(0) !important;
            pointer-events: auto !important;
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        /* 다크모드에서의 카드 스타일 조정 */
        body.dark-mode .station-count-input,
        body.dark-mode .station-names-input,
        body.dark-mode .current-station,
        body.dark-mode .clock-display,
        body.dark-mode .input-display,
        body.dark-mode .station-summary {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .keypad-btn {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.dark-mode .keypad-btn:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        /* 공유 버튼 스타일 */
        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }

        .share-btn, .download-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-btn {
            background: #FEE500;
            color: #3C1E1E;
        }

        .share-btn:hover {
            background: #FFD700;
            transform: translateY(-2px);
        }

        /* 이미지 미리보기 모달 */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .image-modal.show {
            display: flex;
        }

        .image-modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
        }

        .image-modal img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2rem;
            color: white;
            cursor: pointer;
        }

        /* 시간대 선택 버튼 스타일 */
        .time-period-btn {
            font-size: 1.1rem;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .time-period-btn.active {
            background: #4CAF50;
            border: 2px solid #4CAF50;
            transform: translateY(-2px);
        }

        .time-period-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .time-period-btn.active:hover {
            background: #45a049;
        }

        /* 공유 버튼 스타일 */
        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .share-btn, .reset-btn {
            font-size: 1rem;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .share-btn {
            background: #4CAF50;
            color: white;
        }

        .share-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .reset-btn {
            background: #f44336;
            color: white;
        }

        .reset-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        /* 정류장 이름 입력 페이지 버튼 그룹 스타일 */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .start-btn, .save-btn, .add-station-btn {
            font-size: 1rem;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-btn {
            background: #4CAF50;
            color: white;
        }

        .start-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .start-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .save-btn {
            background: #4CAF50;
            color: white;
        }

        .save-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .save-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .add-station-btn {
            background: #4CAF50;
            color: white;
        }

        .add-station-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- 왼쪽 상단 관리자 트리거 영역 -->
    <div class="admin-trigger-area" id="admin-trigger-area"></div>
    
    <div class="theme-toggle-area">
        <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙</button>
    </div>

    <!-- 비밀번호 입력 모달 -->
    <div class="password-modal" id="password-modal">
        <div class="password-modal-content">
            <h2>관리자 비밀번호</h2>
            <input type="password" id="admin-password" class="password-input" placeholder="비밀번호를 입력하세요" autocomplete="off">
            <div class="password-modal-buttons">
                <button class="password-modal-btn cancel" onclick="closePasswordModal()">취소</button>
                <button class="password-modal-btn confirm" onclick="checkAdminPassword()">확인</button>
            </div>
        </div>
    </div>

    <!-- 공지사항 관리 모달 -->
    <div class="notice-admin-modal" id="notice-admin-modal">
        <div class="notice-admin-content">
            <h2>공지사항 관리</h2>
            <div class="notice-list" id="notice-list"></div>
            <div class="notice-form">
                <h3>새 공지사항 추가</h3>
                <input type="text" id="notice-title" placeholder="제목" maxlength="100">
                <textarea id="notice-content" placeholder="내용"></textarea>
                <div class="password-modal-buttons">
                    <button class="password-modal-btn cancel" onclick="closeNoticeAdmin()">닫기</button>
                    <button class="password-modal-btn confirm" onclick="saveNotice()">저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 택시 인원 입력 키패드 모달 -->
    <div class="taxi-keypad-modal" id="taxi-keypad-modal">
        <div class="taxi-keypad-modal-content">
            <div class="taxi-keypad-display">
                <h3>택시 인원 입력</h3>
                <div class="taxi-keypad-number-display" id="taxi-keypad-display">0</div>
            </div>
            <div class="taxi-keypad-buttons">
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('1')">1</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('2')">2</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('3')">3</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('4')">4</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('5')">5</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('6')">6</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('7')">7</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('8')">8</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('9')">9</button>
                <button class="taxi-keypad-btn" onclick="taxiClearInput()">C</button>
                <button class="taxi-keypad-btn" onclick="taxiInputDigit('0')">0</button>
                <button class="taxi-keypad-btn" onclick="taxiBackspace()">⌫</button>
            </div>
            <div class="taxi-keypad-actions">
                <button class="taxi-keypad-action-btn cancel" onclick="closeTaxiKeypadModal()">취소</button>
                <button class="taxi-keypad-action-btn confirm" onclick="confirmTaxiInput()">확인</button>
            </div>
        </div>
    </div>
    <div class="container">
        
        <!-- 시작 페이지 (선택 페이지) -->
        <div id="selection-page">
            <div class="selection-page">
                <h1>선택하세요</h1>
                <div class="selection-buttons">
                    <button class="selection-btn coupang-btn" onclick="goToCoupang()">
                        <img src="https://image7.coupangcdn.com/image/coupang/common/logo_coupang_w350.png" alt="Coupang">
                    </button>
                    <button class="selection-btn kurly-btn" onclick="goToKurly()">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODIiIGhlaWdodD0iNDIiIHZpZXdCb3g9IjAgMCA4MiA0MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+CiAgICAgICAgPHBhdGggZD0iTTAgMGg4MnY0MkgweiIvPgogICAgICAgIDxwYXRoIGQ9Ik02Mi41Ljk2NWMxLjAyNi0uNTU3IDIuNDY2LS43MTggMy4zNTYuMTA3Ljg5LjgyNS42NzYgMi4wNDggMCAzLjk3MyAwIDAtMS41MDUgNC4wNjYtMy4wNTUgOC4yNjJsLS4zOTggMS4wOGMtMS40MTQgMy44My0yLjc2MiA3LjQ4Ny0yLjkyNyA3Ljk2My0xLjQ5OCA0LjI0NSAxLjk2NyA0LjEyMiA0LjAyNC0uMTUyIDEuMTU5LTIuMzk0IDIuNjQ0LTYuMzU3IDIuNjQ0LTYuMzU3LjUyNC0xLjU2My42ODItMi41MDQuMzU5LTIuODI4LS4xMDctLjExMy4wNDUtLjI1Mi4xOC0uMzIzIDIuMjY5LTEuMTQ5IDQuNjMtLjA3MiAzLjMzNiAzLjMxbC0uMDU0LjEzOGMtLjM4Ny45NzgtMi42OCA2LjczMy0yLjY4IDYuNzMzLS42NzYgMS42Ni0uNTk1IDMuMjM2LjQxOCAzLjIzNi42ODYtLjAwNCAxLjQ2LS4zODUgMi4zMDQtMS4wODggMS44MTgtMS41MDQgMy4yMjItNC4zMTIgMy43MjctNS40NTQuMjMtLjUwOCAxLjA4Ny0yLjQyIDEuNzY2LTQuMzYxLjIzNi0uNjY1LjM2OS0xLjM2LjM5NS0yLjA2NWEuNDQzLjQ0MyAwIDAgMSAuMTk0LS40NTkgMy41NzggMy41NzggMCAwIDEgMS42Ny0uNDIgMS44MDUgMS44MDUgMCAwIDEgMS40NjUuNzA1Yy40NDMuNTk4LjU2NiAxLjU3OS4xMDMgMi44MDgtLjEyLjMyLTMuNzc1IDkuOTU4LTMuNzc1IDkuOTU4di4wMjZjMi4wNDEtMS4yMjMgMy44Ny0xLjMxMyA0Ljk1My0uODU0bC0uMDAzLS4wMTNjMS40OTUuNjQ3IDEuOTkgMi40NC45MzggMy41NTktLjEwMy4xMS0uMzYyLjA4NC0uMzYyLS4wOS0uMDk0LTEuMjUzLTIuNTE3LTMuNDk1LTYuMTA5LTEuMDc1bC0uMTQ1LjM4NS0xLjA2OCAyLjgwOGMtMi42MiA3LjAxOC01LjQwMyAxMi4xMzYtOS40MTUgMTEtMi42ODgtLjc2LTIuMzc3LTQuNjA3LjUxNS03Ljc5YTU0LjkgNTQuOSAwIDAgMSA2LjQ5LTUuODk4Yy4wNjgtLjE4OC4xMy0uMzUuMTg4LS41MTEuMjc4LS43OC40OTEtMS40MzQuNzkyLTIuMjY1bC4xNTktLjUxOGMtLjE3OC4yLS40OTguNTczLS43MTIuODEyLS43MTIuOC0yLjQ5NCAyLjc1Ny01LjMyOSAyLjIwN2wtLjIzNC0uMDUyYy0yLjA1LS41MDgtMi42MDgtMS45ODYtMi42NTUtMy4yNzctMi4xNDIgMi42NTYtNC4zNTEgMy40MjYtNS44MDcgMy4zOS0xLjk0OC0uMDQ4LTMuMzc4LTEuNTE0LTIuNDI3LTQuMjkgMS4wNTgtMy4xMDYgNS41LTE1LjMzMiA2Ljc5NS0xOSAuNDg1LTEuNTguNjY2LTIuNTguMTg0LTIuOTc0LS4xMjMtLjEwMy4wNTItLjI2NS4yLS4zNDZ6bTguMzY0IDI4Ljc3OGMtMS4xMDMuODgtNS41MjYgNC41My02Ljc1MiA3LjQ0MS0uNTA1IDEuMTk3LS4zNzYgMi4xNDkuNDg4IDIuMjMzIDEuOTYuMTk0IDQuMDEyLTMuODE4IDYuMjI4LTkuNTEyek0xNi4wMjggNS4zNTJjLS4wODcuMzMyLTEuMzE5IDMuODYtMi43MDEgNy43NDlsLS4yMDkuNTg2LS4yMS41ODktLjIxNS42MDRjNC42OTEtMS4xMjMgMTMuMDY0LTYuNTcgMTQuMDM1LTEwLjA4NS4xMi0uMTYxLjI5LS4yMi41NjYtLjAzNS40OTUuMzMuNjg2IDEuMTU1LjQ5NSAxLjkxOC0uNzY0IDMuMDM4LTYuNDE2IDcuMzQxLTExLjM3OSA5LjU1NC42MTIgMS42MzcgMi42ODIgNi4yNjcgNC4yMDYgOS4xMTEgMS42NjMgMy4xMTkgMy40MiA0LjU3NSA2LjE0NyA0LjczNyAxLjQ2LjA4NSAzLjAxNC0uNDQ3IDMuODkzLTEuMjJsLjE0OC0uMTQtLjAxMy4wM2MuMTk0LS4yMDQuNTExLjA3Ny4zNjYuMzIzYTYuNSA2LjUgMCAwIDEtNC45OTIgMi44NjdjLTYuMzQ1LjQyNy04Ljc3NC0zLjg3LTEzLjMwNC0xNC40OTQtLjM2Ni4xMjYtLjgwOS4yODgtMS4yNTUuNDUtLjA3NS4xODctMi4wNyA1LjY0Mi0yLjEzIDUuODIzLS45NDQgMi44Ny0xLjAwNSA0LjQ0Mi0uMzU4IDQuODk1LjE0NS4wOS4wNzQuMzMzLS4xNzguNDE0LTIuNTI3Ljc5Ni00Ljg1My0uNjk2LTMuNTU5LTQuNDQyIDEuMTYxLTMuMzE2IDUuNjktMTYuMTggNi45MTQtMTkuNjI2LjQyNy0xLjI5NC4xOTctMi4xMjUtLjQ5Mi0yLjMwNkM4LjUwNiAxLjc4Ljg3NyA4Ljc0OSAxLjk3MSAxNS4xODRjLjE5IDEuMTIuOTggMS43NDcgMS4zNzggMS42NjNhLjEzMy4xMzMgMCAwIDEgLjE1Ni4xNTkgMS41MDggMS41MDggMCAwIDEtMS44NDUgMS4wMzJDLjQ5IDE3Ljc4Mi4xMDcgMTYuNTI3LjA0MyAxNS44OC0uNjAxIDkuMjIgNi4xNDggMS4yMyAxMi4zODkuNThjMi4zNzgtLjI1IDQuNjEuOTYgMy42NCA0Ljc3MnptMjQuMDQgOS45MTMtLjA2LjIwNy0yLjgzIDguMTZjLS4zMDQuODUtLjEgMS43MzcuNTAxIDEuOTAyIDEuNzU3LjQ4MiA0LjAyOC0yLjE0NSA1LjEzMS00LjczM2E2Ny43OTQgNjcuNzk0IDAgMCAwIDEuNDc2LTMuODE1Yy41ODItMS42NDMgMS4xMDYtMy4xODMuNzgzLTMuOTA4LS4wNzUtLjE2OC4wNDUtLjI1Ni4yMjMtLjM1LjUwNS0uMjU1IDIuMjI2LS44MjUgMy4xNDEuMDY4LjY5NS42NzQuNjA5IDEuNzcxLS4wMyAzLjQzN2wtLjA5Ni4yNDIuMjItLjI3M2MyLjcwMy0zLjMgNC43OTItNC4yOTIgNi41NjMtMy41OTdsLjE0Ny4wNjJjMi4zODEgMS4wNzQgMS4xNDYgNS4yMTUtMi4xMTYgNS40OC0uMi4wMTctLjM1Ni0uMTI2LS4xNTgtLjQwNy4zOTUtLjYwNS4zNTYtMS45MDktLjc5Ni0yLjAyMi0xLjE1Mi0uMTEzLTIuODMgMS4yMDctNC4wMzggMi44NDQtMS4wODQgMS40NS0yLjIgMy45MTEtMy4zMjIgNy4yNzMtLjI3Mi44MTgtLjE0MyAxLjAxMi0uMTEgMS4wNjdhLjEuMSAwIDAgMSAwIC4wOTRjLS4xNDMuMjcyLS45NjUuNTk2LTEuNzYuNTk2LTEuNjI1LS4wMDctMi4yOTEtLjk0NS0xLjk2Ny0yLjQzNy0xLjg0OCAxLjc2NC0zLjcxMSAyLjYxNC01LjM1NSAyLjQ2NmEyLjUyNCAyLjUyNCAwIDAgMS0yLjIzNi0zLjEwM2MtMS40MjYgMS44MDktMy41NDIgMy4yNjgtNS42OTcgMy4wNjctMi4xNTUtLjItMy41LTEuNjY2LTIuODAyLTQuNzg4LjU5LTIuNTk4IDEuNTkyLTUuMjkgMi4yMDctNy4wMjcuNTE0LTEuNDU2LjYxOC0yLjQwNy4yOTQtMi43NS0uMTAzLS4xMTQuMDU1LS4yNS4xOTQtLjMyNCAxLjY5LS44ODYgNC4zOTQtLjMxNCAzLjYzIDIuMDktLjgwMiAyLjUyNy0yLjI1NSA2LjQ5LTIuNTUgNy40LS43MzcgMi4yODctLjI5IDMuNTIzLjc1NSAzLjU4IDEuMDQ1LjA2IDIuNDMtLjk2IDMuNDItMi41MDMgMS43Ni0yLjUyNCAyLjU4MS01LjY4NSAzLjM3Ny03Ljg4Mi4yMDQtLjU2LjUyNy0xLjg2Ni4xODUtMi4zNTItLjA5MS0uMTIzLjA2Ny0uMjU4LjI3NS0uMzcyIDEuNTM3LS44NDkgNC4yODUtLjY0IDMuNDAyIDIuNjA4eiIgZmlsbD0iIzVGMDA4MCIvPgogICAgPC9nPgo8L3N2Zz4K" alt="마켓컬리 로고">
                    </button>
                </div>
            </div>
        </div>

        <!-- 정류장 개수 입력 페이지 -->
        <div id="station-count-page" class="hidden">
            <!-- 저장된 노선 목록 -->
            <div class="station-count-input" style="margin-bottom: 20px;">
                <h2>저장된 노선</h2>
                <div id="saved-routes-container">
                    <p style="color: #999; text-align: center; margin: 10px 0;">저장된 노선이 없습니다.</p>
                </div>
            </div>
            
            <div class="station-count-input">
                <h2>노선 정보를 입력하세요</h2>
                <div style="margin-bottom: 20px;">
                    <label for="route-name" style="display: block; margin-bottom: 10px; font-size: 1.1rem;">노선 이름:</label>
                    <input type="text" id="route-name" placeholder="예: 명지2 노선" class="number-input" style="width: 300px;" lang="ko" ime-mode="active">
                </div>
                <h3>정류장 개수를 입력하세요</h3>
                <input type="number" id="station-count" min="1" max="20" placeholder="정류장 개수" class="number-input" oninput="updateStationCount()">
                <button id="count-submit" class="submit-btn" onclick="submitStationCount()" disabled>확인</button>
            </div>
        </div>

        <!-- 컬리 정류장 개수 입력 페이지 -->
        <div id="kurly-station-count-page" class="hidden">
            <!-- 저장된 노선 목록 -->
            <div class="station-count-input" style="margin-bottom: 20px;">
                <h2>저장된 노선</h2>
                <div id="kurly-saved-routes-container">
                    <p style="color: #999; text-align: center; margin: 10px 0;">저장된 노선이 없습니다.</p>
                </div>
            </div>
            
            <div class="station-count-input">
                <h2>노선 정보를 입력하세요</h2>
                <div style="margin-bottom: 20px;">
                    <label for="kurly-route-name" style="display: block; margin-bottom: 10px; font-size: 1.1rem;">노선 이름:</label>
                    <input type="text" id="kurly-route-name" placeholder="예: 명지2 노선" class="number-input" style="width: 300px;" lang="ko" ime-mode="active">
                </div>
                <h3>정류장 개수를 입력하세요</h3>
                <input type="number" id="kurly-station-count" min="1" max="20" placeholder="정류장 개수" class="number-input" oninput="updateKurlyStationCount()">
                <button id="kurly-count-submit" class="submit-btn" onclick="submitKurlyStationCount()" disabled>확인</button>
            </div>
        </div>

        <!-- 컬리 정류장 이름 입력 페이지 -->
        <div id="kurly-station-names-page" class="hidden">
            <div class="station-names-input">
                <h2>정류장 이름을 입력하세요</h2>
                <div id="kurly-station-inputs" class="station-inputs"></div>
                <div class="button-group">
                    <button id="kurly-add-station" class="add-station-btn" onclick="addKurlyStation()"><span class="button-text-top">정류장</span><br><span class="button-text-bottom">추가</span></button>
                    <button id="kurly-start-counting" class="start-btn" onclick="startKurlyCounting()" disabled><span class="button-text-top">카운팅</span><br><span class="button-text-bottom">시작</span></button>
                    <button id="kurly-save-route" class="save-btn" onclick="saveKurlyRoute()" disabled><span class="button-text-top">노선</span><br><span class="button-text-bottom">저장</span></button>
                    <button onclick="resetKurlySetup()" class="reset-btn"><span class="button-text-top">처음</span><br><span class="button-text-bottom">으로</span></button>
                </div>
            </div>
        </div>

        <!-- 정류장 이름 입력 페이지 -->
        <div id="station-names-page" class="hidden">
            <div class="station-names-input">
                <h2>정류장 이름을 입력하세요</h2>
                <div id="station-inputs" class="station-inputs"></div>
                <div class="button-group">
                    <button id="start-counting" class="start-btn" onclick="startCounting()" disabled><span class="button-text-top">카운팅</span><br><span class="button-text-bottom">시작</span></button>
                    <button id="save-route" class="save-btn" onclick="saveRoute()" disabled><span class="button-text-top">노선</span><br><span class="button-text-bottom">저장</span></button>
                    <button onclick="resetSetup()" class="reset-btn"><span class="button-text-top">처음</span><br><span class="button-text-bottom">으로</span></button>
                </div>
            </div>
        </div>

        <!-- 키패드 페이지 -->
        <div id="keypad-page" class="hidden">
            <div class="current-station">
                <h2 id="current-station-name">현재 정류장: </h2>
                <p id="current-station-count">총 탑승자수: 0</p>
            </div>

            <!-- 시간대 토글 버튼 -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button id="morning-btn-keypad" class="time-period-btn active" onclick="selectTimePeriod('morning')">오전 운행</button>
                    <button id="afternoon-btn-keypad" class="time-period-btn" onclick="selectTimePeriod('afternoon')">오후 운행</button>
                    <button id="evening-btn-keypad" class="time-period-btn" onclick="selectTimePeriod('evening')" style="display: none;">퇴근운행</button>
                </div>
            </div>
            
            <!-- 택시 인원 추가 버튼 (쿠팡 전용, 45명 이상일 때만 표시) -->
            <div id="taxi-passenger-section" style="display: none; margin-top: 15px; margin-bottom: 15px; text-align: center;">
                <button id="add-taxi-btn" onclick="addTaxiPassenger()" class="taxi-btn" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);">
                    택시 인원 추가
                </button>
                <div id="taxi-passenger-count" style="margin-top: 10px; color: white; font-size: 1rem;">
                    택시 인원: <span id="taxi-count-display">0</span>명
                </div>
            </div>

            <div class="clock-display">
                <div id="clock-time" class="clock-time">00:00:00</div>
                <div id="clock-date" class="clock-date">2024년 1월 1일 월요일</div>
            </div>

            <div class="input-display">
                <div id="number-display" class="number-display">0</div>
            </div>

            <div class="keypad">
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="inputDigit('1')">1</button>
                    <button class="keypad-btn" onclick="inputDigit('2')">2</button>
                    <button class="keypad-btn" onclick="inputDigit('3')">3</button>
                </div>
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="inputDigit('4')">4</button>
                    <button class="keypad-btn" onclick="inputDigit('5')">5</button>
                    <button class="keypad-btn" onclick="inputDigit('6')">6</button>
                </div>
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="inputDigit('7')">7</button>
                    <button class="keypad-btn" onclick="inputDigit('8')">8</button>
                    <button class="keypad-btn" onclick="inputDigit('9')">9</button>
                </div>
                <div class="keypad-row">
                    <button class="keypad-btn" onclick="clearInput()">C</button>
                    <button class="keypad-btn" onclick="inputDigit('0')">0</button>
                    <button class="keypad-btn" onclick="backspace()">⌫</button>
                </div>
                <div class="keypad-row">
                    <button class="enter-btn" onclick="enterNumber()">ENTER</button>
                </div>
                <div class="keypad-row" id="arrival-time-row" style="display: none; width: 100%; max-width: 100%; margin: 0; padding: 0 10px;">
                    <button id="arrival-time-btn" class="enter-btn" onclick="recordArrivalTime()" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); width: 100%; max-width: 100%; margin: 0;">도착시간</button>
                </div>
            </div>

            <div class="station-summary">
                <h3>정류장별 카운트</h3>
                <div id="summary-list" class="summary-list"></div>
            </div>

            <div class="reset-buttons">
                <button onclick="deletePreviousStation()" class="delete-previous-btn">직전 정류장 삭제</button>
                <button onclick="resetCounts()" class="reset-counts-btn">정류장 명수 초기화</button>
            </div>

            <div class="share-buttons">
                <button onclick="generateAndShareImage()" class="share-btn" id="kakao-share-btn">
                    📱 카카오톡 공유
                </button>
                <button onclick="resetApp()" class="reset-btn" id="reset-to-start">
                    처음으로
                </button>
                <button id="vehicle-status-btn-keypad" onclick="openVehicleStatus()" class="vehicle-status-btn">
                    입차현황
                </button>
            </div>
        </div>
    </div>

    <!-- 차량입차현황 선택 페이지 -->
    <div id="vehicle-status-page" class="hidden vehicle-status-page">
        <div class="station-count-input" style="width: 100%; max-width: 400px; text-align: center;">
            <h2 style="margin-bottom: 40px; font-size: 2rem; color: white;">저장된 센터</h2>
            <div style="display: flex; flex-direction: column; gap: 20px; align-items: center;">
                <button onclick="openChangwonVehicleStatus()" style="width: 90%; max-width: 350px; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; font-size: 1.3rem; font-weight: bold; padding: 20px 30px; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3); transition: all 0.3s ease;">
                    창원1센터 입차현황
                </button>
                <button onclick="openChangwon3Center()" style="width: 90%; max-width: 350px; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; font-size: 1.3rem; font-weight: bold; padding: 20px 30px; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3); transition: all 0.3s ease;">
                    창원3센터 입차현황
                </button>
                <button onclick="openChangwon4Center()" style="width: 90%; max-width: 350px; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; font-size: 1.3rem; font-weight: bold; padding: 20px 30px; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3); transition: all 0.3s ease;">
                    창원4센터 입차현황
                </button>
                <button onclick="goBackToKeypad()" style="width: 90%; max-width: 350px; background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); color: white; font-size: 1.3rem; font-weight: bold; padding: 20px 30px; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 8px 20px rgba(244, 67, 54, 0.3); transition: all 0.3s ease;">
                    카운터로돌아가기
                </button>
            </div>
        </div>
    </div>

    <!-- 차량현황 페이지 (창원1센터) -->
    <div id="vehicle-status-1-page" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; overflow: hidden; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="theme-toggle-area" style="background: transparent; box-shadow: rgba(0, 0, 0, 0) 0px 2px 10px;">
            <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙</button>
        </div>
        <div style="height: 100%; overflow-y: auto; overflow-x: hidden;">
        <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
            <div id="contentBox1" style="background: transparent; border-radius: 10px; padding: 30px;">
                <h1 id="title1" style="text-align: center; margin-bottom: 30px; color: #333;">🚌 창원1센터 입차현황</h1>
                
                <div id="statsBox1" style="display: flex; justify-content: space-around; margin-bottom: 30px; padding: 20px; background-color: #e3f2fd; border-radius: 6px;">
                    <div style="text-align: center; flex: 1;">
                        <div id="totalCount1" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="totalLabel1" style="margin-top: 5px;">전체 노선</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div id="selectedCount1" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="selectedLabel1" style="margin-top: 5px;">선택된 노선</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div id="excludedCount1" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="excludedLabel1" style="margin-top: 5px;">제외된 노선</div>
                    </div>
                </div>
                
                <div id="routeGrid1" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;"></div>
                
                <div style="position: relative; background: #f5f5f5; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="font-weight: bold; margin-bottom: 10px;">📋 현재 상태</div>
                    <button style="position: absolute; top: 10px; right: 10px; background: #FFD700; color: black; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;" onclick="shareToKakao1()">📱 카카오톡 공유</button>
                    <div id="statusText1" style="margin-top: 40px;">노선을 선택해주세요.</div>
                </div>
                
                <button style="width: 100%; background: #4CAF50; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-bottom: 15px;" onclick="resetSelection1()">🔄 선택 초기화</button>
                
                <button style="width: 100%; background: #f44336; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; cursor: pointer;" onclick="goBackToCounter1()">🔙 카운터로 돌아가기</button>
            </div>
            </div>
        </div>
    </div>

    <!-- 차량현황 페이지 (창원3센터) -->
    <div id="vehicle-status-3-page" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; overflow: hidden; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="theme-toggle-area" style="background: transparent; box-shadow: rgba(0, 0, 0, 0) 0px 2px 10px;">
            <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙</button>
        </div>
        <div style="height: 100%; overflow-y: auto; overflow-x: hidden;">
        <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
            <div id="contentBox3" style="background: transparent; border-radius: 10px; padding: 30px;">
                <h1 id="title3" style="text-align: center; margin-bottom: 30px; color: #333;">🚌 창원3센터 입차현황</h1>
                
                <div id="statsBox3" style="display: flex; justify-content: space-around; margin-bottom: 30px; padding: 20px; background-color: #e3f2fd; border-radius: 6px;">
                    <div style="text-align: center; flex: 1;">
                        <div id="totalCount3" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="totalLabel3" style="margin-top: 5px;">전체 노선</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div id="selectedCount3" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="selectedLabel3" style="margin-top: 5px;">선택된 노선</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div id="excludedCount3" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="excludedLabel3" style="margin-top: 5px;">제외된 노선</div>
                    </div>
                </div>
                
                <div id="routeGrid3" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;"></div>
                
                <div style="position: relative; background: #f5f5f5; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="font-weight: bold; margin-bottom: 10px;">📋 현재 상태</div>
                    <button style="position: absolute; top: 10px; right: 10px; background: #FFD700; color: black; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;" onclick="shareToKakao3()">📱 카카오톡 공유</button>
                    <div id="statusText3" style="margin-top: 40px;">노선을 선택해주세요.</div>
                </div>
                
                <button style="width: 100%; background: #4CAF50; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-bottom: 15px;" onclick="resetSelection3()">🔄 선택 초기화</button>
                
                <button style="width: 100%; background: #f44336; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; cursor: pointer;" onclick="goBackToCounter3()">🔙 카운터로 돌아가기</button>
            </div>
            </div>
        </div>
    </div>

    <!-- 차량현황 페이지 (창원4센터) -->
    <div id="vehicle-status-4-page" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; overflow: hidden; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="theme-toggle-area" style="background: transparent; box-shadow: rgba(0, 0, 0, 0) 0px 2px 10px;">
            <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">🌙</button>
        </div>
        <div style="height: 100%; overflow-y: auto; overflow-x: hidden;">
        <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
            <div id="contentBox4" style="background: transparent; border-radius: 10px; padding: 30px;">
                <h1 id="title4" style="text-align: center; margin-bottom: 30px; color: #333;">🚌 창원4센터 입차현황</h1>
                
                <div id="statsBox4" style="display: flex; justify-content: space-around; margin-bottom: 30px; padding: 20px; background-color: #e3f2fd; border-radius: 6px;">
                    <div style="text-align: center; flex: 1;">
                        <div id="totalCount4" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="totalLabel4" style="margin-top: 5px;">전체 노선</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div id="selectedCount4" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="selectedLabel4" style="margin-top: 5px;">선택된 노선</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div id="excludedCount4" style="font-size: 28px; font-weight: bold; color: #1976d2;">0</div>
                        <div id="excludedLabel4" style="margin-top: 5px;">제외된 노선</div>
                    </div>
                </div>
                
                <div id="routeGrid4" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;"></div>
                
                <div style="position: relative; background: #f5f5f5; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="font-weight: bold; margin-bottom: 10px;">📋 현재 상태</div>
                    <button style="position: absolute; top: 10px; right: 10px; background: #FFD700; color: black; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;" onclick="shareToKakao4()">📱 카카오톡 공유</button>
                    <div id="statusText4" style="margin-top: 40px;">노선을 선택해주세요.</div>
                </div>
                
                <button style="width: 100%; background: #4CAF50; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-bottom: 15px;" onclick="resetSelection4()">🔄 선택 초기화</button>
                
                <button style="width: 100%; background: #f44336; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; cursor: pointer;" onclick="goBackToCounter4()">🔙 카운터로 돌아가기</button>
            </div>
            </div>
        </div>
    </div>

    <!-- 공지사항 모달 (사용자용) -->
    <div id="notice-modal" class="notice-modal">
        <div class="notice-modal-content">
            <div style="margin-bottom: 20px;">
                <h2 style="margin: 0 0 15px 0; font-size: 1.5rem;" class="notice-title">📢 공지사항</h2>
            </div>
            <div id="notice-content-display" style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 25px;" class="notice-content">
                <!-- 공지사항 내용이 여기에 동적으로 표시됩니다 -->
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; cursor: pointer; user-select: none;" class="notice-label">
                    <input type="checkbox" id="dont-show-today" style="margin-right: 8px; cursor: pointer;">
                    <span style="font-size: 0.9rem;" class="notice-checkbox-text">오늘 하루 표시 안 함</span>
                </label>
            </div>
            <button onclick="closeNoticeModal()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                확인
            </button>
        </div>
    </div>

    <!-- 이미지 미리보기 모달 -->
    <div id="image-modal" class="image-modal">
        <button class="modal-close" onclick="closeImageModal()">&times;</button>
        <div class="image-modal-content">
            <img id="generated-image" src="" alt="생성된 이미지">
        </div>
    </div>

    <script>
        // 전역 변수
        let stations = [];
        let stationNames = [];
        let currentStationIndex = 0;
        let currentInput = '';
        let stationCount = 0;
        let isDarkMode = false;
        let routeName = '';
        let stationDepartureTimes = [];
        let selectedTimePeriod = 'morning'; // 'morning', 'afternoon', 또는 'evening'
        let isLoadedRoute = false; // 불러온 노선인지 추적
        let completedTimePeriods = { morning: false, afternoon: false, evening: false }; // 완료된 운행 시간대 추적
        let currentService = 'coupang'; // 'coupang' 또는 'kurly' - 현재 선택된 서비스
        let isEveningMode = false; // 퇴근운행 모드 (역순 카운트)
        let morningArrivalTime = null; // 14시운행 도착시간
        let afternoonArrivalTime = null; // 17시운행 도착시간
        let eveningArrivalTime = null; // 퇴근운행 도착시간
        let taxiPassengers = { morning: 0, afternoon: 0, evening: 0 }; // 택시 인원 (쿠팡/컬리 공용)
        let taxiInput = ''; // 택시 인원 입력 임시 저장
        
        // Firebase 초기화 (공지사항 동기화용)
        // TODO: 아래 Firebase 설정을 본인의 Firebase 프로젝트 정보로 변경해주세요
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // Firebase 초기화 (설정이 없으면 localStorage 사용)
        let database = null;
        try {
            if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
            }
        } catch (e) {
            console.log('Firebase 초기화 실패, localStorage 사용:', e);
        }

        // 다크모드 토글 함수
        window.toggleTheme = function() {
            isDarkMode = !isDarkMode;
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            
            if (isDarkMode) {
                body.classList.add('dark-mode');
                themeToggle.textContent = '☀️';
                localStorage.setItem('darkMode', 'true');
            } else {
                body.classList.remove('dark-mode');
                themeToggle.textContent = '🌙';
                localStorage.setItem('darkMode', 'false');
            }
            
            // 입차현황 페이지가 열려있으면 다크모드 업데이트
            const vehicleStatus1Page = document.getElementById('vehicle-status-1-page');
            const vehicleStatus3Page = document.getElementById('vehicle-status-3-page');
            const vehicleStatus4Page = document.getElementById('vehicle-status-4-page');
            
            if (vehicleStatus1Page && !vehicleStatus1Page.classList.contains('hidden')) {
                updateVehicleStatusDarkMode();
            }
            if (vehicleStatus3Page && !vehicleStatus3Page.classList.contains('hidden')) {
                updateVehicleStatusDarkMode();
            }
            if (vehicleStatus4Page && !vehicleStatus4Page.classList.contains('hidden')) {
                updateVehicleStatusDarkMode();
            }
            
            // 다크모드 버튼 자동 숨김 (5초 후)
            hideThemeButton();
        }

        // 다크모드 버튼 자동 숨김 함수
        function hideThemeButton() {
            const themeToggle = document.getElementById('theme-toggle');
            if (!themeToggle) return;
            
            // 기존 타이머가 있으면 클리어
            if (window.themeHideTimer) {
                clearTimeout(window.themeHideTimer);
            }
            
            // 5초 후 버튼 숨김
            window.themeHideTimer = setTimeout(() => {
                themeToggle.classList.add('hidden');
            }, 5000);
        }

        // 다크모드 버튼 다시 보이기 함수
        function showThemeButton() {
            const themeToggle = document.getElementById('theme-toggle');
            if (!themeToggle) return;
            
            themeToggle.classList.remove('hidden');
            
            // 다시 숨김 타이머 설정
            hideThemeButton();
        }

        // 다크모드 버튼 영역에 마우스 오버 시 버튼 다시 보이기
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggleArea = document.querySelector('.theme-toggle-area');
            if (themeToggleArea) {
                themeToggleArea.addEventListener('mouseenter', function() {
                    showThemeButton();
                });
            }
            
            // 왼쪽 상단 관리자 트리거 설정
            setupAdminTrigger();
        });

        // 관리자 비밀번호 (기본값: admin123, 나중에 변경 가능)
        const ADMIN_PASSWORD = 'admin123';
        let adminClickCount = 0;
        let adminClickTimer = null;

        // 왼쪽 상단 클릭 감지 설정
        function setupAdminTrigger() {
            const adminTriggerArea = document.getElementById('admin-trigger-area');
            if (adminTriggerArea) {
                adminTriggerArea.addEventListener('click', function() {
                    adminClickCount++;
                    
                    // 타이머 리셋
                    if (adminClickTimer) {
                        clearTimeout(adminClickTimer);
                    }
                    
                    // 3초 내에 5번 클릭하면 비밀번호 모달 열기
                    adminClickTimer = setTimeout(() => {
                        adminClickCount = 0;
                    }, 3000);
                    
                    if (adminClickCount >= 5) {
                        adminClickCount = 0;
                        clearTimeout(adminClickTimer);
                        openPasswordModal();
                    }
                });
            }
        }

        // 비밀번호 모달 열기
        function openPasswordModal() {
            const modal = document.getElementById('password-modal');
            if (modal) {
                modal.classList.add('show');
                document.getElementById('admin-password').focus();
            }
        }

        // 비밀번호 모달 닫기
        function closePasswordModal() {
            const modal = document.getElementById('password-modal');
            if (modal) {
                modal.classList.remove('show');
                document.getElementById('admin-password').value = '';
                adminClickCount = 0;
                if (adminClickTimer) {
                    clearTimeout(adminClickTimer);
                }
            }
        }

        // 비밀번호 확인
        window.checkAdminPassword = function() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                closePasswordModal();
                openNoticeAdmin();
            } else {
                alert('비밀번호가 일치하지 않습니다.');
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-password').focus();
            }
        };

        // 공지사항 관리 모달 열기
        function openNoticeAdmin() {
            const modal = document.getElementById('notice-admin-modal');
            if (modal) {
                modal.classList.add('show');
                loadNotices();
            }
        }

        // 공지사항 관리 모달 닫기
        window.closeNoticeAdmin = function() {
            const modal = document.getElementById('notice-admin-modal');
            if (modal) {
                modal.classList.remove('show');
                // 입력 필드 초기화
                document.getElementById('notice-title').value = '';
                document.getElementById('notice-content').value = '';
            }
        };

        // 공지사항 저장
        window.saveNotice = function() {
            const title = document.getElementById('notice-title').value.trim();
            // 줄바꿈을 유지하기 위해 trim()을 제거하고, 앞뒤 공백만 제거
            let content = document.getElementById('notice-content').value;
            // 앞뒤 공백만 제거 (줄바꿈은 유지)
            content = content.replace(/^\s+|\s+$/g, '');
            
            if (!title || !content) {
                alert('제목과 내용을 모두 입력해주세요.');
                return;
            }
            
            const newNotice = {
                id: Date.now(),
                title: title,
                content: content, // 줄바꿈이 포함된 원본 내용 저장
                createdAt: new Date().toISOString()
            };
            
            // Firebase가 설정되어 있으면 Firebase에 저장, 아니면 localStorage에 저장
            if (database) {
                database.ref('notices').once('value', (snapshot) => {
                    const notices = snapshot.val() || [];
                    notices.push(newNotice);
                    database.ref('notices').set(notices).then(() => {
                        alert('공지사항이 저장되었습니다. (모든 사용자에게 동기화됩니다)');
                        document.getElementById('notice-title').value = '';
                        document.getElementById('notice-content').value = '';
                        loadNotices();
                    }).catch((error) => {
                        console.error('Firebase 저장 실패:', error);
                        alert('저장에 실패했습니다. localStorage에 저장합니다.');
                        // 실패 시 localStorage에 저장
                        const localNotices = JSON.parse(localStorage.getItem('notices') || '[]');
                        localNotices.push(newNotice);
                        localStorage.setItem('notices', JSON.stringify(localNotices));
                        loadNotices();
                    });
                });
            } else {
                // localStorage 사용
                const notices = JSON.parse(localStorage.getItem('notices') || '[]');
            notices.push(newNotice);
            localStorage.setItem('notices', JSON.stringify(notices));
                alert('공지사항이 저장되었습니다. (현재 기기에만 저장됩니다)');
            document.getElementById('notice-title').value = '';
            document.getElementById('notice-content').value = '';
            loadNotices();
            }
        };

        // 공지사항 목록 불러오기
        function loadNotices() {
            const noticeList = document.getElementById('notice-list');
            
            if (database) {
                // Firebase에서 불러오기
                database.ref('notices').on('value', (snapshot) => {
                    const notices = snapshot.val() || [];
                    displayNotices(notices);
                });
            } else {
                // localStorage에서 불러오기
            const notices = JSON.parse(localStorage.getItem('notices') || '[]');
                displayNotices(notices);
            }
        }
        
        // 공지사항 표시 함수
        function displayNotices(notices) {
            const noticeList = document.getElementById('notice-list');
            
            if (notices.length === 0) {
                noticeList.innerHTML = '<p style="text-align: center; color: #999;">등록된 공지사항이 없습니다.</p>';
                return;
            }
            
            noticeList.innerHTML = notices.map(notice => `
                <div class="notice-item">
                    <div class="notice-item-title">${escapeHtml(notice.title)}</div>
                    <div class="notice-item-content">${escapeHtml(notice.content)}</div>
                    <div class="notice-item-actions">
                        <button class="notice-btn delete" onclick="deleteNotice(${notice.id})">삭제</button>
                    </div>
                </div>
            `).join('');
        }

        // 공지사항 삭제
        window.deleteNotice = function(id) {
            if (confirm('이 공지사항을 삭제하시겠습니까?')) {
                if (database) {
                    // Firebase에서 삭제
                    database.ref('notices').once('value', (snapshot) => {
                        const notices = snapshot.val() || [];
                        const filteredNotices = notices.filter(notice => notice.id !== id);
                        database.ref('notices').set(filteredNotices).then(() => {
                            loadNotices();
                        }).catch((error) => {
                            console.error('Firebase 삭제 실패:', error);
                            alert('삭제에 실패했습니다.');
                        });
                    });
                } else {
                    // localStorage에서 삭제
                const notices = JSON.parse(localStorage.getItem('notices') || '[]');
                const filteredNotices = notices.filter(notice => notice.id !== id);
                localStorage.setItem('notices', JSON.stringify(filteredNotices));
                loadNotices();
                }
            }
        };

        // HTML 이스케이프 함수
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 모달 외부 클릭 시 닫기
        document.getElementById('password-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePasswordModal();
            }
        });

        document.getElementById('notice-admin-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNoticeAdmin();
            }
        });

        // Enter 키로 비밀번호 확인
        document.getElementById('admin-password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAdminPassword();
            }
        });

        // 차량입차현황 페이지 열기
        window.openVehicleStatus = function() {
            const keypadPage = document.getElementById('keypad-page');
            const vehicleStatusPage = document.getElementById('vehicle-status-page');
            
            if (keypadPage) {
                keypadPage.classList.add('hidden');
                keypadPage.style.display = 'none';
            }
            if (vehicleStatusPage) {
                vehicleStatusPage.classList.remove('hidden');
                vehicleStatusPage.style.display = 'block';
            }
            hideThemeButton();
        };

        // 키패드로 돌아가기
        window.goBackToKeypad = function() {
            const vehicleStatusPage = document.getElementById('vehicle-status-page');
            const keypadPage = document.getElementById('keypad-page');
            
            if (vehicleStatusPage) {
                vehicleStatusPage.classList.add('hidden');
                vehicleStatusPage.style.display = 'none';
            }
            if (keypadPage) {
                keypadPage.classList.remove('hidden');
                keypadPage.style.display = 'block';
            }
            hideThemeButton();
        };

        // 창원1센터 입차현황 열기
        // 창원1센터 차량입차현황 앱 열기
        window.openChangwonVehicleStatus = function() {
            document.getElementById('vehicle-status-page').classList.add('hidden');
            document.getElementById('vehicle-status-page').style.display = 'none';
            document.getElementById('vehicle-status-1-page').classList.remove('hidden');
            document.getElementById('vehicle-status-1-page').style.display = 'block';
            initializeVehicleStatus1();
        };

        // 창원3센터 차량입차현황 앱 열기
        window.openChangwon3Center = function() {
            document.getElementById('vehicle-status-page').classList.add('hidden');
            document.getElementById('vehicle-status-page').style.display = 'none';
            document.getElementById('vehicle-status-3-page').classList.remove('hidden');
            document.getElementById('vehicle-status-3-page').style.display = 'block';
            initializeVehicleStatus3();
        };

        // 창원4센터 차량입차현황 앱 열기
        window.openChangwon4Center = function() {
            document.getElementById('vehicle-status-page').classList.add('hidden');
            document.getElementById('vehicle-status-page').style.display = 'none';
            document.getElementById('vehicle-status-4-page').classList.remove('hidden');
            document.getElementById('vehicle-status-4-page').style.display = 'block';
            initializeVehicleStatus4();
        };

        // 차량현황 페이지 다크모드 업데이트
        function updateVehicleStatusDarkMode() {
            const pages = ['vehicle-status-1-page', 'vehicle-status-3-page', 'vehicle-status-4-page'];
            
            pages.forEach(pageId => {
                const page = document.getElementById(pageId);
                if (!page) return;
                
                // 토글 버튼 아이콘 변경
                const themeToggle = page.querySelector('.theme-toggle');
                if (themeToggle) {
                    themeToggle.textContent = isDarkMode ? '☀️' : '🌙';
                }
                
                const bgStyle = isDarkMode 
                    ? 'background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);'
                    : 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
                page.setAttribute('style', page.getAttribute('style').replace(/background:.*?;/, bgStyle));
                
                // 컨테이너
                const container = page.querySelector('div > div');
                if (container) {
                    const bgColor = 'transparent';
                    const boxShadow = 'none';
                    container.style.background = bgColor;
                    container.style.boxShadow = boxShadow;
                }
                
                // h1
                const h1 = page.querySelector('h1');
                if (h1) h1.style.color = isDarkMode ? '#fff' : '#333';
                
                // contentBox 배경색 업데이트
                const contentBoxes = ['contentBox1', 'contentBox3', 'contentBox4'];
                contentBoxes.forEach(boxId => {
                    const box = document.getElementById(boxId);
                    if (box) {
                        box.style.background = isDarkMode ? 'rgba(255,255,255,0.1)' : 'transparent';
                    }
                });
                
                // 통계 배경색 및 텍스트 색상
                const allDivs = page.querySelectorAll('div');
                allDivs.forEach(div => {
                    const style = div.getAttribute('style') || '';
                    if (style.includes('background-color: #e3f2fd')) {
                        div.style.background = isDarkMode ? 'rgba(255,255,255,0.1)' : '#e3f2fd';
                    }
                    if (style.includes('background: #f5f5f5')) {
                        div.style.background = isDarkMode ? 'rgba(255,255,255,0.1)' : '#f5f5f5';
                    }
                });
                
                // 통계 박스 배경색 직접 업데이트
                const statsBox1 = document.getElementById('statsBox1');
                const statsBox3 = document.getElementById('statsBox3');
                const statsBox4 = document.getElementById('statsBox4');
                [statsBox1, statsBox3, statsBox4].forEach(box => {
                    if (box) {
                        box.style.background = isDarkMode ? 'rgba(255,255,255,0.1)' : '#e3f2fd';
                    }
                });
                
                // 통계 라벨과 숫자 색상
                for (let i = 1; i <= 4; i++) {
                    const totalLabel = document.getElementById(`totalLabel${i}`);
                    const selectedLabel = document.getElementById(`selectedLabel${i}`);
                    const excludedLabel = document.getElementById(`excludedLabel${i}`);
                    const totalCount = document.getElementById(`totalCount${i}`);
                    const selectedCount = document.getElementById(`selectedCount${i}`);
                    const excludedCount = document.getElementById(`excludedCount${i}`);
                    
                    if (totalLabel) totalLabel.style.color = isDarkMode ? '#fff' : '#333';
                    if (selectedLabel) selectedLabel.style.color = isDarkMode ? '#fff' : '#333';
                    if (excludedLabel) excludedLabel.style.color = isDarkMode ? '#fff' : '#333';
                    if (totalCount) totalCount.style.color = isDarkMode ? '#fff' : '#1976d2';
                    if (selectedCount) selectedCount.style.color = isDarkMode ? '#fff' : '#1976d2';
                    if (excludedCount) excludedCount.style.color = isDarkMode ? '#fff' : '#1976d2';
                }
                
                const statusText = page.querySelectorAll('div[style*="margin-top: 40px"], div[style*="font-weight: bold"][style*="margin-bottom: 10px"]');
                statusText.forEach(text => {
                    // 현재 색상이 녹색이나 빨간색이 아니면만 색상 적용
                    const currentColor = text.style.color || '';
                    if (!currentColor.includes('rgb(46, 125, 50)') && 
                        !currentColor.includes('rgb(244, 67, 54)') && 
                        !currentColor.includes('#2e7d32') && 
                        !currentColor.includes('#f44336')) {
                        if (isDarkMode) {
                            text.style.color = '#fff';
                        } else {
                            text.style.color = '#333';
                        }
                    }
                });
                
                // 카카오톡 공유 버튼 텍스트 색상 유지 (항상 검정색)
                const kakaoButtons = page.querySelectorAll('button[style*="background: #FFD700"]');
                kakaoButtons.forEach(btn => {
                    btn.style.color = 'black';
                });
                
                // 노선 버튼들
                const routeItems = page.querySelectorAll('.route-item');
                routeItems.forEach(item => {
                    // selected 클래스 확인
                    const isSelected = item.classList.contains('selected');
                    
                    if (isSelected) {
                        // 선택된 항목은 다크모드에서도 초록색으로 밝게 표시
                        item.style.setProperty('background-color', '#4CAF50', 'important');
                        item.style.setProperty('border-color', '#4CAF50', 'important');
                        item.style.setProperty('color', '#fff', 'important');
                        item.style.setProperty('font-weight', 'bold', 'important');
                    } else {
                        item.style.setProperty('background-color', isDarkMode ? 'rgba(255,255,255,0.2)' : 'white', 'important');
                        item.style.setProperty('border-color', isDarkMode ? 'rgba(255,255,255,0.3)' : '#ddd', 'important');
                        item.style.setProperty('color', isDarkMode ? '#fff' : '#333', 'important');
                    }
                });
                
                // 상태 섹션 배경 및 텍스트
                const statusSection = page.querySelector('div[style*="background: #f5f5f5"]');
                if (statusSection) {
                    statusSection.style.background = isDarkMode ? 'rgba(255,255,255,0.1)' : '#f5f5f5';
                    const statusText = statusSection.querySelector('div[style*="margin-top: 40px"]');
                    if (statusText) {
                        statusText.style.color = isDarkMode ? '#fff' : '#333';
                    }
                    const statusTitle = statusSection.querySelector('div[style*="font-weight: bold"]');
                    if (statusTitle) {
                        statusTitle.style.color = isDarkMode ? '#fff' : '#333';
                    }
                }
            });
        }

        // 차량현황 1센터 페이지 초기화
        function initializeVehicleStatus1() {
            updateVehicleStatusDarkMode(); // 다크모드 초기화
            
            // 메인 다크모드 버튼 숨김 처리
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                // 기존 타이머가 있으면 클리어
                if (window.vehicleStatusThemeHideTimer) {
                    clearTimeout(window.vehicleStatusThemeHideTimer);
                }
                
                // 5초 후 버튼 숨김
                window.vehicleStatusThemeHideTimer = setTimeout(() => {
                    themeToggle.style.opacity = '0';
                    themeToggle.style.transform = 'translateX(100px)';
                    themeToggle.style.pointerEvents = 'none';
                }, 5000);
            }
            
            const routes = [
                "거제1", "거제2", "김해1", "내서", "남포", "남포1-1", "다대1", "동래", "마산1", "마산2",
                "명지1", "명지2", "부암", "서면", "서면2", "수영", "장유", "함안"
            ].sort();
            
            const routeGrid = document.getElementById("routeGrid1");
            routeGrid.innerHTML = '';
            
            window.selectedRoutes1 = new Set();
            
            routes.forEach(route => {
                const routeItem = document.createElement("div");
                routeItem.className = "route-item";
                routeItem.textContent = route;
                routeItem.style.cssText = "display: flex; align-items: center; justify-content: center; padding: 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white; font-size: 18px; font-weight: 500; color: #333; min-height: 70px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;";
                routeItem.onclick = (e) => toggleRoute1(route, e);
                routeGrid.appendChild(routeItem);
            });
            
            updateStats1();
        }

        // 노선 선택/해제 토글
        function toggleRoute1(route, event) {
            const routeItem = event.target;
            
            // 진동 실행
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            
            if (window.selectedRoutes1.has(route)) {
                window.selectedRoutes1.delete(route);
                routeItem.classList.remove("selected");
                if (isDarkMode) {
                    routeItem.style.borderColor = "rgba(255,255,255,0.3)";
                    routeItem.style.backgroundColor = "rgba(255,255,255,0.2)";
                    routeItem.style.color = "#fff";
                } else {
                    routeItem.style.borderColor = "#ddd";
                    routeItem.style.backgroundColor = "white";
                    routeItem.style.color = "#333";
                }
            } else {
                window.selectedRoutes1.add(route);
                routeItem.classList.add("selected");
                // 다크모드에서도 초록색으로 명확하게 표시
                routeItem.style.setProperty('background-color', '#4CAF50', 'important');
                routeItem.style.setProperty('border-color', '#4CAF50', 'important');
                routeItem.style.setProperty('color', '#fff', 'important');
                routeItem.style.setProperty('font-weight', 'bold', 'important');
            }
            
            updateStatus1();
            updateStats1();
        }

        // 상태 업데이트
        function updateStatus1() {
            const statusText = document.getElementById("statusText1");
            const selectedArray = Array.from(window.selectedRoutes1);
            const excludedArray = [
                "거제1", "거제2", "김해1", "내서", "남포", "남포1-1", "다대1", "동래", "마산1", "마산2",
                "명지1", "명지2", "부암", "서면", "서면2", "수영", "장유", "함안"
            ].filter(route => !window.selectedRoutes1.has(route));
            
            let statusHTML = "";
            
            if (selectedArray.length === 18) {
                const color = isDarkMode ? '#4CAF50' : '#2e7d32';
                statusHTML = `<div style="font-size: 18px; font-weight: bold; color: ${color};">창원1센터 차량현황 총18대 퇴근준비완료</div>`;
            } else if (excludedArray.length > 0) {
                const excludedNames = excludedArray.join(",");
                const selectedCount = selectedArray.length;
                const color = isDarkMode ? '#FFD700' : '#f44336';
                statusHTML = `<div style="font-size: 18px; font-weight: bold; color: ${color};">창원1센터 차량현황 ${excludedNames} 노선제외 ${selectedCount}대 퇴근준비완료</div>`;
            } else {
                statusHTML = `<div style="color: ${isDarkMode ? '#fff' : '#333'};">노선을 선택해주세요.</div>`;
            }
            
            statusText.innerHTML = statusHTML;
        }

        // 통계 업데이트
        function updateStats1() {
            const routes = [
                "거제1", "거제2", "김해1", "내서", "남포", "남포1-1", "다대1", "동래", "마산1", "마산2",
                "명지1", "명지2", "부암", "서면", "서면2", "수영", "장유", "함안"
            ];
            
            document.getElementById("totalCount1").textContent = routes.length;
            document.getElementById("selectedCount1").textContent = window.selectedRoutes1.size;
            document.getElementById("excludedCount1").textContent = routes.length - window.selectedRoutes1.size;
        }

        // 선택 초기화
        function resetSelection1() {
            window.selectedRoutes1.clear();
            document.querySelectorAll("#routeGrid1 .route-item").forEach(item => {
                item.classList.remove("selected");
                if (isDarkMode) {
                    item.style.borderColor = "rgba(255,255,255,0.3)";
                    item.style.backgroundColor = "rgba(255,255,255,0.2)";
                    item.style.color = "#fff";
                } else {
                    item.style.borderColor = "#ddd";
                    item.style.backgroundColor = "white";
                    item.style.color = "#333";
                }
            });
            updateStatus1();
            updateStats1();
        }

        // 카카오톡 공유
        function shareToKakao1() {
            const statusText = document.getElementById("statusText1").textContent;
            
            if (navigator.share) {
                navigator.share({
                    title: '창원1센터차량현황',
                    text: statusText
                }).catch(err => console.log('공유 실패:', err));
            } else {
                // 공유 API가 없는 경우 클립보드에 복사
                navigator.clipboard.writeText(statusText).then(() => {
                    alert('클립보드에 복사되었습니다.');
                }).catch(err => {
                    alert('복사 실패: ' + err);
                });
            }
        }

        // 카운터로 돌아가기
        function goBackToCounter1() {
            document.getElementById('vehicle-status-1-page').classList.add('hidden');
            document.getElementById('vehicle-status-1-page').style.display = 'none';
            document.getElementById('keypad-page').classList.remove('hidden');
            document.getElementById('keypad-page').style.display = 'block';
        }

        // 차량현황 3센터 페이지 초기화
        function initializeVehicleStatus3() {
            updateVehicleStatusDarkMode(); // 다크모드 초기화
            
            // 메인 다크모드 버튼 숨김 처리
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                if (window.vehicleStatusThemeHideTimer) {
                    clearTimeout(window.vehicleStatusThemeHideTimer);
                }
                window.vehicleStatusThemeHideTimer = setTimeout(() => {
                    themeToggle.style.opacity = '0';
                    themeToggle.style.transform = 'translateX(100px)';
                    themeToggle.style.pointerEvents = 'none';
                }, 5000);
            }
            
            const routes = ["진해2", "진해1", "창원1", "창원2", "창원3", "창원3-1"].sort();
            
            const routeGrid = document.getElementById("routeGrid3");
            routeGrid.innerHTML = '';
            
            window.selectedRoutes3 = new Set();
            
            routes.forEach(route => {
                const routeItem = document.createElement("div");
                routeItem.className = "route-item";
                routeItem.textContent = route;
                routeItem.style.cssText = "display: flex; align-items: center; justify-content: center; padding: 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white; font-size: 18px; font-weight: 500; color: #333; min-height: 70px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;";
                routeItem.onclick = (e) => toggleRoute3(route, e);
                routeGrid.appendChild(routeItem);
            });
            
            updateStats3();
        }

        function toggleRoute3(route, event) {
            const routeItem = event.target;
            if (navigator.vibrate) navigator.vibrate(50);
            
            if (window.selectedRoutes3.has(route)) {
                window.selectedRoutes3.delete(route);
                routeItem.classList.remove("selected");
                if (isDarkMode) {
                    routeItem.style.borderColor = "rgba(255,255,255,0.3)";
                    routeItem.style.backgroundColor = "rgba(255,255,255,0.2)";
                    routeItem.style.color = "#fff";
                } else {
                    routeItem.style.borderColor = "#ddd";
                    routeItem.style.backgroundColor = "white";
                    routeItem.style.color = "#333";
                }
            } else {
                window.selectedRoutes3.add(route);
                routeItem.classList.add("selected");
                routeItem.style.setProperty('background-color', '#4CAF50', 'important');
                routeItem.style.setProperty('border-color', '#4CAF50', 'important');
                routeItem.style.setProperty('color', '#fff', 'important');
                routeItem.style.setProperty('font-weight', 'bold', 'important');
            }
            
            updateStatus3();
            updateStats3();
        }

        function updateStatus3() {
            const statusText = document.getElementById("statusText3");
            const selectedArray = Array.from(window.selectedRoutes3);
            const excludedArray = ["진해2", "진해1", "창원1", "창원2", "창원3", "창원3-1"].filter(route => !window.selectedRoutes3.has(route));
            
            let statusHTML = "";
            if (selectedArray.length === 6) {
                const color = isDarkMode ? '#4CAF50' : '#2e7d32';
                statusHTML = `<div style="font-size: 18px; font-weight: bold; color: ${color};">창원3센터 차량현황 총6대 퇴근준비완료</div>`;
            } else if (excludedArray.length > 0) {
                const color = isDarkMode ? '#FFD700' : '#f44336';
                statusHTML = `<div style="font-size: 18px; font-weight: bold; color: ${color};">창원3센터 차량현황 ${excludedArray.join(",")} 노선제외 ${selectedArray.length}대 퇴근준비완료</div>`;
            } else {
                statusHTML = `<div style="color: ${isDarkMode ? '#fff' : '#333'};">노선을 선택해주세요.</div>`;
            }
            statusText.innerHTML = statusHTML;
        }

        function updateStats3() {
            const routes = ["진해2", "진해1", "창원1", "창원2", "창원3", "창원3-1"];
            document.getElementById("totalCount3").textContent = routes.length;
            document.getElementById("selectedCount3").textContent = window.selectedRoutes3.size;
            document.getElementById("excludedCount3").textContent = routes.length - window.selectedRoutes3.size;
        }

        function resetSelection3() {
            window.selectedRoutes3.clear();
            document.querySelectorAll("#routeGrid3 .route-item").forEach(item => {
                if (isDarkMode) {
                    item.style.borderColor = "rgba(255,255,255,0.3)";
                    item.style.backgroundColor = "rgba(255,255,255,0.2)";
                    item.style.color = "#fff";
                } else {
                    item.style.borderColor = "#ddd";
                    item.style.backgroundColor = "white";
                    item.style.color = "#333";
                }
            });
            updateStatus3();
            updateStats3();
        }

        function shareToKakao3() {
            const statusText = document.getElementById("statusText3").textContent;
            if (navigator.share) {
                navigator.share({ title: '창원3센터차량현황', text: statusText }).catch(err => console.log('공유 실패:', err));
            } else {
                navigator.clipboard.writeText(statusText).then(() => alert('클립보드에 복사되었습니다.')).catch(err => alert('복사 실패: ' + err));
            }
        }

        function goBackToCounter3() {
            document.getElementById('vehicle-status-3-page').classList.add('hidden');
            document.getElementById('vehicle-status-3-page').style.display = 'none';
            document.getElementById('keypad-page').classList.remove('hidden');
            document.getElementById('keypad-page').style.display = 'block';
        }

        // 차량현황 4센터 페이지 초기화
        function initializeVehicleStatus4() {
            updateVehicleStatusDarkMode(); // 다크모드 초기화
            
            // 메인 다크모드 버튼 숨김 처리
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                if (window.vehicleStatusThemeHideTimer) {
                    clearTimeout(window.vehicleStatusThemeHideTimer);
                }
                window.vehicleStatusThemeHideTimer = setTimeout(() => {
                    themeToggle.style.opacity = '0';
                    themeToggle.style.transform = 'translateX(100px)';
                    themeToggle.style.pointerEvents = 'none';
                }, 5000);
            }
            
            const routes = ["진주1", "진주2", "통영", "하단"];
            
            const routeGrid = document.getElementById("routeGrid4");
            routeGrid.innerHTML = '';
            
            window.selectedRoutes4 = new Set();
            
            routes.forEach(route => {
                const routeItem = document.createElement("div");
                routeItem.className = "route-item";
                routeItem.textContent = route;
                routeItem.style.cssText = "display: flex; align-items: center; justify-content: center; padding: 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white; font-size: 18px; font-weight: 500; color: #333; min-height: 70px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;";
                routeItem.onclick = (e) => toggleRoute4(route, e);
                routeGrid.appendChild(routeItem);
            });
            
            updateStats4();
        }

        function toggleRoute4(route, event) {
            const routeItem = event.target;
            if (navigator.vibrate) navigator.vibrate(50);
            
            if (window.selectedRoutes4.has(route)) {
                window.selectedRoutes4.delete(route);
                routeItem.classList.remove("selected");
                if (isDarkMode) {
                    routeItem.style.borderColor = "rgba(255,255,255,0.3)";
                    routeItem.style.backgroundColor = "rgba(255,255,255,0.2)";
                    routeItem.style.color = "#fff";
                } else {
                    routeItem.style.borderColor = "#ddd";
                    routeItem.style.backgroundColor = "white";
                    routeItem.style.color = "#333";
                }
            } else {
                window.selectedRoutes4.add(route);
                routeItem.classList.add("selected");
                routeItem.style.setProperty('background-color', '#4CAF50', 'important');
                routeItem.style.setProperty('border-color', '#4CAF50', 'important');
                routeItem.style.setProperty('color', '#fff', 'important');
                routeItem.style.setProperty('font-weight', 'bold', 'important');
            }
            
            updateStatus4();
            updateStats4();
        }

        function updateStatus4() {
            const statusText = document.getElementById("statusText4");
            const selectedArray = Array.from(window.selectedRoutes4);
            const excludedArray = ["진주1", "진주2", "통영", "하단"].filter(route => !window.selectedRoutes4.has(route));
            
            let statusHTML = "";
            if (selectedArray.length === 4) {
                const color = isDarkMode ? '#4CAF50' : '#2e7d32';
                statusHTML = `<div style="font-size: 18px; font-weight: bold; color: ${color};">창원4센터 차량현황 총4대 퇴근준비완료</div>`;
            } else if (excludedArray.length > 0) {
                const color = isDarkMode ? '#FFD700' : '#f44336';
                statusHTML = `<div style="font-size: 18px; font-weight: bold; color: ${color};">창원4센터 차량현황 ${excludedArray.join(",")} 노선제외 ${selectedArray.length}대 퇴근준비완료</div>`;
            } else {
                statusHTML = `<div style="color: ${isDarkMode ? '#fff' : '#333'};">노선을 선택해주세요.</div>`;
            }
            statusText.innerHTML = statusHTML;
        }

        function updateStats4() {
            const routes = ["진주1", "진주2", "통영", "하단"];
            document.getElementById("totalCount4").textContent = routes.length;
            document.getElementById("selectedCount4").textContent = window.selectedRoutes4.size;
            document.getElementById("excludedCount4").textContent = routes.length - window.selectedRoutes4.size;
        }

        function resetSelection4() {
            window.selectedRoutes4.clear();
            document.querySelectorAll("#routeGrid4 .route-item").forEach(item => {
                if (isDarkMode) {
                    item.style.borderColor = "rgba(255,255,255,0.3)";
                    item.style.backgroundColor = "rgba(255,255,255,0.2)";
                    item.style.color = "#fff";
                } else {
                    item.style.borderColor = "#ddd";
                    item.style.backgroundColor = "white";
                    item.style.color = "#333";
                }
            });
            updateStatus4();
            updateStats4();
        }

        function shareToKakao4() {
            const statusText = document.getElementById("statusText4").textContent;
            if (navigator.share) {
                navigator.share({ title: '창원4센터차량현황', text: statusText }).catch(err => console.log('공유 실패:', err));
            } else {
                navigator.clipboard.writeText(statusText).then(() => alert('클립보드에 복사되었습니다.')).catch(err => alert('복사 실패: ' + err));
            }
        }

        function goBackToCounter4() {
            document.getElementById('vehicle-status-4-page').classList.add('hidden');
            document.getElementById('vehicle-status-4-page').style.display = 'none';
            document.getElementById('keypad-page').classList.remove('hidden');
            document.getElementById('keypad-page').style.display = 'block';
        }

        // 공지사항 모달 열기
        function openNoticeModal() {
            const noticeDisplay = document.getElementById('notice-content-display');
            
            // Firebase가 설정되어 있으면 Firebase에서 불러오기, 아니면 localStorage에서 불러오기
            if (database) {
                database.ref('notices').once('value', (snapshot) => {
                    const notices = snapshot.val() || [];
                    displayNoticeContent(notices, noticeDisplay);
                });
            } else {
                const notices = JSON.parse(localStorage.getItem('notices') || '[]');
                displayNoticeContent(notices, noticeDisplay);
            }
        }
        
        // 공지사항 내용 표시 함수
        function displayNoticeContent(notices, noticeDisplay) {
            if (notices.length === 0) {
                // 기본 공지사항 표시 (번호 없이, 줄바꿈 유지)
                noticeDisplay.innerHTML = `
                    <div style="margin: 10px 0; white-space: pre-wrap; word-wrap: break-word;">업데이트 25.11.09</div>
                    <div style="margin: 10px 0; white-space: pre-wrap; word-wrap: break-word;">1. 총인원 합계는 45명이상 집계되지 않음</div>
                    <div style="margin: 10px 0; white-space: pre-wrap; word-wrap: break-word;">2. 택시인원은 총 인원 45명 도달시 택시인원추가 버튼이 나타남</div>
                    <div style="margin: 10px 0; white-space: pre-wrap; word-wrap: break-word;">3. 컬리 출 퇴근 추가 / 도착시간 버튼 클릭시 도착시간버튼누른시간으로 기입됌</div>
                    <div style="margin: 10px 0; white-space: pre-wrap; word-wrap: break-word;">4. 퇴근운행추가 퇴근운행은 역순으로 카운트가능함 정류장 0명하차시에는 그냥 엔터누르면 다음정류장으로 이동됨</div>
                `;
            } else {
                // 저장된 공지사항 표시 (번호 없이, 줄바꿈 유지)
                noticeDisplay.innerHTML = notices.map((notice) => {
                    // HTML 이스케이프 처리 후 줄바꿈 유지
                    const escapedContent = escapeHtml(notice.content);
                    return `<div style="margin: 10px 0; white-space: pre-wrap; word-wrap: break-word;">${escapedContent}</div>`;
                }).join('');
            }
            
            // 다크모드일 경우 모든 텍스트를 흰색으로 설정
            if (document.body.classList.contains('dark-mode')) {
                const allTextElements = noticeDisplay.querySelectorAll('div, p, strong, span');
                allTextElements.forEach(el => {
                    el.style.color = '#ffffff';
                });
            } else {
                // 라이트모드일 경우 모든 텍스트를 어두운 색상으로 설정
                const allTextElements = noticeDisplay.querySelectorAll('div, p, strong, span');
                allTextElements.forEach(el => {
                    el.style.color = '#555';
                });
            }
            
            document.getElementById('notice-modal').classList.add('show');
        }

        // 공지사항 모달 닫기
        window.closeNoticeModal = function() {
            const dontShowToday = document.getElementById('dont-show-today').checked;
            
            if (dontShowToday) {
                const today = new Date().toDateString();
                localStorage.setItem('noticeDontShowDate', today);
            }
            
            document.getElementById('notice-modal').classList.remove('show');
        };

        // 공지사항 모달 표시 여부 확인
        function checkNoticeModal() {
            const noticeDontShowDate = localStorage.getItem('noticeDontShowDate');
            const today = new Date().toDateString();
            
            if (noticeDontShowDate !== today) {
                openNoticeModal();
            }
        }

        // 페이지 로드 시 저장된 테마 설정 불러오기
        function loadTheme() {
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'true') {
                isDarkMode = true;
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = '☀️';
            }
        }

        // 정류장 개수 업데이트 함수
        function updateStationCount() {
            stationCount = parseInt(document.getElementById('station-count').value) || 0;
            routeName = document.getElementById('route-name').value.trim();
            document.getElementById('count-submit').disabled = stationCount <= 0 || routeName === '';
        }

        // 날짜 변경 확인 및 완전 초기화
        function checkDateChangeAndReset() {
            const now = new Date();
            const currentDate = now.toDateString(); // "Mon Jan 01 2024" 형식
            const savedDate = localStorage.getItem('lastResetDate');

            console.log(`=== 날짜 변경 확인 시작 ===`);
            console.log(`현재 시간: ${now}`);
            console.log(`현재 날짜: ${currentDate}`);
            console.log(`저장된 날짜: ${savedDate}`);
            console.log(`stations 배열 상태: ${stations ? stations.length : 'undefined'}개 정류장`);
            console.log(`날짜 비교 결과: ${savedDate} !== ${currentDate} = ${savedDate !== currentDate}`);

            if (savedDate && savedDate !== currentDate) {
                console.log(`*** 날짜 변경 감지: ${savedDate} → ${currentDate} ***`);
                console.log('24시가 지나 완전 초기화를 실행합니다.');
                
                // 완전 초기화 실행
                completeReset();
                
                // 새로운 날짜 저장
                localStorage.setItem('lastResetDate', currentDate);
                console.log('24시가 지나서 명수 자동 초기화가 완료되었습니다.');
            } else if (!savedDate) {
                // 처음 실행하는 경우 현재 날짜 저장
                console.log(`처음 실행 - 현재 날짜 저장: ${currentDate}`);
                localStorage.setItem('lastResetDate', currentDate);
            } else {
                console.log('날짜 변경 없음 - 리셋하지 않음');
            }
            console.log(`=== 날짜 변경 확인 끝 ===`);
        }

        // 완전 초기화 함수
        function completeReset() {
            if (stations && stations.length > 0) {
                stations.forEach(station => {
                    station.count = 0;
                    station.morningCount = 0;
                    station.afternoonCount = 0;
                });
                currentStationIndex = 0;
                currentInput = '';
                enableKeypad();
                updateKeypadPage();
                localStorage.setItem('savedStations', JSON.stringify(stations));
                saveToLocalStorage('currentStationIndex', '0');
                saveToLocalStorage('currentInput', '');
                saveToLocalStorage('completedTimePeriods', JSON.stringify({ morning: false, afternoon: false }));
                saveToLocalStorage('keypadDisabled', 'false');
                saveToLocalStorage('morningRunCompleted', 'false');
                console.log('24시 경과로 인한 완전 초기화가 완료되었습니다.');
            }
        }

        // 현재 시간에 따라 자동으로 시간대 선택
        function autoSelectTimePeriod() {
            // 먼저 날짜 변경 확인
            checkDateChangeAndReset();
            
            // 컬리일 때는 자동 선택하지 않음 (사용자가 자유롭게 선택)
            if (currentService === 'kurly') {
                console.log('컬리 서비스: 자동 시간대 선택 비활성화');
                // 기본값만 설정 (morning)
                if (!selectedTimePeriod) {
                    selectedTimePeriod = 'morning';
                }
                updateTimePeriodButtons();
                return;
            }
            
            const now = new Date();
            const currentHour = now.getHours();
            
            // 오전: 00시~12시, 오후: 12시01분~23시59분
            if (currentHour >= 0 && currentHour <= 12) {
                selectedTimePeriod = 'morning';
                console.log(`시간대 조건 확인: ${currentHour}시는 오전 범위 (0-12시)`);
            } else {
                selectedTimePeriod = 'afternoon';
                console.log(`시간대 조건 확인: ${currentHour}시는 오후 범위 (13-23시)`);
            }
            
            console.log(`현재 시간: ${currentHour}시, 자동 선택된 시간대: ${selectedTimePeriod}`);
            
            // 버튼 업데이트
            updateTimePeriodButtons();
            
            // localStorage에 저장
            localStorage.setItem('selectedTimePeriod', selectedTimePeriod);
        }
        
        // 컬리 시간 체크 함수 (해당 운행 시간에 도달했는지 확인)
        function checkKurlyTimeAvailable(period) {
            if (currentService !== 'kurly') {
                return true; // 컬리가 아니면 항상 가능
            }
            
            // 퇴근운행은 시간 제한 없음
            if (period === 'evening') {
                return true;
            }
            
            if (!stations || stations.length === 0) {
                return true; // 정류장이 없으면 일단 가능
            }
            
            const firstStation = stations[0];
            if (!firstStation || !firstStation.departureTime) {
                return true; // 출발시간 정보가 없으면 일단 가능
            }
            
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            if (period === 'morning') {
                const targetHour = firstStation.departureTime.morningHour || 14;
                const targetMinute = firstStation.departureTime.morningMinute || 0;
                
                // 현재 시간이 목표 시간에 도달했는지 확인
                if (currentHour > targetHour || (currentHour === targetHour && currentMinute >= targetMinute)) {
                    return true;
                }
                return false;
            } else if (period === 'afternoon') {
                const targetHour = firstStation.departureTime.afternoonHour || 17;
                const targetMinute = firstStation.departureTime.afternoonMinute || 0;
                
                // 현재 시간이 목표 시간에 도달했는지 확인
                if (currentHour > targetHour || (currentHour === targetHour && currentMinute >= targetMinute)) {
                    return true;
                }
                return false;
            }
            
            return true;
        }

        // 시간대 선택 함수 (수동 선택용)
        function selectTimePeriod(period) {
            // 날짜 변경 확인
            checkDateChangeAndReset();
            
            // 컬리일 때 시간 체크 제거 (자유롭게 선택 가능)
            // 시간 체크 로직 제거됨
            
            // 완료된 운행 시간대로 전환하려는 경우 경고
            if (completedTimePeriods[period]) {
                const periodName = period === 'morning' ? '오전' : period === 'afternoon' ? '오후' : '퇴근';
                alert(`${periodName}운행이 이미 완료되었습니다. 카운팅을 다시 시작할 수 없습니다.`);
                return;
            }
            
            const previousPeriod = selectedTimePeriod;
            selectedTimePeriod = period;
            
            // 퇴근운행 모드 설정
            isEveningMode = (period === 'evening');
            
            updateTimePeriodButtons();
            
            // 키패드 페이지 업데이트 (시간 표시 변경)
            if (!document.getElementById('keypad-page').classList.contains('hidden')) {
                // 시간대 전환 시 키패드 재활성화 및 정류장 인덱스 초기화
                if (previousPeriod !== period) {
                    enableKeypad();
                    // 퇴근운행 모드일 때는 마지막 정류장부터 시작, 아니면 첫 번째 정류장부터
                    if (isEveningMode) {
                        currentStationIndex = stations.length - 1;
                    } else {
                        currentStationIndex = 0;
                    }
                    currentInput = ''; // 입력 초기화
                    saveToLocalStorage('currentStationIndex', currentStationIndex.toString());
                    console.log(`${previousPeriod}에서 ${period}로 전환 - 키패드 재활성화, ${isEveningMode ? '마지막' : '첫 번째'} 정류장으로 이동`);
                }
                
                updateKeypadPage();
                
                // 택시 인원 표시 업데이트 (쿠팡일 때)
                if (currentService === 'coupang') {
                    updateTaxiPassengerDisplay();
                }
            }
            
            // localStorage에 저장
            localStorage.setItem('selectedTimePeriod', period);
            localStorage.setItem('isEveningMode', isEveningMode.toString());
        }

        // 시간대 버튼 업데이트 함수
        function updateTimePeriodButtons() {
            // 키패드 화면 버튼 업데이트
            const morningBtnKeypad = document.getElementById('morning-btn-keypad');
            const afternoonBtnKeypad = document.getElementById('afternoon-btn-keypad');
            const eveningBtnKeypad = document.getElementById('evening-btn-keypad');
            const vehicleStatusBtn = document.getElementById('vehicle-status-btn-keypad');
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            
            // 컬리일 때 입차현황 버튼 숨기기, 퇴근운행 버튼 표시 (한 번만 설정)
            if (currentService === 'kurly') {
                if (vehicleStatusBtn && vehicleStatusBtn.style.display !== 'none') {
                    vehicleStatusBtn.style.display = 'none';
                }
                if (eveningBtnKeypad && eveningBtnKeypad.style.display !== 'block') {
                    eveningBtnKeypad.style.display = 'block';
                    eveningBtnKeypad.style.visibility = 'visible';
                    eveningBtnKeypad.style.opacity = '1';
                    eveningBtnKeypad.style.height = 'auto';
                    eveningBtnKeypad.style.width = 'auto';
                    eveningBtnKeypad.style.padding = '';
                    eveningBtnKeypad.style.margin = '';
                }
                // 14시운행(morning) 완료 후 도착시간 버튼 표시 (각 시간대별로 확인)
                if (arrivalTimeRow) {
                    // 현재 선택된 시간대가 완료되었고 해당 시간대의 도착시간이 기록되지 않았을 때 표시
                    const currentPeriodCompleted = completedTimePeriods[selectedTimePeriod];
                    let currentArrivalTime = null;
                    if (selectedTimePeriod === 'morning') {
                        currentArrivalTime = morningArrivalTime;
                    } else if (selectedTimePeriod === 'afternoon') {
                        currentArrivalTime = afternoonArrivalTime;
                    } else if (selectedTimePeriod === 'evening') {
                        currentArrivalTime = eveningArrivalTime;
                    }
                    arrivalTimeRow.style.display = (currentPeriodCompleted && !currentArrivalTime) ? 'block' : 'none';
                }
                
                // 컬리일 때 모든 버튼 활성화 (시간 체크 제거 - 자유롭게 선택 가능)
                if (morningBtnKeypad) {
                    morningBtnKeypad.disabled = false;
                    morningBtnKeypad.style.opacity = '1';
                    morningBtnKeypad.style.cursor = 'pointer';
                }
                
                if (afternoonBtnKeypad) {
                    afternoonBtnKeypad.disabled = false;
                    afternoonBtnKeypad.style.opacity = '1';
                    afternoonBtnKeypad.style.cursor = 'pointer';
                }
                
                // 퇴근운행은 항상 가능
                if (eveningBtnKeypad) {
                    eveningBtnKeypad.disabled = false;
                    eveningBtnKeypad.style.opacity = '1';
                    eveningBtnKeypad.style.cursor = 'pointer';
                }
            } else {
                // 쿠팡일 때 입차현황 버튼 표시, 퇴근운행 버튼 완전히 숨기기 (한 번만 설정)
                if (vehicleStatusBtn && vehicleStatusBtn.style.display !== 'block') {
                    vehicleStatusBtn.style.display = 'block';
                }
                if (eveningBtnKeypad && eveningBtnKeypad.style.display !== 'none') {
                    eveningBtnKeypad.style.display = 'none';
                    eveningBtnKeypad.style.visibility = 'hidden';
                    eveningBtnKeypad.style.opacity = '0';
                    eveningBtnKeypad.style.height = '0';
                    eveningBtnKeypad.style.width = '0';
                    eveningBtnKeypad.style.padding = '0';
                    eveningBtnKeypad.style.margin = '0';
                }
                if (arrivalTimeRow && arrivalTimeRow.style.display !== 'none') {
                    arrivalTimeRow.style.display = 'none';
                    arrivalTimeRow.style.visibility = 'hidden';
                    arrivalTimeRow.style.opacity = '0';
                    arrivalTimeRow.style.height = '0';
                    arrivalTimeRow.style.marginTop = '0';
                    arrivalTimeRow.style.marginBottom = '0';
                    arrivalTimeRow.style.padding = '0';
                    arrivalTimeRow.style.overflow = 'hidden';
                }
                
                // 쿠팡일 때는 모든 버튼 활성화
                if (morningBtnKeypad && morningBtnKeypad.disabled) {
                    morningBtnKeypad.disabled = false;
                    morningBtnKeypad.style.opacity = '1';
                    morningBtnKeypad.style.cursor = 'pointer';
                }
                if (afternoonBtnKeypad && afternoonBtnKeypad.disabled) {
                    afternoonBtnKeypad.disabled = false;
                    afternoonBtnKeypad.style.opacity = '1';
                    afternoonBtnKeypad.style.cursor = 'pointer';
                }
            }
            
            if (morningBtnKeypad && afternoonBtnKeypad) {
                morningBtnKeypad.classList.remove('active');
                afternoonBtnKeypad.classList.remove('active');
                if (eveningBtnKeypad) {
                    eveningBtnKeypad.classList.remove('active');
                }
                
                if (selectedTimePeriod === 'morning') {
                    morningBtnKeypad.classList.add('active');
                } else if (selectedTimePeriod === 'afternoon') {
                    afternoonBtnKeypad.classList.add('active');
                } else if (selectedTimePeriod === 'evening' && eveningBtnKeypad) {
                    eveningBtnKeypad.classList.add('active');
                }
            }
        }
        
        // 도착시간 기록 함수
        function recordArrivalTime() {
            if (currentService !== 'kurly') {
                return;
            }
            
            const now = new Date();
            const arrivalTimeData = {
                hour: now.getHours(),
                minute: now.getMinutes()
            };
            
            // 현재 선택된 시간대에 맞게 저장
            if (selectedTimePeriod === 'morning') {
                morningArrivalTime = arrivalTimeData;
                localStorage.setItem('morningArrivalTime', JSON.stringify(morningArrivalTime));
                alert(`14시운행 도착시간이 기록되었습니다: ${String(arrivalTimeData.hour).padStart(2, '0')}:${String(arrivalTimeData.minute).padStart(2, '0')}`);
            } else if (selectedTimePeriod === 'afternoon') {
                afternoonArrivalTime = arrivalTimeData;
                localStorage.setItem('afternoonArrivalTime', JSON.stringify(afternoonArrivalTime));
                alert(`17시운행 도착시간이 기록되었습니다: ${String(arrivalTimeData.hour).padStart(2, '0')}:${String(arrivalTimeData.minute).padStart(2, '0')}`);
            } else if (selectedTimePeriod === 'evening') {
                eveningArrivalTime = arrivalTimeData;
                localStorage.setItem('eveningArrivalTime', JSON.stringify(eveningArrivalTime));
                alert(`퇴근운행 도착시간이 기록되었습니다: ${String(arrivalTimeData.hour).padStart(2, '0')}:${String(arrivalTimeData.minute).padStart(2, '0')}`);
            }
            
            // 도착시간 버튼 숨기기 (현재 시간대의 도착시간이 기록되었으므로)
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            if (arrivalTimeRow) {
                arrivalTimeRow.style.display = 'none';
            }
            
            // 키패드 페이지 업데이트 (다음 시간대의 도착시간 버튼 표시 여부 확인)
            updateKeypadPage();
        }

        // 정류장 개수 제출 함수
        // 시작 페이지에서 쿠팡으로 이동
        window.goToCoupang = function() {
            currentService = 'coupang'; // 현재 서비스 설정
            
            // 도착시간 버튼 완전히 숨기기 (쿠팡에서는 사용하지 않음)
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            if (arrivalTimeRow) {
                arrivalTimeRow.style.display = 'none';
                arrivalTimeRow.style.visibility = 'hidden';
                arrivalTimeRow.style.opacity = '0';
                arrivalTimeRow.style.height = '0';
                arrivalTimeRow.style.marginTop = '0';
                arrivalTimeRow.style.marginBottom = '0';
                arrivalTimeRow.style.padding = '0';
                arrivalTimeRow.style.overflow = 'hidden';
            }
            // 저장된 정류장 정보가 있으면 복원하고 키패드 페이지로 이동
            const savedStations = JSON.parse(loadFromLocalStorage('savedStations') || '[]');
            const savedStationCount = loadFromLocalStorage('savedStationCount');
            
            // 모든 페이지 숨김
            const selectionPage = document.getElementById('selection-page');
            const stationCountPage = document.getElementById('station-count-page');
            const stationNamesPage = document.getElementById('station-names-page');
            const keypadPage = document.getElementById('keypad-page');
            
            if (selectionPage) {
                selectionPage.classList.add('hidden');
                selectionPage.style.display = 'none';
            }
            if (stationNamesPage) {
                stationNamesPage.classList.add('hidden');
                stationNamesPage.style.display = 'none';
            }
            if (keypadPage) {
                keypadPage.classList.add('hidden');
                keypadPage.style.display = 'none';
            }
            
            if (savedStationCount && savedStations.length > 0) {
                // 저장된 데이터가 있으면 복원
                restoreSavedStations();
            } else {
                // 저장된 데이터가 없으면 정류장 개수 입력 페이지로 이동
                if (stationCountPage) {
                    stationCountPage.classList.remove('hidden');
                    stationCountPage.style.display = 'block';
                }
            }
        }

        // 시작 페이지에서 컬리로 이동
        window.goToKurly = function() {
            currentService = 'kurly'; // 현재 서비스 설정
            
            // 도착시간 버튼 인라인 스타일 초기화 (쿠팡에서 설정한 스타일 제거)
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            if (arrivalTimeRow) {
                arrivalTimeRow.style.display = '';
                arrivalTimeRow.style.visibility = '';
                arrivalTimeRow.style.opacity = '';
                arrivalTimeRow.style.height = '';
                arrivalTimeRow.style.marginTop = '';
                arrivalTimeRow.style.marginBottom = '';
                arrivalTimeRow.style.padding = '';
                arrivalTimeRow.style.overflow = '';
            }
            
            // 컬리 저장된 정류장 정보 확인
            const kurlySavedStations = JSON.parse(loadFromLocalStorage('kurlySavedStations') || '[]');
            const kurlySavedStationCount = loadFromLocalStorage('kurlySavedStationCount');
            
            // 모든 페이지 숨김
            const selectionPage = document.getElementById('selection-page');
            const stationCountPage = document.getElementById('station-count-page');
            const stationNamesPage = document.getElementById('station-names-page');
            const kurlyStationCountPage = document.getElementById('kurly-station-count-page');
            const kurlyStationNamesPage = document.getElementById('kurly-station-names-page');
            const keypadPage = document.getElementById('keypad-page');
            
            if (selectionPage) {
                selectionPage.classList.add('hidden');
                selectionPage.style.display = 'none';
            }
            if (stationCountPage) {
                stationCountPage.classList.add('hidden');
                stationCountPage.style.display = 'none';
            }
            if (stationNamesPage) {
                stationNamesPage.classList.add('hidden');
                stationNamesPage.style.display = 'none';
            }
            if (kurlyStationNamesPage) {
                kurlyStationNamesPage.classList.add('hidden');
                kurlyStationNamesPage.style.display = 'none';
            }
            if (keypadPage) {
                keypadPage.classList.add('hidden');
                keypadPage.style.display = 'none';
            }
            
            // 컬리 노선 개수 입력 페이지 표시 (저장된 노선 목록 표시)
            if (kurlyStationCountPage) {
                kurlyStationCountPage.classList.remove('hidden');
                kurlyStationCountPage.style.display = 'block';
                // 컬리 저장된 노선 목록 업데이트
                updateKurlySavedRoutesDisplay();
            }
            
            // URL 상태 업데이트
            window.history.pushState({page: 'kurly-station-count', service: 'kurly'}, '', window.location.pathname);
        }

        function submitStationCount() {
            stationCount = parseInt(document.getElementById('station-count').value) || 0;
            routeName = document.getElementById('route-name').value.trim();
            isLoadedRoute = false; // 새로운 노선임을 표시
            
            if (routeName === '') {
                return;
            }
            
            if (stationCount > 0) {
                // 새로운 노선을 위한 완전 초기화
                stations = Array.from({ length: stationCount }, (_, index) => ({
                    id: index,
                    name: '',
                    count: 0,
                    morningCount: 0,
                    afternoonCount: 0,
                    departureTime: { 
                        morningHour: 8, 
                        afternoonHour: 17, 
                        minute: Math.min(index * 5, 59) 
                    }
                }));
                stationNames = new Array(stationCount).fill('');
                stationDepartureTimes = new Array(stationCount).fill({ hour: 8, minute: 0, ampm: 'AM' });
                createStationInputs();
                
                // 페이지 전환
                const stationCountPage = document.getElementById('station-count-page');
                const stationNamesPage = document.getElementById('station-names-page');
                
                if (stationCountPage) {
                    stationCountPage.classList.add('hidden');
                    stationCountPage.style.display = 'none';
                }
                if (stationNamesPage) {
                    stationNamesPage.classList.remove('hidden');
                    stationNamesPage.style.display = 'block';
                }
                
                // 버튼 상태 업데이트
                document.getElementById('count-submit').disabled = stationCount <= 0 || routeName === '';
            }
        }

        // 정류장 이름 입력 필드 생성
        function createStationInputs() {
            const stationInputs = document.getElementById('station-inputs');
            stationInputs.innerHTML = '';
            stations.forEach((station, index) => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'station-input-group';
                inputGroup.style.flexDirection = 'column';
                inputGroup.style.alignItems = 'stretch';
                inputGroup.style.gap = '10px';
                inputGroup.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">정류장 ${index + 1}:</label>
                        <input type="text" class="station-name-input" placeholder="정류장 ${index + 1} 이름" 
                               value="${station.name || ''}" onchange="updateStationName(${index}, this.value)" lang="ko" ime-mode="active">
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">오전시간:</label>
                        <input type="number" min="1" max="12" placeholder="시" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.morningHour || 8}" onchange="updateDepartureTime(${index}, 'morningHour', this.value)">
                        <span style="color: white;">시</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">오후시간:</label>
                        <input type="number" min="1" max="12" placeholder="시" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.afternoonHour || 5}" onchange="updateDepartureTime(${index}, 'afternoonHour', this.value)">
                        <span style="color: white;">시</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">분:</label>
                        <input type="number" min="0" max="59" placeholder="분" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.minute || 0}" onchange="updateDepartureTime(${index}, 'minute', this.value)">
                        <span style="color: white;">분</span>
                    </div>
                `;
                stationInputs.appendChild(inputGroup);
            });
        }

        // 정류장 이름 업데이트
        function updateStationName(index, name) {
            stationNames[index] = name;
            stations[index].name = name;
            
            // 정류장 이름과 카운팅 데이터를 모두 localStorage에 저장
            localStorage.setItem('savedStations', JSON.stringify(stations));
            
            checkAllNamesFilled();
        }

        // 출발 시간 업데이트
        function updateDepartureTime(index, type, value) {
            if (!stations[index].departureTime) {
                stations[index].departureTime = { morningHour: 8, afternoonHour: 5, minute: 0 };
            }
            
            if (type === 'morningHour') {
                stations[index].departureTime.morningHour = parseInt(value) || 8;
            } else if (type === 'afternoonHour') {
                stations[index].departureTime.afternoonHour = parseInt(value) || 5;
            } else if (type === 'minute') {
                stations[index].departureTime.minute = parseInt(value) || 0;
            }
            
            // 출발 시간을 localStorage에 저장
            const savedDepartureTimes = stations.map(station => station.departureTime);
            localStorage.setItem('savedDepartureTimes', JSON.stringify(savedDepartureTimes));
        }

        // 모든 정류장 이름이 입력되었는지 확인
        function checkAllNamesFilled() {
            const allFilled = stations.every(station => station.name.trim() !== '');
            document.getElementById('start-counting').disabled = !allFilled;
            document.getElementById('save-route').disabled = !allFilled;
        }

        // 카운팅 시작
        function startCounting() {
            if (stations.every(station => station.name.trim() !== '')) {
                // 정류장 개수와 노선이름을 localStorage에 저장
                localStorage.setItem('savedStationCount', stationCount.toString());
                localStorage.setItem('savedRouteName', routeName);
                
                // 첫 번째 정류장부터 시작하도록 명시적으로 초기화
                currentStationIndex = 0;
                currentInput = '';
                saveToLocalStorage('currentStationIndex', '0');
                saveToLocalStorage('currentInput', '');
                console.log(`카운팅 시작: 정류장 ${currentStationIndex + 1}/${stations.length}부터 시작`);
                
                // 페이지 전환
                const stationNamesPage = document.getElementById('station-names-page');
                const keypadPage = document.getElementById('keypad-page');
                
                if (stationNamesPage) {
                    stationNamesPage.classList.add('hidden');
                    stationNamesPage.style.display = 'none';
                }
                if (keypadPage) {
                    keypadPage.classList.remove('hidden');
                    keypadPage.style.display = 'block';
                }
                
                // 도착시간 버튼 완전히 숨기기 (쿠팡 전용이므로)
                const arrivalTimeRow = document.getElementById('arrival-time-row');
                if (arrivalTimeRow) {
                    arrivalTimeRow.style.display = 'none';
                    arrivalTimeRow.style.visibility = 'hidden';
                    arrivalTimeRow.style.opacity = '0';
                    arrivalTimeRow.style.height = '0';
                    arrivalTimeRow.style.marginTop = '0';
                    arrivalTimeRow.style.marginBottom = '0';
                    arrivalTimeRow.style.padding = '0';
                    arrivalTimeRow.style.overflow = 'hidden';
                }
                
                // 키패드 페이지 업데이트
                updateKeypadPage();
                
                // 시계 시작
                updateClock();
                setInterval(updateClock, 1000);
            }
        }
        
        // 시간대 버튼 라벨 업데이트 (첫 번째 정류장 시간 기준) - 컬리 전용
        function updateTimePeriodButtonLabels() {
            // 컬리 서비스일 때만 업데이트
            if (currentService !== 'kurly') {
                console.log('updateTimePeriodButtonLabels: currentService가 kurly가 아님:', currentService);
                return;
            }
            
            if (!stations || stations.length === 0) {
                console.log('updateTimePeriodButtonLabels: stations가 비어있음');
                return;
            }
            
            const firstStation = stations[0];
            if (!firstStation || !firstStation.departureTime) {
                console.log('updateTimePeriodButtonLabels: firstStation 또는 departureTime이 없음');
                return;
            }
            
            const morningBtn = document.getElementById('morning-btn-keypad');
            const afternoonBtn = document.getElementById('afternoon-btn-keypad');
            
            if (!morningBtn || !afternoonBtn) {
                console.log('updateTimePeriodButtonLabels: 버튼을 찾을 수 없음');
                return;
            }
            
            // 오전 시간 (morningHour) - 시만 표시
            const morningHour = firstStation.departureTime.morningHour || 8;
            const morningTimeStr = `${morningHour}시운행`;
            
            // 오후 시간 (afternoonHour) - 시만 표시
            const afternoonHour = firstStation.departureTime.afternoonHour || 17;
            const afternoonTimeStr = `${afternoonHour}시운행`;
            
            console.log('updateTimePeriodButtonLabels: 버튼 텍스트 업데이트', {
                morningTimeStr,
                afternoonTimeStr,
                firstStation: firstStation.departureTime
            });
            
            morningBtn.textContent = morningTimeStr;
            afternoonBtn.textContent = afternoonTimeStr;
        }

        // 다시 설정 (시작 페이지로 돌아가기)
        function resetSetup() {
            stationCount = 0;
            stations = [];
            stationNames = [];
            currentStationIndex = 0;
            currentInput = '';
            saveToLocalStorage('currentStationIndex', '0');
            
            document.getElementById('station-count').value = '';
            document.getElementById('route-name').value = '';
            document.getElementById('count-submit').disabled = true;
            
            // 시작 페이지로 돌아가기
            const selectionPage = document.getElementById('selection-page');
            const stationCountPage = document.getElementById('station-count-page');
            const stationNamesPage = document.getElementById('station-names-page');
            const keypadPage = document.getElementById('keypad-page');
            
            if (selectionPage) {
                selectionPage.classList.remove('hidden');
                selectionPage.style.display = 'flex';
            }
            if (stationCountPage) {
                stationCountPage.classList.add('hidden');
                stationCountPage.style.display = 'none';
            }
            if (stationNamesPage) {
                stationNamesPage.classList.add('hidden');
                stationNamesPage.style.display = 'none';
            }
            if (keypadPage) {
                keypadPage.classList.add('hidden');
                keypadPage.style.display = 'none';
            }
        }

        // 시계 업데이트 함수
        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            const weekdays = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
            const weekday = weekdays[now.getDay()];
            
            document.getElementById('clock-time').textContent = `${hours}:${minutes}:${seconds}`;
            document.getElementById('clock-date').textContent = `${year}년 ${month}월 ${day}일 ${weekday}`;
            
            // 자정 체크 (매초마다 확인)
            checkMidnightReset();
        }

        // 키패드 페이지 업데이트
        function updateKeypadPage() {
            // 선택된 시간대에 따른 총 카운트 계산
            let totalCount = 0;
            if (selectedTimePeriod === 'morning') {
                totalCount = stations.reduce((sum, station) => sum + (station.morningCount || 0), 0);
            } else if (selectedTimePeriod === 'afternoon') {
                totalCount = stations.reduce((sum, station) => sum + (station.afternoonCount || 0), 0);
            } else if (selectedTimePeriod === 'evening') {
                totalCount = stations.reduce((sum, station) => sum + (station.eveningCount || 0), 0);
            }
            
            // stations 배열이 비어있거나 currentStationIndex가 유효하지 않은 경우 체크
            if (!stations || stations.length === 0) {
                console.error('updateKeypadPage: stations 배열이 비어있습니다.');
                return;
            }
            
            // currentStationIndex가 유효한 범위인지 확인
            if (currentStationIndex < 0 || currentStationIndex >= stations.length) {
                console.error(`updateKeypadPage: currentStationIndex(${currentStationIndex})가 유효하지 않습니다. stations.length: ${stations.length}`);
                // 퇴근운행 모드일 때는 마지막 정류장부터, 아니면 첫 번째 정류장부터
                currentStationIndex = isEveningMode ? stations.length - 1 : 0;
            }
            
            const currentStation = stations[currentStationIndex];
            
            // currentStation이 undefined인 경우 체크
            if (!currentStation) {
                console.error(`updateKeypadPage: currentStation이 undefined입니다. currentStationIndex: ${currentStationIndex}, stations.length: ${stations.length}`);
                return;
            }
            
            // 현재 정류장 이름과 운행 시간 표시 (저장된 내용 그대로 표시)
            let timeDisplay = '';
            if (currentStation && currentStation.departureTime) {
                let hour, minute;
                if (selectedTimePeriod === 'morning') {
                    hour = currentStation.departureTime.morningHour || 8;
                    // 컬리일 때는 morningMinute 사용, 쿠팡일 때는 minute 사용
                    minute = currentService === 'kurly' ? 
                        (currentStation.departureTime.morningMinute || 0) : 
                        (currentStation.departureTime.minute || 0);
                } else if (selectedTimePeriod === 'afternoon') {
                    hour = currentStation.departureTime.afternoonHour || 17;
                    // 컬리일 때는 afternoonMinute 사용, 쿠팡일 때는 minute 사용
                    minute = currentService === 'kurly' ? 
                        (currentStation.departureTime.afternoonMinute || 0) : 
                        (currentStation.departureTime.minute || 0);
                } else if (selectedTimePeriod === 'evening') {
                    // 퇴근운행은 오후 시간 사용
                    hour = currentStation.departureTime.afternoonHour || 17;
                    minute = currentService === 'kurly' ? 
                        (currentStation.departureTime.afternoonMinute || 0) : 
                        (currentStation.departureTime.minute || 0);
                }
                const timeStr = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                timeDisplay = ` (${timeStr})`;
            }
            
            // 정류장 변경 시 색상 변화 효과 적용
            const currentStationElement = document.querySelector('.current-station');
            if (currentStationElement) {
                // 기존 변경 효과 제거
                currentStationElement.classList.remove('changed');
                
                // 잠시 후 변경 효과 적용 (DOM 업데이트 후)
                setTimeout(() => {
                    currentStationElement.classList.add('changed');
                    
                    // 1초 후 변경 효과 제거
                    setTimeout(() => {
                        currentStationElement.classList.remove('changed');
                    }, 1000);
                }, 50);
            }
            
            const stationNameElement = document.getElementById('current-station-name');
            const stationCountElement = document.getElementById('current-station-count');
            
            if (stationNameElement) {
                stationNameElement.textContent = `${currentStation.name || '정류장'}${timeDisplay}`;
            }
            if (stationCountElement) {
                // 쿠팡/컬리일 때는 45명 제한 표시
                if ((currentService === 'coupang' || currentService === 'kurly') && totalCount >= 45) {
                    stationCountElement.textContent = `총 탑승자수: 45명 (최대)`;
                } else {
                    stationCountElement.textContent = `총 탑승자수: ${totalCount}`;
                }
            }
            
            // 택시 인원 추가 버튼 표시 (쿠팡/컬리일 때만, 45명 이상일 때만)
            const taxiSection = document.getElementById('taxi-passenger-section');
            if (taxiSection) {
                if ((currentService === 'coupang' || currentService === 'kurly') && totalCount >= 45) {
                    taxiSection.style.display = 'block';
                    updateTaxiPassengerDisplay();
                } else {
                    taxiSection.style.display = 'none';
                }
            }
            
            updateSummary();
            
            // 도착시간 버튼 표시 상태 업데이트 (컬리 전용, 각 시간대별로 표시)
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            if (arrivalTimeRow) {
                if (currentService === 'kurly') {
                    // 컬리일 때는 현재 선택된 시간대가 완료되었고 해당 시간대의 도착시간이 기록되지 않았을 때 표시
                    const currentPeriodCompleted = completedTimePeriods[selectedTimePeriod];
                    let currentArrivalTime = null;
                    if (selectedTimePeriod === 'morning') {
                        currentArrivalTime = morningArrivalTime;
                    } else if (selectedTimePeriod === 'afternoon') {
                        currentArrivalTime = afternoonArrivalTime;
                    } else if (selectedTimePeriod === 'evening') {
                        currentArrivalTime = eveningArrivalTime;
                    }
                    
                    // 조건이 변경되었을 때만 업데이트 (불필요한 DOM 조작 방지)
                    const shouldShow = currentPeriodCompleted && !currentArrivalTime;
                    const isCurrentlyVisible = arrivalTimeRow.style.display === 'block';
                    
                    if (shouldShow && !isCurrentlyVisible) {
                        // 현재 시간대 완료 시 도착시간 버튼 표시
                        arrivalTimeRow.style.display = 'block';
                        arrivalTimeRow.style.visibility = 'visible';
                        arrivalTimeRow.style.opacity = '1';
                        arrivalTimeRow.style.height = 'auto';
                        arrivalTimeRow.style.marginTop = '-5px';
                        arrivalTimeRow.style.marginBottom = '0';
                        arrivalTimeRow.style.paddingTop = '0';
                        arrivalTimeRow.style.padding = '0 10px';
                        arrivalTimeRow.style.overflow = 'visible';
                        const arrivalTimeBtn = document.getElementById('arrival-time-btn');
                        if (arrivalTimeBtn) {
                            arrivalTimeBtn.disabled = false;
                            arrivalTimeBtn.style.opacity = '1';
                            arrivalTimeBtn.style.cursor = 'pointer';
                        }
                    } else if (!shouldShow && isCurrentlyVisible) {
                        // 현재 시간대가 완료되지 않았거나 도착시간이 이미 기록된 경우 숨기기
                        arrivalTimeRow.style.display = 'none';
                        arrivalTimeRow.style.visibility = 'hidden';
                        arrivalTimeRow.style.opacity = '0';
                        arrivalTimeRow.style.height = '0';
                        arrivalTimeRow.style.marginTop = '0';
                        arrivalTimeRow.style.marginBottom = '0';
                    }
                } else {
                    // 쿠팡일 때는 항상 완전히 숨기기
                    arrivalTimeRow.style.display = 'none';
                    arrivalTimeRow.style.visibility = 'hidden';
                    arrivalTimeRow.style.opacity = '0';
                    arrivalTimeRow.style.height = '0';
                    arrivalTimeRow.style.marginTop = '0';
                    arrivalTimeRow.style.marginBottom = '0';
                    arrivalTimeRow.style.padding = '0';
                    arrivalTimeRow.style.overflow = 'hidden';
                }
            }
        }

        // 요약 업데이트 (오전/오후 카운트 분리 표시)
        function updateSummary() {
            const summaryList = document.getElementById('summary-list');
            summaryList.innerHTML = '';
            stations.forEach((station, index) => {
                const summaryItem = document.createElement('div');
                summaryItem.className = `summary-item ${index === currentStationIndex ? 'current' : ''}`;
                
                // 오전/오후 카운트를 분리하여 표시
                const morningCount = station.morningCount || 0;
                const afternoonCount = station.afternoonCount || 0;
                summaryItem.textContent = `${index + 1}. ${station.name}: 오전 ${morningCount}명, 오후 ${afternoonCount}명`;
                
                summaryList.appendChild(summaryItem);
            });
        }

        // 햅틱 피드백 함수 (진동 + 시각적 피드백)
        function hapticFeedback(pattern = 50) {
            // 진동 시도
            if (navigator.vibrate) {
                try {
                    navigator.vibrate(pattern);
                    console.log('진동 실행됨:', pattern + 'ms');
                } catch (e) {
                    console.log('진동 실행 실패:', e);
                }
            } else {
                console.log('이 기기는 진동을 지원하지 않습니다');
            }
            
            // iOS Safari/PWA에서 진동이 안 될 때 시각적 피드백
            if (window.navigator && window.navigator.userAgent.includes('iPhone')) {
                // 화면 전체에 짧은 플래시 효과
                document.body.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                setTimeout(() => {
                    document.body.style.backgroundColor = '';
                }, 100);
            }
        }

        // 숫자 입력
        function inputDigit(digit) {
            // 햅틱 피드백
            hapticFeedback(50);
            
            // 키패드 사용 통계 기록
            recordKeypadUsage();
            
            currentInput += digit;
            document.getElementById('number-display').textContent = currentInput || '0';
        }

        // 입력 초기화
        function clearInput() {
            // 햅틱 피드백
            hapticFeedback(30);
            
            // 키패드 사용 통계 기록
            recordKeypadUsage();
            
            currentInput = '';
            document.getElementById('number-display').textContent = '0';
        }

        // 백스페이스
        function backspace() {
            // 햅틱 피드백
            hapticFeedback(30);
            
            // 키패드 사용 통계 기록
            recordKeypadUsage();
            
            currentInput = currentInput.slice(0, -1);
            document.getElementById('number-display').textContent = currentInput || '0';
        }

        // 엔터 (숫자 입력 완료)
        function enterNumber() {
            // 햅틱 피드백 (더 강한 진동)
            hapticFeedback([50, 30, 50]);
            
            // 키패드 사용 통계 기록
            recordKeypadUsage();
            
            if (currentStationIndex < stations.length && currentStationIndex >= 0) {
                // 입력된 숫자가 있으면 그 값을, 없으면 0을 추가
                const inputValue = currentInput ? parseInt(currentInput) : 0;
                
                // 쿠팡/컬리일 때 45명 제한 로직 (0명이 아닐 때만 체크)
                if (currentService === 'coupang' || currentService === 'kurly') {
                    let currentTotal = 0;
                    if (selectedTimePeriod === 'morning') {
                        currentTotal = stations.reduce((sum, station) => sum + (station.morningCount || 0), 0);
                        const newTotal = currentTotal + inputValue;
                        if (newTotal > 45) {
                            alert('총 인원은 45명을 초과할 수 없습니다.');
                            return;
                        }
                    } else if (selectedTimePeriod === 'afternoon') {
                        currentTotal = stations.reduce((sum, station) => sum + (station.afternoonCount || 0), 0);
                        const newTotal = currentTotal + inputValue;
                        if (newTotal > 45) {
                            alert('총 인원은 45명을 초과할 수 없습니다.');
                            return;
                        }
                    } else if (selectedTimePeriod === 'evening') {
                        // 퇴근운행도 45명 제한 적용
                        currentTotal = stations.reduce((sum, station) => sum + (station.eveningCount || 0), 0);
                        const newTotal = currentTotal + inputValue;
                        if (newTotal > 45) {
                            alert('총 인원은 45명을 초과할 수 없습니다.');
                            return;
                        }
                    }
                }
                
                // 선택된 시간대에 따라 카운트 저장
                if (selectedTimePeriod === 'morning') {
                    stations[currentStationIndex].morningCount += inputValue;
                } else if (selectedTimePeriod === 'afternoon') {
                    stations[currentStationIndex].afternoonCount += inputValue;
                    
                    // 오후운행 시작 시 오전운행 완료 플래그 초기화
                    const morningRunCompleted = loadFromLocalStorage('morningRunCompleted');
                    if (morningRunCompleted === 'true') {
                        saveToLocalStorage('morningRunCompleted', 'false');
                        console.log('오후운행 시작, 오전운행 완료 플래그 초기화');
                    }
                } else if (selectedTimePeriod === 'evening') {
                    // 퇴근운행은 eveningCount 필드 사용 (없으면 생성)
                    if (!stations[currentStationIndex].eveningCount) {
                        stations[currentStationIndex].eveningCount = 0;
                    }
                    stations[currentStationIndex].eveningCount += inputValue;
                }
                
                // 기존 count도 업데이트 (호환성)
                stations[currentStationIndex].count += inputValue;
                
                currentInput = '';
                document.getElementById('number-display').textContent = '0';
                
                // 퇴근운행 모드일 때는 역순으로 이동
                if (isEveningMode) {
                    // 역순: 마지막 정류장에서 첫 번째 정류장으로
                    if (currentStationIndex > 0) {
                        currentStationIndex--;
                        console.log(`퇴근운행: 이전 정류장으로 이동: ${currentStationIndex + 1}/${stations.length}`);
                    } else {
                        // 첫 번째 정류장(역순 기준)에서는 입력 완료 상태로 변경
                        // 단, 정류장이 1개만 있을 때는 완료하지 않음
                        console.log(`퇴근운행: 첫 번째 정류장 입력 완료: ${currentStationIndex + 1}/${stations.length}`);
                        if (stations.length > 1) {
                            disableKeypad();
                        }
                    }
                } else {
                    // 정순: 첫 번째 정류장에서 마지막 정류장으로
                    // 모든 정류장을 순회했는지 확인
                if (currentStationIndex < stations.length - 1) {
                        // 아직 마지막 정류장이 아니면 다음 정류장으로 이동
                    currentStationIndex++;
                        console.log(`다음 정류장으로 이동: ${currentStationIndex + 1}/${stations.length}`);
                } else {
                        // 마지막 정류장에 도달했을 때만 완료 처리
                        // 단, 정류장이 1개만 있을 때는 완료하지 않음 (계속 입력 가능)
                        console.log(`마지막 정류장 입력 완료: ${currentStationIndex + 1}/${stations.length}, 총 정류장 수: ${stations.length}`);
                        if (stations.length > 1) {
                            // 마지막 정류장에서 입력했을 때만 완료
                    disableKeypad();
                        } else {
                            // 단일 정류장일 때는 완료하지 않고 계속 입력 가능
                            console.log('단일 정류장: 완료하지 않고 계속 입력 가능');
                        }
                    }
                }
                
                updateKeypadPage();
                
                // localStorage에 저장 (오류 처리 포함)
                const storageKey = currentService === 'kurly' ? 'kurlySavedStations' : 'savedStations';
                const indexKey = currentService === 'kurly' ? 'kurlyCurrentStationIndex' : 'currentStationIndex';
                saveToLocalStorage(storageKey, JSON.stringify(stations));
                saveToLocalStorage(indexKey, currentStationIndex.toString());
            }
        }

        // 키패드 비활성화 함수
        function disableKeypad() {
            const keypadButtons = document.querySelectorAll('.keypad-btn, .enter-btn');
            keypadButtons.forEach(button => {
                // 도착시간 버튼은 비활성화하지 않음
                if (button.id === 'arrival-time-btn' || button.onclick && button.onclick.toString().includes('recordArrivalTime')) {
                    return;
                }
                button.disabled = true;
                button.style.opacity = '0.5';
                button.style.cursor = 'not-allowed';
            });
            
            // 완료 메시지 표시
            const inputDisplay = document.getElementById('number-display');
            inputDisplay.textContent = '완료';
            inputDisplay.style.color = '#4CAF50';
            inputDisplay.style.fontSize = '2rem';
            
            // 현재 운행 시간대를 완료 상태로 표시
            completedTimePeriods[selectedTimePeriod] = true;
            console.log(`${selectedTimePeriod === 'morning' ? '오전' : '오후'}운행 완료`);

            // 오전운행 완료 시 완료 상태를 별도로 저장
            if (selectedTimePeriod === 'morning') {
                saveToLocalStorage('morningRunCompleted', 'true');
                console.log('오전운행 완료 상태 저장');
            }
            
            // 도착시간 버튼 표시 (컬리 전용, 각 시간대별로 표시)
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            if (arrivalTimeRow) {
                if (currentService === 'kurly') {
                    const arrivalTimeBtn = document.getElementById('arrival-time-btn');
                    // 현재 선택된 시간대가 완료되었고 해당 시간대의 도착시간이 기록되지 않았을 때 표시
                    const currentPeriodCompleted = completedTimePeriods[selectedTimePeriod];
                    let currentArrivalTime = null;
                    if (selectedTimePeriod === 'morning') {
                        currentArrivalTime = morningArrivalTime;
                    } else if (selectedTimePeriod === 'afternoon') {
                        currentArrivalTime = afternoonArrivalTime;
                    } else if (selectedTimePeriod === 'evening') {
                        currentArrivalTime = eveningArrivalTime;
                    }
                    
                    if (currentPeriodCompleted && !currentArrivalTime) {
                        arrivalTimeRow.style.display = 'block';
                        arrivalTimeRow.style.visibility = 'visible';
                        arrivalTimeRow.style.opacity = '1';
                        arrivalTimeRow.style.height = 'auto';
                        arrivalTimeRow.style.marginTop = '-5px';
                        arrivalTimeRow.style.marginBottom = '0';
                        arrivalTimeRow.style.paddingTop = '0';
                        arrivalTimeRow.style.padding = '0 10px';
                        arrivalTimeRow.style.overflow = 'visible';
                        // 도착시간 버튼 명시적으로 활성화
                        if (arrivalTimeBtn) {
                            arrivalTimeBtn.disabled = false;
                            arrivalTimeBtn.style.opacity = '1';
                            arrivalTimeBtn.style.cursor = 'pointer';
                        }
                    } else {
                        // 현재 시간대가 완료되지 않았거나 도착시간이 이미 기록된 경우 숨기기
                        arrivalTimeRow.style.display = 'none';
                        arrivalTimeRow.style.visibility = 'hidden';
                        arrivalTimeRow.style.opacity = '0';
                        arrivalTimeRow.style.height = '0';
                        arrivalTimeRow.style.marginTop = '0';
                        arrivalTimeRow.style.marginBottom = '0';
                    }
                } else {
                    // 쿠팡일 때는 항상 완전히 숨기기
                    arrivalTimeRow.style.display = 'none';
                    arrivalTimeRow.style.visibility = 'hidden';
                    arrivalTimeRow.style.opacity = '0';
                    arrivalTimeRow.style.height = '0';
                    arrivalTimeRow.style.marginTop = '0';
                    arrivalTimeRow.style.marginBottom = '0';
                    arrivalTimeRow.style.padding = '0';
                    arrivalTimeRow.style.overflow = 'hidden';
                }
            }

            // 키패드 비활성화 상태 저장
            saveToLocalStorage('keypadDisabled', 'true');     
            saveToLocalStorage('completedTimePeriods', JSON.stringify(completedTimePeriods));
        }

        // 키패드 활성화 함수
        function enableKeypad() {
            const keypadButtons = document.querySelectorAll('.keypad-btn, .enter-btn');
            keypadButtons.forEach(button => {
                // 도착시간 버튼은 별도로 관리 (비활성화하지 않음)
                if (button.id === 'arrival-time-btn' || (button.onclick && button.onclick.toString().includes('recordArrivalTime'))) {
                    return;
                }
                button.disabled = false;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
            });
            
            // 입력 표시 복원
            const inputDisplay = document.getElementById('number-display');
            inputDisplay.textContent = '0';
            inputDisplay.style.color = '#fff';
            inputDisplay.style.fontSize = '3rem';
            
            // 키패드 활성화 상태 저장
            saveToLocalStorage('keypadDisabled', 'false');
        }

        // 정류장 명수만 초기화 (수동 초기화: 오전/오후 모두 초기화)
        function resetCounts() {
            if (confirm('정류장별 카운트를 초기화하시겠습니까?\n(오전/오후 모든 카운팅이 초기화됩니다)')) {
                stations.forEach(station => {
                    station.count = 0;
                    station.morningCount = 0;
                    station.afternoonCount = 0;
                    if (station.eveningCount !== undefined) {
                        station.eveningCount = 0;
                    }
                });
                currentStationIndex = 0;
                currentInput = '';
                
                // 완료 상태 초기화
                completedTimePeriods = { morning: false, afternoon: false, evening: false };
                
                // 택시 인원 초기화 (쿠팡/컬리일 때)
                if (currentService === 'coupang' || currentService === 'kurly') {
                    taxiPassengers = { morning: 0, afternoon: 0, evening: 0 };
                    localStorage.removeItem('taxiPassengers');
                }
                
                // 도착시간 초기화 (각 시간대별)
                morningArrivalTime = null;
                afternoonArrivalTime = null;
                eveningArrivalTime = null;
                localStorage.removeItem('morningArrivalTime');
                localStorage.removeItem('afternoonArrivalTime');
                localStorage.removeItem('eveningArrivalTime');
                
                // 도착시간 버튼 숨기기 (컬리일 때는 스타일 초기화, 쿠팡일 때는 완전히 숨김)
                const arrivalTimeRow = document.getElementById('arrival-time-row');
                if (arrivalTimeRow) {
                    if (currentService === 'kurly') {
                        // 컬리일 때는 스타일 초기화만
                        arrivalTimeRow.style.display = 'none';
                        arrivalTimeRow.style.visibility = '';
                        arrivalTimeRow.style.opacity = '';
                        arrivalTimeRow.style.height = '';
                        arrivalTimeRow.style.marginTop = '';
                        arrivalTimeRow.style.marginBottom = '';
                        arrivalTimeRow.style.padding = '';
                        arrivalTimeRow.style.overflow = '';
                    } else {
                        // 쿠팡일 때는 완전히 숨김
                        arrivalTimeRow.style.display = 'none';
                        arrivalTimeRow.style.visibility = 'hidden';
                        arrivalTimeRow.style.opacity = '0';
                        arrivalTimeRow.style.height = '0';
                        arrivalTimeRow.style.marginTop = '0';
                        arrivalTimeRow.style.marginBottom = '0';
                        arrivalTimeRow.style.padding = '0';
                        arrivalTimeRow.style.overflow = 'hidden';
                    }
                }
                
                enableKeypad(); // 키패드 다시 활성화
                updateKeypadPage();
                
                const storageKey = currentService === 'kurly' ? 'kurlySavedStations' : 'savedStations';
                localStorage.setItem(storageKey, JSON.stringify(stations));
                saveToLocalStorage('currentStationIndex', '0');
                
                console.log('수동 초기화: 오전/오후 모든 카운팅이 초기화되었습니다.');
            }
        }

        // 앱 초기화
        function resetApp() {
            // 확인 메시지 표시
            if (confirm('오전/오후 모든 카운팅이 초기화됩니다.\n처음으로 돌아가시겠습니까?')) {
                // 정류장명수초기화와 동일한 방식으로 모든 카운트를 0으로 설정하고 localStorage에 저장
                if (stations.length > 0) {
                    stations.forEach(station => {
                        station.count = 0;
                        station.morningCount = 0;
                        station.afternoonCount = 0;
                        if (station.eveningCount !== undefined) {
                            station.eveningCount = 0;
                        }
                    });
                    
                    // 모든 카운트를 0으로 만들고 저장
                    currentStationIndex = 0;
                    currentInput = '';
                    completedTimePeriods = { morning: false, afternoon: false, evening: false };
                    taxiPassengers = { morning: 0, afternoon: 0, evening: 0 };
                    
                    // 도착시간 초기화 (각 시간대별)
                    morningArrivalTime = null;
                    afternoonArrivalTime = null;
                    eveningArrivalTime = null;
                    localStorage.removeItem('morningArrivalTime');
                    localStorage.removeItem('afternoonArrivalTime');
                    localStorage.removeItem('eveningArrivalTime');
                    
                    // 도착시간 버튼 숨기기
                    const arrivalTimeRow = document.getElementById('arrival-time-row');
                    if (arrivalTimeRow) {
                        arrivalTimeRow.style.display = 'none';
                    }
                    
                    // 완료 상태 저장
                    const storageKey = currentService === 'kurly' ? 'kurlySavedStations' : 'savedStations';
                    localStorage.setItem(storageKey, JSON.stringify(stations));
                    saveToLocalStorage('currentStationIndex', currentStationIndex.toString());
                    saveToLocalStorage('currentInput', currentInput);
                    saveToLocalStorage('completedTimePeriods', JSON.stringify(completedTimePeriods));
                    saveToLocalStorage('taxiPassengers', JSON.stringify(taxiPassengers));
                    saveToLocalStorage('keypadDisabled', 'false');
                    saveToLocalStorage('morningRunCompleted', 'false');
                    
                    // 키패드 활성화
                    enableKeypad();
                    
                    console.log('처음으로: 모든 카운트 및 완료 상태 초기화되고 저장됨');
                }
                
                stationCount = 0;
                stations = [];
                stationNames = [];
                currentStationIndex = 0;
                currentInput = '';
                
                // localStorage 초기화
                localStorage.removeItem('savedStations');
                localStorage.removeItem('savedStationCount');
                localStorage.removeItem('savedRouteName');
                localStorage.removeItem('currentStationIndex');
                localStorage.removeItem('morningArrivalTime');
                localStorage.removeItem('afternoonArrivalTime');
                localStorage.removeItem('eveningArrivalTime');
                
                // 컬리 관련 localStorage도 초기화
                localStorage.removeItem('kurlySavedStations');
                localStorage.removeItem('kurlySavedStationCount');
                localStorage.removeItem('kurlySavedRouteName');
                localStorage.removeItem('kurlyCurrentStationIndex');
                
                document.getElementById('station-count').value = '';
                document.getElementById('count-submit').disabled = true;
                
                // 모든 페이지 숨김
                const keypadPage = document.getElementById('keypad-page');
                const stationNamesPage = document.getElementById('station-names-page');
                const stationCountPage = document.getElementById('station-count-page');
                const selectionPage = document.getElementById('selection-page');
                
                if (keypadPage) {
                    keypadPage.classList.add('hidden');
                    keypadPage.style.display = 'none';
                }
                if (stationNamesPage) {
                    stationNamesPage.classList.add('hidden');
                    stationNamesPage.style.display = 'none';
                }
                if (stationCountPage) {
                    stationCountPage.classList.add('hidden');
                    stationCountPage.style.display = 'none';
                }
                if (selectionPage) {
                    selectionPage.classList.remove('hidden');
                    selectionPage.style.display = 'flex';
                }
            }
        }

        // 직전 정류장 삭제 함수
        function deletePreviousStation() {
            // 완료 상태 확인: 마지막 정류장에 있고 키패드가 비활성화된 경우
            const isCompleted = (currentStationIndex === stations.length - 1);
            const enterBtn = document.querySelector('.enter-btn');
            const isKeypadDisabled = enterBtn && enterBtn.disabled;
            
            if (isCompleted && isKeypadDisabled) {
                alert('모든 정류장 카운팅이 완료된 상태에서는 삭제할 수 없습니다.');
                return;
            }
            
            if (currentStationIndex === 0) {
                alert('첫 번째 정류장은 삭제할 수 없습니다.');
                return;
            }
            
            if (confirm('직전 정류장의 카운트를 삭제하시겠습니까?')) {
                // 직전 정류장의 모든 카운트를 0으로 초기화
                stations[currentStationIndex - 1].count = 0;
                stations[currentStationIndex - 1].morningCount = 0;
                stations[currentStationIndex - 1].afternoonCount = 0;
                
                // 현재 정류장을 직전 정류장으로 이동
                currentStationIndex--;
                
                // localStorage에 저장
                saveToLocalStorage('savedStations', JSON.stringify(stations));
                saveToLocalStorage('currentStationIndex', currentStationIndex.toString());
                
                // 키패드 페이지 업데이트
                updateKeypadPage();
                
                console.log('직전 정류장 카운트 삭제 완료');
            }
        }


        // 키보드 이벤트
        document.addEventListener('keydown', function(event) {
            if (document.getElementById('keypad-page').classList.contains('hidden')) return;
            
            // 키패드가 비활성화된 상태에서는 키보드 입력 무시
            const enterBtn = document.querySelector('.enter-btn');
            if (enterBtn && enterBtn.disabled) return;
            
            if (event.key >= '0' && event.key <= '9') {
                inputDigit(event.key);
            } else if (event.key === 'Enter') {
                enterNumber();
            } else if (event.key === 'Escape') {
                clearInput();
            } else if (event.key === 'Backspace') {
                backspace();
            }
        });

        // 페이지 로드 시 초기화
        window.addEventListener('load', function() {
            // 시작 페이지를 기본으로 표시하고 다른 페이지들은 숨김
            document.getElementById('selection-page').classList.remove('hidden');
            document.getElementById('station-count-page').classList.add('hidden');
            document.getElementById('station-names-page').classList.add('hidden');
            document.getElementById('keypad-page').classList.add('hidden');
            
            loadTheme();
            loadSavedTimePeriod();
            loadSavedStations();
            setKoreanInputMode();
            
            // 사용자 접속 기록
            recordUserAccess();
            
            // 다크모드 버튼 5초 후 자동 숨김
            hideThemeButton();
            
            // 공지사항 모달 표시 확인
            checkNoticeModal();
            
            // 공유 버튼 이벤트 리스너 추가
            const kakaoShareBtn = document.getElementById('kakao-share-btn');
            if (kakaoShareBtn) {
                kakaoShareBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('카카오톡 공유 버튼 클릭됨');
                    generateAndShareImage();
                });
            }
        });

        // 한글 입력 모드 자동 설정
        function setKoreanInputMode() {
            // 모든 텍스트 입력 필드에 한글 입력 모드 설정
            const textInputs = document.querySelectorAll('input[type="text"]');
            textInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    // 한글 입력 모드 활성화
                    this.setAttribute('lang', 'ko');
                    this.style.imeMode = 'active';
                });
            });
        }

        // 오후 마지막 정류장 출발시간 50분 후 초기화 가능 여부 확인

        // 저장된 시간대 설정 불러오기
        // 택시 인원 추가 함수 - 키패드 모달 열기
        function addTaxiPassenger() {
            if (currentService !== 'coupang' && currentService !== 'kurly') {
                return;
            }
            
            taxiInput = '';
            openTaxiKeypadModal();
        }
        
        // 택시 키패드 모달 열기
        function openTaxiKeypadModal() {
            const modal = document.getElementById('taxi-keypad-modal');
            if (modal) {
                modal.classList.add('show');
                document.getElementById('taxi-keypad-display').textContent = '0';
                taxiInput = '';
            }
        }
        
        // 택시 키패드 모달 닫기
        function closeTaxiKeypadModal() {
            const modal = document.getElementById('taxi-keypad-modal');
            if (modal) {
                modal.classList.remove('show');
                taxiInput = '';
            }
        }
        
        // 택시 키패드 숫자 입력
        function taxiInputDigit(digit) {
            taxiInput += digit;
            document.getElementById('taxi-keypad-display').textContent = taxiInput || '0';
        }
        
        // 택시 키패드 입력 초기화
        function taxiClearInput() {
            taxiInput = '';
            document.getElementById('taxi-keypad-display').textContent = '0';
        }
        
        // 택시 키패드 백스페이스
        function taxiBackspace() {
            taxiInput = taxiInput.slice(0, -1);
            document.getElementById('taxi-keypad-display').textContent = taxiInput || '0';
        }
        
        // 택시 인원 입력 확인
        function confirmTaxiInput() {
            const taxiCount = parseInt(taxiInput) || 0;
            
            if (taxiCount < 0) {
                alert('올바른 숫자를 입력해주세요.');
                return;
            }
            
            if (selectedTimePeriod === 'morning') {
                taxiPassengers.morning += taxiCount;
            } else if (selectedTimePeriod === 'afternoon') {
                taxiPassengers.afternoon += taxiCount;
            } else if (selectedTimePeriod === 'evening') {
                taxiPassengers.evening += taxiCount;
            }
            
            // localStorage에 저장
            saveToLocalStorage('taxiPassengers', JSON.stringify(taxiPassengers));
            
            updateTaxiPassengerDisplay();
            closeTaxiKeypadModal();
            
            // 택시 인원 추가 후 다음 정류장으로 이동 (45명 도달 시)
            if ((currentService === 'coupang' || currentService === 'kurly') && stations.length > 0) {
                let currentTotal = 0;
                if (selectedTimePeriod === 'morning') {
                    currentTotal = stations.reduce((sum, station) => sum + (station.morningCount || 0), 0);
                } else if (selectedTimePeriod === 'afternoon') {
                    currentTotal = stations.reduce((sum, station) => sum + (station.afternoonCount || 0), 0);
                } else if (selectedTimePeriod === 'evening') {
                    currentTotal = stations.reduce((sum, station) => sum + (station.eveningCount || 0), 0);
                }
                
                // 45명 도달 시 다음 정류장으로 이동
                if (currentTotal >= 45 && currentStationIndex < stations.length - 1) {
                    if (isEveningMode) {
                        // 퇴근운행 모드일 때는 역순
                        if (currentStationIndex > 0) {
                            currentStationIndex--;
                        }
                    } else {
                        // 정순 모드일 때는 다음 정류장으로
                        currentStationIndex++;
                    }
                    
                    // 키패드 재활성화
                    enableKeypad();
                    updateKeypadPage();
                    
                    // localStorage에 저장
                    const indexKey = currentService === 'kurly' ? 'kurlyCurrentStationIndex' : 'currentStationIndex';
                    saveToLocalStorage(indexKey, currentStationIndex.toString());
                    
                    console.log(`택시 인원 추가 후 다음 정류장으로 이동: ${currentStationIndex + 1}/${stations.length}`);
                }
            }
        }
        
        // 택시 인원 표시 업데이트
        function updateTaxiPassengerDisplay() {
            const taxiCountDisplay = document.getElementById('taxi-count-display');
            if (taxiCountDisplay) {
                let currentTaxiCount = 0;
                if (selectedTimePeriod === 'morning') {
                    currentTaxiCount = taxiPassengers.morning;
                } else if (selectedTimePeriod === 'afternoon') {
                    currentTaxiCount = taxiPassengers.afternoon;
                } else if (selectedTimePeriod === 'evening') {
                    currentTaxiCount = taxiPassengers.evening || 0;
                }
                taxiCountDisplay.textContent = currentTaxiCount;
            }
        }
        
        function loadSavedTimePeriod() {
            // 퇴근운행 모드 복원
            const savedEveningMode = localStorage.getItem('isEveningMode');
            if (savedEveningMode === 'true') {
                isEveningMode = true;
            } else {
                isEveningMode = false;
            }
            
            // 자동 시간대 선택 먼저 실행
            autoSelectTimePeriod();
            
            // 저장된 설정이 있으면 덮어쓰기 (수동 선택 우선)
            const savedPeriod = localStorage.getItem('selectedTimePeriod');
            if (savedPeriod) {
                selectedTimePeriod = savedPeriod;
                // 퇴근운행 모드 설정
                isEveningMode = (savedPeriod === 'evening');
                updateTimePeriodButtons();
            }
            
            // 도착시간 복원 (각 시간대별)
            const savedMorningArrivalTime = localStorage.getItem('morningArrivalTime');
            if (savedMorningArrivalTime) {
                morningArrivalTime = JSON.parse(savedMorningArrivalTime);
            }
            const savedAfternoonArrivalTime = localStorage.getItem('afternoonArrivalTime');
            if (savedAfternoonArrivalTime) {
                afternoonArrivalTime = JSON.parse(savedAfternoonArrivalTime);
            }
            const savedEveningArrivalTime = localStorage.getItem('eveningArrivalTime');
            if (savedEveningArrivalTime) {
                eveningArrivalTime = JSON.parse(savedEveningArrivalTime);
            }
            
            // 택시 인원 복원
            const savedTaxiPassengers = loadFromLocalStorage('taxiPassengers');
            if (savedTaxiPassengers) {
                taxiPassengers = JSON.parse(savedTaxiPassengers);
            }
        }

        // 저장된 정류장 정보 불러오기 (자동 이동 없이 데이터만 로드)
        function loadSavedStations() {
            const savedStations = JSON.parse(loadFromLocalStorage('savedStations') || '[]');
            const savedStationCount = loadFromLocalStorage('savedStationCount');
            const savedDepartureTimes = JSON.parse(loadFromLocalStorage('savedDepartureTimes') || '[]');
            const savedRouteName = loadFromLocalStorage('savedRouteName');
            
            console.log('로드된 데이터:', {
                savedStations: savedStations.length,
                savedStationCount,
                savedRouteName,
                savedDepartureTimes: savedDepartureTimes.length
            });
            
            // 저장된 데이터가 있어도 자동으로 이동하지 않음 (시작 페이지를 먼저 보여줌)
            // 쿠팡 버튼 클릭 시 restoreSavedStations() 함수를 호출하여 복원
        }

        // 저장된 정류장 정보 복원 및 키패드 페이지로 이동
        function restoreSavedStations() {
            const savedStations = JSON.parse(loadFromLocalStorage('savedStations') || '[]');
            const savedStationCount = loadFromLocalStorage('savedStationCount');
            const savedDepartureTimes = JSON.parse(loadFromLocalStorage('savedDepartureTimes') || '[]');
            const savedRouteName = loadFromLocalStorage('savedRouteName');
            
            console.log('restoreSavedStations 호출:', {
                savedRouteName: savedRouteName,
                savedStationCount: savedStationCount,
                savedStationsLength: savedStations.length,
                savedDepartureTimesLength: savedDepartureTimes.length
            });
            
            if (savedStationCount && savedStations.length > 0) {
                // 저장된 정류장 개수와 이름이 있으면 키패드 페이지로 이동
                stationCount = parseInt(savedStationCount);
                routeName = savedRouteName || '';
                
                console.log('설정된 routeName:', routeName);
                
                stations = Array.from({ length: stationCount }, (_, index) => {
                    const savedStation = savedStations[index];
                    const stationName = typeof savedStation === 'string' ? savedStation : (savedStation?.name || '');
                    
                    // 저장된 카운팅 데이터가 있으면 복원, 없으면 0으로 초기화
                    const savedCount = typeof savedStation === 'object' ? (savedStation?.count || 0) : 0;
                    const savedMorningCount = typeof savedStation === 'object' ? (savedStation?.morningCount || 0) : 0;
                    const savedAfternoonCount = typeof savedStation === 'object' ? (savedStation?.afternoonCount || 0) : 0;
                    
                    // 출발 시간 복원: savedDepartureTimes 배열에서 가져오거나, savedStation 객체에서 가져오거나, 기본값 사용
                    let departureTime = null;
                    if (savedDepartureTimes && savedDepartureTimes[index]) {
                        departureTime = savedDepartureTimes[index];
                    } else if (typeof savedStation === 'object' && savedStation?.departureTime) {
                        departureTime = savedStation.departureTime;
                    } else {
                        departureTime = { 
                            morningHour: 8, 
                            afternoonHour: 17, 
                            minute: Math.min(index * 5, 59) 
                        };
                    }
                    
                    console.log(`정류장 ${index} 복원:`, {
                        name: stationName,
                        departureTime: departureTime,
                        count: savedCount,
                        morningCount: savedMorningCount,
                        afternoonCount: savedAfternoonCount
                    });
                    
                    return {
                        id: index,
                        name: stationName,
                        count: savedCount, // 저장된 카운트 복원
                        morningCount: savedMorningCount, // 저장된 오전 카운트 복원
                        afternoonCount: savedAfternoonCount, // 저장된 오후 카운트 복원
                        departureTime: departureTime
                    };
                });
                
                // 카운팅 상태 복원 (저장된 상태가 있으면 복원, 없으면 초기화)
                const savedCurrentStationIndex = loadFromLocalStorage('currentStationIndex');
                
                // 키패드 페이지로 바로 이동
                const selectionPage = document.getElementById('selection-page');
                const stationCountPage = document.getElementById('station-count-page');
                const stationNamesPage = document.getElementById('station-names-page');
                const keypadPage = document.getElementById('keypad-page');
                
                if (selectionPage) {
                    selectionPage.classList.add('hidden');
                    selectionPage.style.display = 'none';
                }
                if (stationCountPage) {
                    stationCountPage.classList.add('hidden');
                    stationCountPage.style.display = 'none';
                }
                if (stationNamesPage) {
                    stationNamesPage.classList.add('hidden');
                    stationNamesPage.style.display = 'none';
                }
                if (keypadPage) {
                    keypadPage.classList.remove('hidden');
                    keypadPage.style.display = 'block';
                }
                
                // 시계 시작
                updateClock();
                setInterval(updateClock, 1000);
                
                // 키패드 활성화 상태로 설정
                enableKeypad();
                
                // 현재 시간에 따른 자동 시간대 선택
                const previousTimePeriod = loadFromLocalStorage('selectedTimePeriod');
                console.log(`이전 시간대: ${previousTimePeriod}`);
                autoSelectTimePeriod();
                console.log(`현재 선택된 시간대: ${selectedTimePeriod}`);
                
                // 시간대가 바뀌었는지 확인하고 정류장 인덱스 초기화
                console.log(`시간대 비교: 이전=${previousTimePeriod}, 현재=${selectedTimePeriod}`);
                
                // 오전운행 완료 상태 확인
                const morningRunCompleted = loadFromLocalStorage('morningRunCompleted');
                console.log(`오전운행 완료 상태: ${morningRunCompleted}`);
                
                if (previousTimePeriod && previousTimePeriod !== selectedTimePeriod) {
                    // 시간대가 바뀌었으면 첫 번째 정류장부터 시작 (localStorage 값 무시)
                    currentStationIndex = 0;
                    currentInput = '';
                    saveToLocalStorage('currentStationIndex', '0');
                    saveToLocalStorage('currentInput', '');
                    console.log(`시간대 변경 감지: ${previousTimePeriod} → ${selectedTimePeriod}, 정류장 인덱스 초기화 (localStorage 무시)`);
                } else if (morningRunCompleted === 'true' && selectedTimePeriod === 'afternoon') {
                    // 오전운행이 완료되었고 현재 오후시간대이면 첫 번째 정류장부터 시작
                    // 하지만 오전운행 완료 상태는 유지 (오후운행을 새로 시작할 수 있도록)
                    currentStationIndex = 0;
                    currentInput = '';
                    saveToLocalStorage('currentStationIndex', '0');
                    saveToLocalStorage('currentInput', '');
                    // morningRunCompleted 플래그는 유지 (오후운행 시작 후에만 초기화)
                    console.log(`오전운행 완료 후 오후시간대 진입, 오후운행 시작을 위해 정류장 인덱스 초기화`);
                } else {
                    // 시간대가 같으면 저장된 상태 복원
                    console.log(`저장된 정류장 인덱스: ${savedCurrentStationIndex}`);
                    currentStationIndex = savedCurrentStationIndex ? parseInt(savedCurrentStationIndex) : 0;
                    currentInput = '';
                    console.log(`시간대 동일: ${previousTimePeriod}, 저장된 정류장 인덱스 복원: ${currentStationIndex}`);
                }
                
                updateKeypadPage();
                restoreKeypadState();
            }
        }

        // 이미지 생성 및 공유 기능
        let generatedImageDataUrl = null;

        // 이미지 생성 함수 (샘플 이미지와 동일한 구조)
        function generateResultImage() {
            // 컬리일 때는 kurlySavedRouteName 사용
            const currentRouteName = currentService === 'kurly' 
                ? (loadFromLocalStorage('kurlySavedRouteName') || routeName || '')
                : (loadFromLocalStorage('savedRouteName') || routeName || '');
            console.log('이미지 생성 시작, routeName:', currentRouteName, 'currentService:', currentService);
            console.log('현재 선택된 시간대:', selectedTimePeriod);
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // 캔버스 크기 설정 (컬리일 때는 도착시간 행 추가, 쿠팡/컬리일 때는 택시 인원 행 추가)
            const isKurly = currentService === 'kurly';
            const isCoupang = currentService === 'coupang';
            canvas.width = 1300;
            // 택시 인원이 있을 때만 행 추가
            const hasTaxiPassengers = (taxiPassengers.morning > 0 || taxiPassengers.afternoon > 0 || (isKurly && taxiPassengers.evening > 0));
            let extraHeight = 0;
            if (isKurly) {
                extraHeight += 40; // 도착시간 행
            }
            if ((isCoupang || isKurly) && hasTaxiPassengers) {
                extraHeight += 40; // 택시 인원 행
            }
            canvas.height = 350 + (stations.length * 40) + extraHeight;
            
            // 배경색 설정
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 테이블 설정
            const tableX = 10; // 좌우 여백 최소화
            const tableY = 50;
            const tableWidth = canvas.width - (tableX * 2); // 화면 너비에 맞춰 동적 계산
            const rowHeight = 40;
            
            // 정류장 이름 최대 길이 측정하여 동적 컬럼 너비 계산
            ctx.font = '28px Arial';
            let maxStationNameWidth = 0;
            stations.forEach(station => {
                const stationText = `${stations.indexOf(station) + 1}. ${station.name}`;
                const textWidth = ctx.measureText(stationText).width;
                if (textWidth > maxStationNameWidth) {
                    maxStationNameWidth = textWidth;
                }
            });
            
            // 최소 너비 보장 (노선명 + 여백)
            const minFirstColWidth = tableWidth * (isKurly ? 0.4 : 0.5);
            const requiredFirstColWidth = Math.max(minFirstColWidth, maxStationNameWidth + 30); // 여백 30px 추가
            
            // 나머지 컬럼 너비 계산
            const remainingWidth = tableWidth - requiredFirstColWidth;
            const otherColCount = isKurly ? 5 : 4; // 첫 번째 컬럼 제외한 컬럼 수
            const otherColWidth = remainingWidth / otherColCount;
            
            // 컬럼 너비 설정 (컬리일 때 6개 컬럼, 쿠팡일 때 5개 컬럼) - 동적 계산
            const colWidths = isKurly ? [
                requiredFirstColWidth,  // 노선명 (동적)
                otherColWidth,  // 오전출발시간
                otherColWidth,  // 오전승차인원
                otherColWidth,  // 오후출발시간
                otherColWidth,  // 오후승차인원
                otherColWidth   // 퇴근인원
            ] : [
                requiredFirstColWidth,  // 노선명 (동적)
                otherColWidth,  // 오전출발시간
                otherColWidth,  // 오전승차인원
                otherColWidth,  // 오후출발시간
                otherColWidth   // 오후승차인원
            ];
            
            // 테이블 테두리 (컬리일 때는 도착시간 행 추가, 쿠팡/컬리일 때는 택시 인원 행 추가 - 택시 인원이 있을 때만)
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 1;
            let totalRows = stations.length + 1; // 정류장 행 + 총계 행
            if (isKurly) {
                totalRows += 1; // 도착시간 행
            }
            if ((isCoupang || isKurly) && hasTaxiPassengers) {
                totalRows += 1; // 택시 인원 행
            }
            ctx.strokeRect(tableX, tableY, tableWidth, rowHeight + (totalRows * rowHeight));
            
            // 컬럼 헤더 행 (주황색/연두색 배경)
            const headerRowY = tableY;
            
            // 컬럼 헤더 배경색
            let currentX = tableX;
            for (let i = 0; i < colWidths.length; i++) {
                if (i === 0) {
                    // 첫 번째 컬럼 (노선이름 통합) - 주황색
                    ctx.fillStyle = '#FF8C00';
                } else if (i === 1 || i === 3) {
                    // 출발시간 컬럼 - 연두색
                    ctx.fillStyle = '#C6E0B4';
                } else if (i === 2 || i === 4 || (isKurly && i === 5)) {
                    // 승차인원 컬럼 및 퇴근인원 컬럼 - 연두색
                    ctx.fillStyle = '#C6E0B4';
                } else {
                    // 빈공간 컬럼 - 흰색
                    ctx.fillStyle = '#FFFFFF';
                }
                ctx.fillRect(currentX, headerRowY, colWidths[i], rowHeight);
                currentX += colWidths[i];
            }
            
            // 헤더 세로선 그리기
            currentX = tableX;
            for (let i = 0; i < colWidths.length; i++) {
                currentX += colWidths[i];
                ctx.beginPath();
                ctx.moveTo(currentX, headerRowY);
                ctx.lineTo(currentX, headerRowY + rowHeight);
                ctx.stroke();
            }
            
            // 컬럼 헤더 텍스트 (글자 크기 증가)
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 30px Arial';
            ctx.textAlign = 'center';
            
            currentX = tableX;
            const headers = isKurly ? ['', '출발시간', '승차인원', '출발시간', '승차인원', '퇴근인원'] : ['', '출발시간', '승차인원', '출발시간', '승차인원'];
            for (let i = 0; i < headers.length; i++) {
                if (i === 0) {
                    // 첫 번째 컬럼에 노선이름 표시 (검은색 텍스트)
                    ctx.fillStyle = '#000000';
                    const displayRouteName = isKurly ? `컬리 / ${currentRouteName || ''}` : (currentRouteName || '');
                    ctx.fillText(displayRouteName, currentX + colWidths[i]/2, headerRowY + rowHeight/2 + 8);
                } else if (headers[i]) { // 빈 문자열이 아닌 경우만 텍스트 표시
                    ctx.fillStyle = '#000000';
                    ctx.fillText(headers[i], currentX + colWidths[i]/2, headerRowY + rowHeight/2 + 8);
                }
                currentX += colWidths[i];
            }
            
            // 데이터 행들 (글자 크기 증가)
            ctx.font = '28px Arial';
            ctx.textAlign = 'left';
            
            stations.forEach((station, index) => {
                const dataRowY = headerRowY + rowHeight + (index * rowHeight);
                
                // 데이터 행 배경색 설정
                let currentX = tableX;
                for (let i = 0; i < colWidths.length; i++) {
                    if (i === 0) {
                        // 첫 번째 컬럼 (노선이름/번호/정류장명) - 흰색
                        ctx.fillStyle = '#FFFFFF';
                    } else if ((i === 1 || i === 3) && index === 0) {
                        // 첫 번째 정류장의 출발시간 컬럼들만 - 노란색
                        ctx.fillStyle = '#FFFF00';
                    } else if (isKurly && i === 5) {
                        // 퇴근인원 열 (6열) - 연한 회색
                        ctx.fillStyle = '#E0E0E0';
                    } else {
                        // 나머지 모든 컬럼들 - 흰색
                        ctx.fillStyle = '#FFFFFF';
                    }
                    ctx.fillRect(currentX, dataRowY, colWidths[i], rowHeight);
                    currentX += colWidths[i];
                }
                
                // 행 테두리
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 1;
                ctx.strokeRect(tableX, dataRowY, tableWidth, rowHeight);
                
                // 세로선 그리기
                currentX = tableX;
                for (let i = 0; i < colWidths.length; i++) {
                    currentX += colWidths[i];
                    ctx.beginPath();
                    ctx.moveTo(currentX, dataRowY);
                    ctx.lineTo(currentX, dataRowY + rowHeight);
                    ctx.stroke();
                }
                
                // 번호와 정류장명 표시 (1열에 통합)
                ctx.fillStyle = '#000000';
                ctx.fillText(`${index + 1}. ${station.name}`, tableX + 10, dataRowY + rowHeight/2 + 8);
                
                // 오전/오후 모든 데이터 표시
                const morningHour = station.departureTime?.morningHour || 8;
                const morningMinute = isKurly ? (station.departureTime?.morningMinute || 0) : (station.departureTime?.minute || 0);
                const morningTimeStr = `${morningHour}:${String(morningMinute).padStart(2, '0')}`;
                
                const afternoonHour = station.departureTime?.afternoonHour || 17;
                const afternoonMinute = isKurly ? (station.departureTime?.afternoonMinute || 0) : (station.departureTime?.minute || 0);
                const afternoonTimeStr = `${afternoonHour}:${String(afternoonMinute).padStart(2, '0')}`;
                
                ctx.textAlign = 'center';
                
                // 오전 출발시간 (2열)
                ctx.fillStyle = '#000000';
                ctx.fillText(morningTimeStr, tableX + colWidths[0] + colWidths[1]/2, dataRowY + rowHeight/2 + 8);
                
                // 오전 승차인원 (3열)
                ctx.fillStyle = '#000000';
                ctx.fillText(station.morningCount?.toString() || '0', tableX + colWidths[0] + colWidths[1] + colWidths[2]/2, dataRowY + rowHeight/2 + 8);
                
                // 오후 출발시간 (4열)
                ctx.fillStyle = '#000000';
                ctx.fillText(afternoonTimeStr, tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3]/2, dataRowY + rowHeight/2 + 8);
                
                // 오후 승차인원 (5열)
                ctx.fillStyle = '#000000';
                ctx.fillText(station.afternoonCount?.toString() || '0', tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4]/2, dataRowY + rowHeight/2 + 8);
                
                // 퇴근 인원 (6열) - 컬리일 때만 표시
                if (isKurly) {
                    ctx.fillStyle = '#000000';
                    ctx.fillText((station.eveningCount || 0).toString(), tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4] + colWidths[5]/2, dataRowY + rowHeight/2 + 8);
                }
                
                ctx.textAlign = 'left';
            });
            
            // 컬리일 때 도착시간 행 추가
            if (isKurly) {
                const arrivalRowY = headerRowY + rowHeight + (stations.length * rowHeight);
                
                // 도착시간 행 배경색 설정 (상아색)
                let currentX = tableX;
                for (let i = 0; i < colWidths.length; i++) {
                    ctx.fillStyle = '#F5F5DC'; // 상아색
                    ctx.fillRect(currentX, arrivalRowY, colWidths[i], rowHeight);
                    currentX += colWidths[i];
                }
                
                // 도착시간 행 테두리
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 1;
                ctx.strokeRect(tableX, arrivalRowY, tableWidth, rowHeight);
                
                // 세로선 그리기
                currentX = tableX;
                for (let i = 0; i < colWidths.length; i++) {
                    currentX += colWidths[i];
                    ctx.beginPath();
                    ctx.moveTo(currentX, arrivalRowY);
                    ctx.lineTo(currentX, arrivalRowY + rowHeight);
                    ctx.stroke();
                }
                
                // 도착시간 행 텍스트
                ctx.fillStyle = '#000000';
                ctx.font = '28px Arial';
                ctx.textAlign = 'left';
                const arrivalText = `${stations.length + 1}. 마켓컬리 창원센터 도착 시간 기재`;
                ctx.fillText(arrivalText, tableX + 10, arrivalRowY + rowHeight/2 + 8);
                
                // 각 시간대별 도착시간 표시
                ctx.textAlign = 'center';
                
                // 14시운행 도착시간 (오전 출발시간 컬럼에 표시)
                if (morningArrivalTime) {
                    const morningTimeStr = `${String(morningArrivalTime.hour).padStart(2, '0')}:${String(morningArrivalTime.minute).padStart(2, '0')}`;
                    ctx.fillText(morningTimeStr, tableX + colWidths[0] + colWidths[1]/2, arrivalRowY + rowHeight/2 + 8);
                }
                
                // 17시운행 도착시간 (오후 출발시간 컬럼에 표시)
                if (afternoonArrivalTime) {
                    const afternoonTimeStr = `${String(afternoonArrivalTime.hour).padStart(2, '0')}:${String(afternoonArrivalTime.minute).padStart(2, '0')}`;
                    ctx.fillText(afternoonTimeStr, tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3]/2, arrivalRowY + rowHeight/2 + 8);
                }
                
                // 퇴근운행 도착시간 (퇴근인원 컬럼에 표시)
                if (eveningArrivalTime) {
                    const eveningTimeStr = `${String(eveningArrivalTime.hour).padStart(2, '0')}:${String(eveningArrivalTime.minute).padStart(2, '0')}`;
                    ctx.fillText(eveningTimeStr, tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4] + colWidths[5]/2, arrivalRowY + rowHeight/2 + 8);
                }
                
                // 기존 코드 제거 (arrivalTime 사용하던 부분)
                if (false) {
                    const timeStr = `${String(arrivalTime.hour).padStart(2, '0')}:${String(arrivalTime.minute).padStart(2, '0')}`;
                    // 14시운행 출발시간 열에 표시
                    const morningTimeColX = tableX + colWidths[0] + colWidths[1]/2;
                    ctx.fillText(timeStr, morningTimeColX, arrivalRowY + rowHeight/2 + 8);
                }
                
                ctx.textAlign = 'left';
            }
            
            // 총계 행 (흰색 배경) - 컬리일 때는 도착시간 행 다음
            const totalRowY = headerRowY + rowHeight + (stations.length * rowHeight) + (isKurly ? rowHeight : 0);
            
            // 총계 행 배경색 설정
            let currentXTotal = tableX;
            for (let i = 0; i < colWidths.length; i++) {
                if (isKurly && i === 5) {
                    // 퇴근인원 열 (6열) - 연한 회색
                    ctx.fillStyle = '#E0E0E0';
                } else {
            ctx.fillStyle = '#FFFFFF';
                }
                ctx.fillRect(currentXTotal, totalRowY, colWidths[i], rowHeight);
                currentXTotal += colWidths[i];
            }
            
            // 총계 행 세로선 그리기
            currentX = tableX;
            for (let i = 0; i < colWidths.length; i++) {
                currentX += colWidths[i];
                ctx.beginPath();
                ctx.moveTo(currentX, totalRowY);
                ctx.lineTo(currentX, totalRowY + rowHeight);
                ctx.stroke();
            }
            
            // 총계 행 하단 테두리 그리기
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2; // 더 두껍게
            ctx.beginPath();
            ctx.moveTo(tableX, totalRowY + rowHeight);
            ctx.lineTo(tableX + tableWidth, totalRowY + rowHeight);
            ctx.stroke();
            
            // "계" 텍스트 (글자 크기 증가)
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('계', tableX + 10, totalRowY + rowHeight/2 + 8);
            
            // 총계 계산 및 표시 (오전/오후 모든 데이터)
            ctx.textAlign = 'center';
            const morningTotal = stations.reduce((sum, station) => sum + (station.morningCount || 0), 0);
            const afternoonTotal = stations.reduce((sum, station) => sum + (station.afternoonCount || 0), 0);
            const eveningTotal = isKurly ? stations.reduce((sum, station) => sum + (station.eveningCount || 0), 0) : 0;
            
            // 오전 총계 (3열)
            ctx.fillText(morningTotal.toString(), tableX + colWidths[0] + colWidths[1] + colWidths[2]/2, totalRowY + rowHeight/2 + 8);
            
            // 오후 총계 (5열)
            ctx.fillText(afternoonTotal.toString(), tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4]/2, totalRowY + rowHeight/2 + 8);
            
            // 퇴근 총계 (6열) - 컬리일 때만 표시
            if (isKurly) {
                ctx.fillText(eveningTotal.toString(), tableX + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3] + colWidths[4] + colWidths[5]/2, totalRowY + rowHeight/2 + 8);
            }
            
            // 쿠팡/컬리일 때 택시 인원 정보 표시 (총계 행 아래, 택시 인원이 있을 때만)
            if ((isCoupang || isKurly) && hasTaxiPassengers) {
                const taxiRowY = totalRowY + rowHeight;
                
                // 택시 인원 행 배경색 (연두색)
                ctx.fillStyle = '#C6E0B4';
                ctx.fillRect(tableX, taxiRowY, tableWidth, rowHeight);
                
                // 택시 인원 행 테두리
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 1;
                ctx.strokeRect(tableX, taxiRowY, tableWidth, rowHeight);
                
                // 세로선 그리기
                currentX = tableX;
                for (let i = 0; i < colWidths.length; i++) {
                    currentX += colWidths[i];
                    ctx.beginPath();
                    ctx.moveTo(currentX, taxiRowY);
                    ctx.lineTo(currentX, taxiRowY + rowHeight);
                    ctx.stroke();
                }
                
                // 택시 인원 텍스트 표시 (0보다 큰 경우만 표시)
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 28px Arial';
                ctx.textAlign = 'left';
                let taxiTextParts = [];
                
                if (isKurly) {
                    // 컬리는 오전/오후/퇴근 모두 표시 (0보다 큰 경우만)
                    if (taxiPassengers.morning > 0) {
                        taxiTextParts.push(`오전택시인원 ${taxiPassengers.morning}명`);
                    }
                    if (taxiPassengers.afternoon > 0) {
                        taxiTextParts.push(`오후택시인원 ${taxiPassengers.afternoon}명`);
                    }
                    if (taxiPassengers.evening > 0) {
                        taxiTextParts.push(`퇴근택시인원 ${taxiPassengers.evening}명`);
                    }
                } else {
                    // 쿠팡은 오전/오후만 표시 (0보다 큰 경우만)
                    if (taxiPassengers.morning > 0) {
                        taxiTextParts.push(`오전택시인원 ${taxiPassengers.morning}명`);
                    }
                    if (taxiPassengers.afternoon > 0) {
                        taxiTextParts.push(`오후택시인원 ${taxiPassengers.afternoon}명`);
                    }
                }
                
                // 택시 인원이 하나라도 있으면 표시
                if (taxiTextParts.length > 0) {
                    const taxiText = taxiTextParts.join('  ');
                    ctx.fillText(taxiText, tableX + 10, taxiRowY + rowHeight/2 + 8);
                } else {
                    // 택시 인원이 없으면 행 자체를 숨기기 위해 배경색을 흰색으로 변경
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(tableX, taxiRowY, tableWidth, rowHeight);
                }
            }
            
            return canvas.toDataURL('image/png');
        }

        // 이미지 생성 및 공유
        function generateAndShareImage() {
            if (stations.length === 0) {
                return;
            }
            
            try {
                generatedImageDataUrl = generateResultImage();
                
                // 이미지 미리보기 표시
                const modal = document.getElementById('image-modal');
                const img = document.getElementById('generated-image');
                img.src = generatedImageDataUrl;
                modal.classList.add('show');
                
                console.log('이미지 생성 완료:', generatedImageDataUrl ? '성공' : '실패');
                
                // 카카오톡 공유 시도
                setTimeout(() => {
                    shareToKakao();
                }, 1000);
            } catch (error) {
                console.error('이미지 생성 오류:', error);
            }
        }

        // 카카오톡 공유 함수
        function shareToKakao() {
            if (!generatedImageDataUrl) {
                return;
            }
            
            console.log('공유 시도 중...');
            
            // 공유 시작
            isSharing = true;
            
            // Web Share API 사용 (모바일에서 카카오톡 공유 가능)
            if (navigator.share) {
                console.log('Web Share API 지원됨');
                
                // 이미지를 Blob으로 변환
                fetch(generatedImageDataUrl)
                    .then(res => res.blob())
                    .then(blob => {
                        console.log('Blob 생성 완료:', blob.size, 'bytes');
                        const file = new File([blob], 'bus-count-result.png', { type: 'image/png' });
                        
                        navigator.share({
                            files: [file]
                        }).then(() => {
                            console.log('공유 성공');
                            // 공유 완료 후 3초 뒤 플래그 해제
                            setTimeout(() => {
                                isSharing = false;
                            }, 3000);
                        }).catch(err => {
                            console.log('공유 실패:', err);
                            isSharing = false;
                        });
                    })
                    .catch(err => {
                        console.error('Blob 생성 실패:', err);
                        isSharing = false;
                    });
            } else {
                console.log('Web Share API 미지원');
                isSharing = false;
            }
        }

        // 이미지 모달 닫기
        function closeImageModal() {
            const modal = document.getElementById('image-modal');
            modal.classList.remove('show');
        }

        // 모달 외부 클릭 시 닫기
        document.getElementById('image-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        // 자정 자동 카운트 초기화 함수
        function checkMidnightReset() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // 자정(00:00)인지 확인
            if (currentHour === 0 && currentMinute === 0) {
                // 마지막 초기화 날짜 확인
                const today = now.toDateString();
                const lastResetDate = localStorage.getItem('lastResetDate');
                
                if (lastResetDate !== today) {
                    if (stations && stations.length > 0) {
                        // 모든 카운트 초기화
                        stations.forEach(station => {
                            station.count = 0;
                            station.morningCount = 0;
                            station.afternoonCount = 0;
                        });
                        currentStationIndex = 0;
                        currentInput = '';
                        
                        // 완료 상태 초기화
                        completedTimePeriods = { morning: false, afternoon: false };
                        
                        enableKeypad();
                        updateKeypadPage();
                        localStorage.setItem('savedStations', JSON.stringify(stations));
                        saveToLocalStorage('currentStationIndex', '0');
                        
                        // 오늘 초기화했다고 기록
                        localStorage.setItem('lastResetDate', today);
                        
                        // 사용자에게 알림 표시
                        alert('자정이 되었습니다. 모든 카운트가 자동으로 초기화되었습니다.');
                        console.log('자정 자동 초기화: 모든 카운팅이 초기화되었습니다.');
                    }
                }
            }
        }

        // 키패드 상태 복원 함수
        function restoreKeypadState() {
            const keypadDisabled = localStorage.getItem('keypadDisabled');
            if (keypadDisabled === 'true') {
                // 키패드가 비활성화된 상태였다면, 현재 시간대에 따라 재활성화 여부 결정
                const now = new Date();
                const currentHour = now.getHours();
                
                // 오전 시간대(6-12시)이고 오전 운행이 완료된 경우, 또는 오후 시간대(13-22시)이고 오후 운행이 완료된 경우
                if ((currentHour >= 6 && currentHour < 12 && selectedTimePeriod === 'morning') ||
                    (currentHour >= 13 && currentHour < 22 && selectedTimePeriod === 'afternoon')) {
                    // 해당 시간대 운행이 완료된 상태이므로 키패드 비활성화 유지
                    disableKeypad();
                } else {
                    // 다른 시간대로 전환 가능하므로 키패드 활성화
                    enableKeypad();
                }
            }
            
            // 현재 정류장 인덱스 복원
            // stations 배열이 초기화되어 있는지 확인
            if (!stations || stations.length === 0) {
                console.log('restoreKeypadState: stations 배열이 비어있어 인덱스 복원을 건너뜁니다.');
                return;
            }
            
            const savedCurrentStationIndex = loadFromLocalStorage('currentStationIndex');
            if (savedCurrentStationIndex !== null && savedCurrentStationIndex !== undefined) {
                const parsedIndex = parseInt(savedCurrentStationIndex);
                // 유효한 인덱스인지 확인
                if (parsedIndex >= 0 && parsedIndex < stations.length) {
                    currentStationIndex = parsedIndex;
                    updateKeypadPage();
                } else {
                    console.log(`restoreKeypadState: 저장된 인덱스(${parsedIndex})가 유효하지 않습니다. 기본값 0으로 설정합니다.`);
                    currentStationIndex = 0;
                updateKeypadPage();
                }
            }
        }

        // 페이지 로드 시 초기화
        window.addEventListener('load', function() {
            // 모든 페이지를 먼저 숨김
            const selectionPage = document.getElementById('selection-page');
            const stationCountPage = document.getElementById('station-count-page');
            const stationNamesPage = document.getElementById('station-names-page');
            const keypadPage = document.getElementById('keypad-page');
            
            // 모든 페이지 숨김
            if (stationCountPage) {
                stationCountPage.classList.add('hidden');
                stationCountPage.style.display = 'none';
            }
            if (stationNamesPage) {
                stationNamesPage.classList.add('hidden');
                stationNamesPage.style.display = 'none';
            }
            if (keypadPage) {
                keypadPage.classList.add('hidden');
                keypadPage.style.display = 'none';
            }
            
            // 시작 페이지만 표시
            if (selectionPage) {
                selectionPage.classList.remove('hidden');
                selectionPage.style.display = 'flex';
            }
            
            loadTheme();
            loadSavedStations();
            loadSavedTimePeriod();
            setKoreanInputMode();
           
           // 퇴근운행 모드 복원
           const savedEveningMode = localStorage.getItem('isEveningMode');
           if (savedEveningMode === 'true') {
               isEveningMode = true;
           }
            
            // 저장된 노선 목록 표시
            updateSavedRoutesDisplay();
            
            // 날짜 변경 확인 (페이지 로드 시)
            checkDateChangeAndReset();
            
            // 다크모드 버튼 5초 후 자동 숨김
            hideThemeButton();
            
            // 키패드 상태 복원 (시작 페이지에서는 필요 없지만 나중을 위해 유지)
            setTimeout(() => {
                restoreKeypadState();
            }, 100);
            
            // 입차현황 페이지 다크모드 적용 (페이지 로드 시)
            if (isDarkMode) {
                updateVehicleStatusDarkMode();
            }
        });

        // 공유 중인지 확인하는 변수
        let isSharing = false;

        // localStorage 저장 함수 (오류 처리 포함)
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(key, value);
                console.log(`저장 성공: ${key}`);
                return true;
            } catch (error) {
                console.error(`저장 실패: ${key}`, error);
                // 저장 실패 시 사용자에게 알림
                if (error.name === 'QuotaExceededError') {
                    alert('저장 공간이 부족합니다. 브라우저 데이터를 정리해주세요.');
                } else if (error.name === 'SecurityError') {
                    alert('보안 설정으로 인해 저장할 수 없습니다. 브라우저 설정을 확인해주세요.');
                } else {
                    alert('데이터 저장에 실패했습니다. 페이지를 새로고침하지 마세요.');
                }
                return false;
            }
        }

        // 키패드 사용 통계 기록 함수
        function recordKeypadUsage() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const keypadStats = JSON.parse(localStorage.getItem('keypadStats') || '{}');
                const dailyUsers = JSON.parse(localStorage.getItem('dailyUsers') || '{}');
                
                // 오늘 키패드 사용 횟수 증가
                keypadStats[today] = (keypadStats[today] || 0) + 1;
                localStorage.setItem('keypadStats', JSON.stringify(keypadStats));
                
                // 키패드 사용 시에도 사용자 수 증가 (세션 기반 중복 방지)
                const sessionKey = `keypad_session_${today}`;
                if (!sessionStorage.getItem(sessionKey)) {
                    dailyUsers[today] = (dailyUsers[today] || 0) + 1;
                    localStorage.setItem('dailyUsers', JSON.stringify(dailyUsers));
                    sessionStorage.setItem(sessionKey, 'true');
                    console.log(`키패드 사용으로 사용자 수 증가: ${today} - 총 ${dailyUsers[today]}명`);
                }
                
                console.log(`키패드 사용 기록: ${today} - 총 ${keypadStats[today]}회`);
            } catch (error) {
                console.error('키패드 사용 기록 실패:', error);
            }
        }

        // 사용자 접속 기록 함수
        function recordUserAccess() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const dailyUsers = JSON.parse(localStorage.getItem('dailyUsers') || '{}');
                
                // 오늘 첫 접속인지 확인 (같은 세션에서는 중복 기록 방지)
                const sessionKey = `session_${today}`;
                if (!sessionStorage.getItem(sessionKey)) {
                    dailyUsers[today] = (dailyUsers[today] || 0) + 1;
                    localStorage.setItem('dailyUsers', JSON.stringify(dailyUsers));
                    sessionStorage.setItem(sessionKey, 'true');
                    console.log(`사용자 접속 기록: ${today} - 총 ${dailyUsers[today]}명`);
                }
            } catch (error) {
                console.error('사용자 접속 기록 실패:', error);
            }
        }

        // localStorage 불러오기 함수 (오류 처리 포함)
        function loadFromLocalStorage(key, defaultValue = null) {
            try {
                const value = localStorage.getItem(key);
                console.log(`불러오기 성공: ${key}`, value);
                return value;
            } catch (error) {
                console.error(`불러오기 실패: ${key}`, error);
                return defaultValue;
            }
        }

        // 모바일 기기 감지 함수
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   (navigator.maxTouchPoints && navigator.maxTouchPoints > 2) ||
                   window.innerWidth <= 768;
        }

        // 노선 저장 함수
        function saveRoute() {
            if (!routeName || stations.length === 0) {
                alert('저장할 노선 정보가 없습니다.');
                return;
            }
            
            const routeData = {
                name: routeName,
                stationCount: stationCount,
                stations: stations.map(station => ({
                    name: station.name,
                    departureTime: station.departureTime
                })),
                savedAt: new Date().toISOString()
            };
            
            const savedRoutes = JSON.parse(loadFromLocalStorage('savedRoutes') || '[]');
            
            if (isLoadedRoute) {
                // 불러온 노선인 경우 기존 노선 업데이트
                const existingIndex = savedRoutes.findIndex(route => route.name === routeName);
                if (existingIndex !== -1) {
                    savedRoutes[existingIndex] = routeData;
                    if (saveToLocalStorage('savedRoutes', JSON.stringify(savedRoutes))) {
                        alert(`"${routeName}" 노선이 업데이트되었습니다.`);
                        updateSavedRoutesDisplay();
                    }
                }
            } else {
                // 새로운 노선인 경우 추가
                savedRoutes.push(routeData);
                if (saveToLocalStorage('savedRoutes', JSON.stringify(savedRoutes))) {
                    alert(`"${routeName}" 노선이 저장되었습니다.`);
                    updateSavedRoutesDisplay();
                    
                    // 입력 필드 초기화
                    routeName = '';
                    stationCount = 0;
                    stations = [];
                    stationNames = [];
                    currentStationIndex = 0;
                    currentInput = '';
                    isLoadedRoute = false;
                    saveToLocalStorage('currentStationIndex', '0');

                    // UI 초기화
                    document.getElementById('route-name').value = '';
                    document.getElementById('station-count').value = '';
                    
                    // 페이지 전환
                    const stationCountPage = document.getElementById('station-count-page');
                    const stationNamesPage = document.getElementById('station-names-page');
                    
                    if (stationNamesPage) {
                        stationNamesPage.classList.add('hidden');
                        stationNamesPage.style.display = 'none';
                    }
                    if (stationCountPage) {
                        stationCountPage.classList.remove('hidden');
                        stationCountPage.style.display = 'block';
                    }
                    
                    document.getElementById('count-submit').disabled = true;
                }
            }
        }

        // 저장된 노선 불러오기 함수
        function loadRoute(routeData) {
            if (confirm(`"${routeData.name}" 노선을 불러오시겠습니까?`)) {
                routeName = routeData.name;
                stationCount = routeData.stationCount;
                isLoadedRoute = true; // 불러온 노선임을 표시
                
                // 정류장 데이터 복원
                stations = routeData.stations.map((station, index) => ({
                    id: index,
                    name: station.name,
                    count: 0,
                    morningCount: 0,
                    afternoonCount: 0,
                    departureTime: station.departureTime || { 
                        morningHour: 8, 
                        afternoonHour: 17, 
                        minute: Math.min(index * 5, 59) 
                    }
                }));
                
                // 출발 시간 배열 생성
                const departureTimes = stations.map(station => station.departureTime);
                
                // 선택한 노선의 데이터를 localStorage에 저장 (중요!)
                saveToLocalStorage('savedRouteName', routeName);
                saveToLocalStorage('savedStationCount', stationCount.toString());
                saveToLocalStorage('savedStations', JSON.stringify(stations));
                saveToLocalStorage('savedDepartureTimes', JSON.stringify(departureTimes));
                
                console.log(`"${routeData.name}" 노선 데이터를 localStorage에 저장했습니다.`, {
                    routeName: routeName,
                    stationCount: stationCount,
                    stations: stations.length,
                    departureTimes: departureTimes.length
                });
                
                // 카운팅 상태 초기화
                currentStationIndex = 0;
                currentInput = '';
                saveToLocalStorage('currentStationIndex', '0');
                saveToLocalStorage('currentInput', '');
                
                // 입력 필드 업데이트
                document.getElementById('route-name').value = routeName;
                document.getElementById('station-count').value = stationCount;
                
                // 정류장 이름 입력 페이지로 이동
                const stationCountPage = document.getElementById('station-count-page');
                const stationNamesPage = document.getElementById('station-names-page');
                if (stationCountPage) {
                    stationCountPage.classList.add('hidden');
                    stationCountPage.style.display = 'none';
                }
                if (stationNamesPage) {
                    stationNamesPage.classList.remove('hidden');
                    stationNamesPage.style.display = 'block';
                }
                createStationInputs();
                
                // 버튼 상태 업데이트
                document.getElementById('start-counting').disabled = stationCount <= 0 || routeName === '';
                document.getElementById('save-route').disabled = stationCount <= 0 || routeName === '';
                
                console.log(`"${routeData.name}" 노선을 불러왔습니다.`);
            }
        }

        // 저장된 노선 목록 표시 업데이트
        function updateSavedRoutesDisplay() {
            const savedRoutes = JSON.parse(loadFromLocalStorage('savedRoutes') || '[]');
            const routesContainer = document.getElementById('saved-routes-container');
            
            if (!routesContainer) return;
            
            routesContainer.innerHTML = '';
            
            if (savedRoutes.length === 0) {
                routesContainer.innerHTML = '<p style="color: #999; text-align: center; margin: 10px 0;">저장된 노선이 없습니다.</p>';
                return;
            }
            
            savedRoutes.forEach((route, index) => {
                const routeButton = document.createElement('button');
                routeButton.className = 'saved-route-btn';
                routeButton.innerHTML = `
                    <div class="route-name">${route.name}</div>
                    <div class="route-info">${route.stationCount}개 정류장</div>
                `;
                routeButton.onclick = () => loadRoute(route);
                
                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-route-btn';
                deleteButton.innerHTML = '×';
                deleteButton.onclick = (e) => {
                    e.stopPropagation();
                    deleteRoute(index);
                };
                
                const routeItem = document.createElement('div');
                routeItem.className = 'saved-route-item';
                routeItem.appendChild(routeButton);
                routeItem.appendChild(deleteButton);
                
                routesContainer.appendChild(routeItem);
            });
        }

        // 노선 삭제 함수
        function deleteRoute(index) {
            const savedRoutes = JSON.parse(loadFromLocalStorage('savedRoutes') || '[]');
            const route = savedRoutes[index];
            
            if (confirm(`"${route.name}" 노선을 삭제하시겠습니까?`)) {
                savedRoutes.splice(index, 1);
                saveToLocalStorage('savedRoutes', JSON.stringify(savedRoutes));
                updateSavedRoutesDisplay();
                alert(`"${route.name}" 노선이 삭제되었습니다.`);
            }
        }

        // 자동 초기화 이벤트 제거 - 모바일과 컴퓨터 동일하게 처리
        // 수동 초기화만 가능 ("정류장 명수 초기화" 버튼)
        
        /*
        // 페이지 가시성 변경 이벤트 (모바일에서만 작동)
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible' && !isSharing && isMobileDevice()) {
                // 모바일에서만 공유 중이 아닐 때 오후 카운팅 초기화 (오전 카운팅 보존)
                console.log('모바일에서 페이지가 다시 보이게 됨 - 오후 카운팅 초기화');
                resetAllCounts();
            }
        });

        // 페이지 포커스 이벤트 (모바일에서만 작동)
        window.addEventListener('focus', function() {
            if (!isSharing && isMobileDevice()) {
                console.log('모바일에서 페이지 포커스 - 오후 카운팅 초기화');
                resetAllCounts();
            }
        });

        // 페이지 언로드 전 이벤트 (모바일에서만 작동)
        window.addEventListener('beforeunload', function() {
            if (!isSharing && isMobileDevice()) {
                console.log('모바일에서 페이지 언로드 - 오후 카운팅 초기화');
                resetAllCounts();
            }
        });
        */
        
        // 화면 자동 꺼짐 방지 기능
        let noSleep = null;
        let wakeLock = null;

        function enableScreenWakeLock() {
            try {
                // No Sleep 라이브러리 사용 (더 넓은 브라우저 지원)
                if (typeof NoSleep !== 'undefined') {
                    noSleep = new NoSleep();
                    noSleep.enable();
                    console.log('No Sleep 라이브러리로 화면 자동 꺼짐 방지 활성화');
                }

                // Screen Wake Lock API 사용 (최신 브라우저)
                if ('wakeLock' in navigator) {
                    navigator.wakeLock.request('screen').then(lock => {
                        wakeLock = lock;
                        console.log('Screen Wake Lock API로 화면 자동 꺼짐 방지 활성화');
                        
                        // 화면이 꺼졌을 때 다시 활성화
                        lock.addEventListener('release', () => {
                            console.log('화면이 꺼졌습니다. 다시 활성화 시도...');
                            setTimeout(() => {
                                enableScreenWakeLock();
                            }, 1000);
                        });
                    }).catch(err => {
                        console.log('Screen Wake Lock API 실패:', err);
                    });
                }

                // 사용자 상호작용이 필요한 경우를 대비한 이벤트 리스너
                document.addEventListener('click', enableScreenWakeLock, { once: true });
                document.addEventListener('touchstart', enableScreenWakeLock, { once: true });
                
            } catch (error) {
                console.log('화면 자동 꺼짐 방지 설정 실패:', error);
            }
        }

        function disableScreenWakeLock() {
            try {
                if (noSleep) {
                    noSleep.disable();
                    noSleep = null;
                    console.log('No Sleep 라이브러리 비활성화');
                }
                if (wakeLock) {
                    wakeLock.release();
                    wakeLock = null;
                    console.log('Screen Wake Lock API 비활성화');
                }
            } catch (error) {
                console.log('화면 자동 꺼짐 방지 해제 실패:', error);
            }
        }
        
        // PWA 설치 및 서비스 워커 등록
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('서비스 워커 등록 성공:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('서비스 워커 등록 실패:', error);
                    });
                
            // 화면 자동 꺼짐 방지 활성화
            enableScreenWakeLock();

            // 다크모드 버튼 자동 숨김 (5초 후)
            hideThemeButton();
            });
        }

        // ========== 컬리 전용 함수들 ==========
        
        // 컬리 노선 개수 업데이트
        function updateKurlyStationCount() {
            stationCount = parseInt(document.getElementById('kurly-station-count').value) || 0;
            routeName = document.getElementById('kurly-route-name').value.trim();
            document.getElementById('kurly-count-submit').disabled = stationCount <= 0 || routeName === '';
        }

        // 컬리 노선 개수 제출
        function submitKurlyStationCount() {
            stationCount = parseInt(document.getElementById('kurly-station-count').value) || 0;
            routeName = document.getElementById('kurly-route-name').value.trim();
            isLoadedRoute = false; // 새로운 노선임을 표시
            
            if (routeName === '') {
                return;
            }
            
            if (stationCount > 0) {
                // 새로운 노선을 위한 완전 초기화
                stations = Array.from({ length: stationCount }, (_, index) => ({
                    id: index,
                    name: '',
                    count: 0,
                    morningCount: 0,
                    afternoonCount: 0,
                    departureTime: { 
                        morningHour: 8, 
                        morningMinute: 0,
                        afternoonHour: 17, 
                        afternoonMinute: 0
                    }
                }));
                stationNames = new Array(stationCount).fill('');
                stationDepartureTimes = new Array(stationCount).fill({ morningHour: 8, morningMinute: 0, afternoonHour: 17, afternoonMinute: 0 });
                createKurlyStationInputs();
                
                // 페이지 전환
                const kurlyStationCountPage = document.getElementById('kurly-station-count-page');
                const kurlyStationNamesPage = document.getElementById('kurly-station-names-page');
                
                if (kurlyStationCountPage) {
                    kurlyStationCountPage.classList.add('hidden');
                    kurlyStationCountPage.style.display = 'none';
                }
                if (kurlyStationNamesPage) {
                    kurlyStationNamesPage.classList.remove('hidden');
                    kurlyStationNamesPage.style.display = 'block';
                }
                
                // 버튼 상태 업데이트
                document.getElementById('kurly-count-submit').disabled = stationCount <= 0 || routeName === '';
            }
        }

        // 컬리 정류장 이름 입력 필드 생성
        function createKurlyStationInputs() {
            const stationInputs = document.getElementById('kurly-station-inputs');
            stationInputs.innerHTML = '';
            stations.forEach((station, index) => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'station-input-group';
                inputGroup.style.flexDirection = 'column';
                inputGroup.style.alignItems = 'stretch';
                inputGroup.style.gap = '10px';
                inputGroup.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                        <label style="min-width: 100px; text-align: left; font-size: 1.1rem;">정류장 ${index + 1}:</label>
                        <input type="text" class="station-name-input" placeholder="정류장 ${index + 1} 이름" 
                               value="${station.name || ''}" onchange="updateKurlyStationName(${index}, this.value)" lang="ko" ime-mode="active">
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; margin-left: 115px; margin-bottom: 10px;">
                        <input type="number" min="1" max="12" placeholder="시" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.morningHour || 8}" onchange="updateKurlyDepartureTime(${index}, 'morningHour', this.value)">
                        <span style="color: white;">시</span>
                        <input type="number" min="0" max="59" placeholder="분" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.morningMinute || 0}" onchange="updateKurlyDepartureTime(${index}, 'morningMinute', this.value)">
                        <span style="color: white;">분</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; margin-left: 115px;">
                        <input type="number" min="1" max="12" placeholder="시" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.afternoonHour || 17}" onchange="updateKurlyDepartureTime(${index}, 'afternoonHour', this.value)">
                        <span style="color: white;">시</span>
                        <input type="number" min="0" max="59" placeholder="분" style="width: 60px; padding: 8px; border: none; border-radius: 5px; background: rgba(255, 255, 255, 0.9); color: #333; text-align: center;" 
                               value="${station.departureTime.afternoonMinute || 0}" onchange="updateKurlyDepartureTime(${index}, 'afternoonMinute', this.value)">
                        <span style="color: white;">분</span>
                    </div>
                `;
                stationInputs.appendChild(inputGroup);
            });
        }

        // 컬리 정류장 이름 업데이트
        function updateKurlyStationName(index, name) {
            stationNames[index] = name;
            stations[index].name = name;
            
            // 컬리 정류장 이름과 카운팅 데이터를 모두 localStorage에 저장
            localStorage.setItem('kurlySavedStations', JSON.stringify(stations));
            
            checkKurlyAllNamesFilled();
        }

        // 컬리 출발 시간 업데이트
        function updateKurlyDepartureTime(index, type, value) {
            if (!stations[index].departureTime) {
                stations[index].departureTime = { morningHour: 8, morningMinute: 0, afternoonHour: 17, afternoonMinute: 0 };
            }
            
            if (type === 'morningHour') {
                stations[index].departureTime.morningHour = parseInt(value) || 8;
            } else if (type === 'morningMinute') {
                stations[index].departureTime.morningMinute = parseInt(value) || 0;
            } else if (type === 'afternoonHour') {
                stations[index].departureTime.afternoonHour = parseInt(value) || 17;
            } else if (type === 'afternoonMinute') {
                stations[index].departureTime.afternoonMinute = parseInt(value) || 0;
            }
            
            // 컬리 출발 시간을 localStorage에 저장
            const savedDepartureTimes = stations.map(station => station.departureTime);
            localStorage.setItem('kurlySavedDepartureTimes', JSON.stringify(savedDepartureTimes));
        }

        // 컬리 모든 정류장 이름이 입력되었는지 확인
        function checkKurlyAllNamesFilled() {
            const allFilled = stations.every(station => station.name.trim() !== '');
            document.getElementById('kurly-start-counting').disabled = !allFilled;
            document.getElementById('kurly-save-route').disabled = !allFilled;
        }

        // 컬리 카운팅 시작
        function startKurlyCounting() {
            if (stations.every(station => station.name.trim() !== '')) {
                // 도착시간 버튼 인라인 스타일 초기화 (쿠팡에서 설정한 스타일 제거)
                const arrivalTimeRow = document.getElementById('arrival-time-row');
                if (arrivalTimeRow) {
                    arrivalTimeRow.style.display = '';
                    arrivalTimeRow.style.visibility = '';
                    arrivalTimeRow.style.opacity = '';
                    arrivalTimeRow.style.height = '';
                    arrivalTimeRow.style.marginTop = '';
                    arrivalTimeRow.style.marginBottom = '';
                    arrivalTimeRow.style.padding = '';
                    arrivalTimeRow.style.overflow = '';
                }
                
                // 컬리 정류장 개수와 노선이름을 localStorage에 저장
                localStorage.setItem('kurlySavedStationCount', stationCount.toString());
                localStorage.setItem('kurlySavedRouteName', routeName);
                
                // 첫 번째 정류장부터 시작하도록 명시적으로 초기화
                currentStationIndex = 0;
                currentInput = '';
                saveToLocalStorage('kurlyCurrentStationIndex', '0');
                saveToLocalStorage('kurlyCurrentInput', '');
                
                // 완료 상태 및 키패드 비활성화 상태 초기화 (카운팅 시작 시)
                completedTimePeriods = { morning: false, afternoon: false, evening: false };
                saveToLocalStorage('keypadDisabled', 'false');
                saveToLocalStorage('completedTimePeriods', JSON.stringify(completedTimePeriods));
                // 키패드 활성화
                enableKeypad();
                
                console.log(`컬리 카운팅 시작: 정류장 ${currentStationIndex + 1}/${stations.length}부터 시작`);
                
                // 페이지 전환
                const kurlyStationNamesPage = document.getElementById('kurly-station-names-page');
                const keypadPage = document.getElementById('keypad-page');
                
                if (kurlyStationNamesPage) {
                    kurlyStationNamesPage.classList.add('hidden');
                    kurlyStationNamesPage.style.display = 'none';
                }
                if (keypadPage) {
                    keypadPage.classList.remove('hidden');
                    keypadPage.style.display = 'block';
                }
                
                // 키패드 페이지 업데이트
                updateKeypadPage();
                
                // 시간대 버튼 표시/숨김 업데이트
                updateTimePeriodButtons();
                
                // 컬리일 때 도착시간 버튼 초기 상태 설정 (아직 완료되지 않았으므로 숨김)
                if (currentService === 'kurly') {
                    const arrivalTimeRow = document.getElementById('arrival-time-row');
                    if (arrivalTimeRow) {
                        arrivalTimeRow.style.display = 'none';
                        arrivalTimeRow.style.visibility = 'hidden';
                        arrivalTimeRow.style.opacity = '0';
                        arrivalTimeRow.style.height = '0';
                        arrivalTimeRow.style.marginTop = '0';
                        arrivalTimeRow.style.marginBottom = '0';
                    }
                }
                
                // 시계 시작
                updateClock();
                setInterval(updateClock, 1000);
                
                // 시간대 버튼 텍스트 업데이트 (키패드 페이지가 표시된 후)
                setTimeout(() => {
                    updateTimePeriodButtonLabels();
                }, 100);
            }
        }

        // 컬리 노선 저장
        function saveKurlyRoute() {
            if (stations.every(station => station.name.trim() !== '')) {
                const savedRoutes = JSON.parse(localStorage.getItem('kurlySavedRoutes') || '[]');
                const newRoute = {
                    name: routeName,
                    stationCount: stationCount,
                    stations: stations.map(s => ({
                        name: s.name,
                        departureTime: s.departureTime
                    })),
                    departureTimes: stations.map(s => s.departureTime),
                    createdAt: new Date().toISOString()
                };
                
                // 중복 체크
                const existingIndex = savedRoutes.findIndex(r => r.name === routeName);
                if (existingIndex >= 0) {
                    savedRoutes[existingIndex] = newRoute;
                } else {
                    savedRoutes.push(newRoute);
                }
                
                localStorage.setItem('kurlySavedRoutes', JSON.stringify(savedRoutes));
                alert('노선이 저장되었습니다.');
                
                // 저장된 노선 목록 업데이트
                updateKurlySavedRoutesDisplay();
            }
        }

        // 컬리 설정 초기화
        function resetKurlySetup() {
            stationCount = 0;
            stations = [];
            stationNames = [];
            currentStationIndex = 0;
            currentInput = '';
            saveToLocalStorage('kurlyCurrentStationIndex', '0');
            
            document.getElementById('kurly-station-count').value = '';
            document.getElementById('kurly-route-name').value = '';
            document.getElementById('kurly-count-submit').disabled = true;
            
            // 시작 페이지로 돌아가기
            const selectionPage = document.getElementById('selection-page');
            const kurlyStationCountPage = document.getElementById('kurly-station-count-page');
            const kurlyStationNamesPage = document.getElementById('kurly-station-names-page');
            const keypadPage = document.getElementById('keypad-page');
            
            if (selectionPage) {
                selectionPage.classList.remove('hidden');
                selectionPage.style.display = 'flex';
            }
            if (kurlyStationCountPage) {
                kurlyStationCountPage.classList.add('hidden');
                kurlyStationCountPage.style.display = 'none';
            }
            if (kurlyStationNamesPage) {
                kurlyStationNamesPage.classList.add('hidden');
                kurlyStationNamesPage.style.display = 'none';
            }
            if (keypadPage) {
                keypadPage.classList.add('hidden');
                keypadPage.style.display = 'none';
            }
        }

        // 컬리 저장된 노선 목록 표시
        function updateKurlySavedRoutesDisplay() {
            const savedRoutes = JSON.parse(localStorage.getItem('kurlySavedRoutes') || '[]');
            const container = document.getElementById('kurly-saved-routes-container');
            
            if (!container) return;
            
            if (savedRoutes.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; margin: 10px 0;">저장된 노선이 없습니다.</p>';
                return;
            }
            
            container.innerHTML = savedRoutes.map((route, index) => `
                <div class="saved-route-item">
                    <button class="saved-route-btn" onclick="loadKurlyRoute('${route.name}')">
                        ${route.name} (${route.stationCount}개 정류장)
                    </button>
                </div>
            `).join('');
        }

        // 컬리 노선 불러오기
        function loadKurlyRoute(routeName) {
            // 도착시간 버튼 인라인 스타일 초기화 (쿠팡에서 설정한 스타일 제거)
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            if (arrivalTimeRow) {
                arrivalTimeRow.style.display = '';
                arrivalTimeRow.style.visibility = '';
                arrivalTimeRow.style.opacity = '';
                arrivalTimeRow.style.height = '';
                arrivalTimeRow.style.marginTop = '';
                arrivalTimeRow.style.marginBottom = '';
                arrivalTimeRow.style.padding = '';
                arrivalTimeRow.style.overflow = '';
            }
            
            const savedRoutes = JSON.parse(localStorage.getItem('kurlySavedRoutes') || '[]');
            const route = savedRoutes.find(r => r.name === routeName);
            
            if (!route) {
                alert('노선을 찾을 수 없습니다.');
                return;
            }
            
            // 컬리 데이터 복원
            stationCount = route.stationCount;
            routeName = routeName; // 전역 변수 routeName 설정
            window.routeName = routeName;
            // localStorage에도 저장
            localStorage.setItem('kurlySavedRouteName', routeName);
            isLoadedRoute = true;
            
            stations = Array.from({ length: stationCount }, (_, index) => {
                const savedStation = route.stations[index] || {};
                let departureTime = savedStation.departureTime || route.departureTimes[index] || { morningHour: 8, morningMinute: 0, afternoonHour: 17, afternoonMinute: 0 };
                
                // 기존 데이터 호환성 처리
                if (departureTime.minute !== undefined && departureTime.morningMinute === undefined) {
                    departureTime = {
                        morningHour: departureTime.morningHour || 8,
                        morningMinute: departureTime.minute || 0,
                        afternoonHour: departureTime.afternoonHour || 17,
                        afternoonMinute: departureTime.minute || 0
                    };
                }
                
                if (departureTime.morningMinute === undefined) {
                    departureTime.morningMinute = 0;
                }
                if (departureTime.afternoonMinute === undefined) {
                    departureTime.afternoonMinute = 0;
                }
                
                return {
                    id: index,
                    name: savedStation.name || '',
                    count: 0,
                    morningCount: 0,
                    afternoonCount: 0,
                    departureTime: departureTime
                };
            });
            
            stationNames = stations.map(s => s.name);
            stationDepartureTimes = stations.map(s => s.departureTime);
            
            // 컬리 localStorage에 저장
            localStorage.setItem('kurlySavedStations', JSON.stringify(stations));
            localStorage.setItem('kurlySavedStationCount', stationCount.toString());
            localStorage.setItem('kurlySavedRouteName', routeName);
            localStorage.setItem('kurlySavedDepartureTimes', JSON.stringify(stationDepartureTimes));
            
            // 완료 상태 및 키패드 비활성화 상태 초기화 (새로운 노선을 불러올 때)
            completedTimePeriods = { morning: false, afternoon: false, evening: false };
            currentStationIndex = 0;
            currentInput = '';
            saveToLocalStorage('kurlyCurrentStationIndex', '0');
            saveToLocalStorage('kurlyCurrentInput', '');
            saveToLocalStorage('keypadDisabled', 'false');
            saveToLocalStorage('completedTimePeriods', JSON.stringify(completedTimePeriods));
            localStorage.removeItem('morningArrivalTime');
            localStorage.removeItem('afternoonArrivalTime');
            localStorage.removeItem('eveningArrivalTime');
            morningArrivalTime = null;
            afternoonArrivalTime = null;
            eveningArrivalTime = null;
            
            // 정류장 이름 입력 페이지로 이동
            createKurlyStationInputs();
            
            const kurlyStationCountPage = document.getElementById('kurly-station-count-page');
            const kurlyStationNamesPage = document.getElementById('kurly-station-names-page');
            
            if (kurlyStationCountPage) {
                kurlyStationCountPage.classList.add('hidden');
                kurlyStationCountPage.style.display = 'none';
            }
            if (kurlyStationNamesPage) {
                kurlyStationNamesPage.classList.remove('hidden');
                kurlyStationNamesPage.style.display = 'block';
            }
            
           // 정류장 이름이 모두 입력되어 있으면 버튼 활성화
           setTimeout(() => {
               checkKurlyAllNamesFilled();
           }, 100);
           
           // 시간대 버튼 텍스트 업데이트 (정류장 이름 입력 페이지에서도 표시)
           updateTimePeriodButtonLabels();
       }

        // 컬리 정류장 추가
        function addKurlyStation() {
            const newStation = {
                id: stations.length,
                name: '',
                count: 0,
                morningCount: 0,
                afternoonCount: 0,
                departureTime: { 
                    morningHour: 8, 
                    morningMinute: 0,
                    afternoonHour: 17, 
                    afternoonMinute: 0
                }
            };
            
            stations.push(newStation);
            stationNames.push('');
            stationCount = stations.length;
            
            // 정류장 입력 필드 다시 생성
            createKurlyStationInputs();
            
            // 버튼 상태 업데이트
            checkKurlyAllNamesFilled();
        }

        // 컬리 저장된 정류장 정보 복원
        function restoreKurlySavedStations() {
            // 도착시간 버튼 인라인 스타일 초기화 (쿠팡에서 설정한 스타일 제거)
            const arrivalTimeRow = document.getElementById('arrival-time-row');
            if (arrivalTimeRow) {
                arrivalTimeRow.style.display = '';
                arrivalTimeRow.style.visibility = '';
                arrivalTimeRow.style.opacity = '';
                arrivalTimeRow.style.height = '';
                arrivalTimeRow.style.marginTop = '';
                arrivalTimeRow.style.marginBottom = '';
                arrivalTimeRow.style.padding = '';
                arrivalTimeRow.style.overflow = '';
            }
            
            const savedStations = JSON.parse(loadFromLocalStorage('kurlySavedStations') || '[]');
            const savedStationCount = loadFromLocalStorage('kurlySavedStationCount');
            const savedDepartureTimes = JSON.parse(loadFromLocalStorage('kurlySavedDepartureTimes') || '[]');
            const savedRouteName = loadFromLocalStorage('kurlySavedRouteName');
            
            if (savedStationCount && savedStations.length > 0) {
                stationCount = parseInt(savedStationCount);
                routeName = savedRouteName || '';
                
                stations = Array.from({ length: stationCount }, (_, index) => {
                    const savedStation = savedStations[index];
                    const stationName = typeof savedStation === 'string' ? savedStation : (savedStation?.name || '');
                    
                    const savedCount = typeof savedStation === 'object' ? (savedStation?.count || 0) : 0;
                    const savedMorningCount = typeof savedStation === 'object' ? (savedStation?.morningCount || 0) : 0;
                    const savedAfternoonCount = typeof savedStation === 'object' ? (savedStation?.afternoonCount || 0) : 0;
                    
                    // 기존 데이터 호환성 처리
                    let departureTime = savedDepartureTimes[index] || savedStation?.departureTime || {
                        morningHour: 8,
                        morningMinute: 0,
                        afternoonHour: 17,
                        afternoonMinute: 0
                    };
                    
                    // 기존 minute 필드가 있으면 morningMinute와 afternoonMinute로 변환
                    if (departureTime.minute !== undefined && departureTime.morningMinute === undefined) {
                        departureTime.morningMinute = departureTime.minute;
                        departureTime.afternoonMinute = departureTime.minute;
                        delete departureTime.minute;
                    }
                    
                    // morningMinute나 afternoonMinute가 없으면 0으로 설정
                    if (departureTime.morningMinute === undefined) {
                        departureTime.morningMinute = 0;
                    }
                    if (departureTime.afternoonMinute === undefined) {
                        departureTime.afternoonMinute = 0;
                    }
                    
                    return {
                        id: index,
                        name: stationName,
                        count: savedCount,
                        morningCount: savedMorningCount,
                        afternoonCount: savedAfternoonCount,
                        departureTime: departureTime
                    };
                });
                
                stationNames = stations.map(s => s.name);
                stationDepartureTimes = stations.map(s => s.departureTime);
                
                const savedCurrentStationIndex = loadFromLocalStorage('kurlyCurrentStationIndex');
                if (savedCurrentStationIndex !== null && savedCurrentStationIndex !== '') {
                    currentStationIndex = parseInt(savedCurrentStationIndex) || 0;
                } else {
                    currentStationIndex = 0;
                }
                
                const savedCurrentInput = loadFromLocalStorage('kurlyCurrentInput');
                currentInput = savedCurrentInput || '';
                
                // 완료 상태 확인 및 초기화 (모든 카운트가 0이면 완료 상태도 초기화)
                const allCountsZero = stations.every(station => 
                    (station.morningCount || 0) === 0 && 
                    (station.afternoonCount || 0) === 0 && 
                    (station.eveningCount || 0) === 0
                );
                
                if (allCountsZero) {
                    // 모든 카운트가 0이면 완료 상태 초기화
                    completedTimePeriods = { morning: false, afternoon: false, evening: false };
                    saveToLocalStorage('completedTimePeriods', JSON.stringify(completedTimePeriods));
                    saveToLocalStorage('keypadDisabled', 'false');
                    // 키패드 활성화
                    enableKeypad();
                } else {
                    // 카운트가 있으면 저장된 완료 상태 확인
                    const savedCompletedTimePeriods = loadFromLocalStorage('completedTimePeriods');
                    if (savedCompletedTimePeriods) {
                        try {
                            completedTimePeriods = JSON.parse(savedCompletedTimePeriods);
                        } catch (e) {
                            completedTimePeriods = { morning: false, afternoon: false, evening: false };
                        }
                    }
                    
                    // 키패드 비활성화 상태 확인
                    const savedKeypadDisabled = loadFromLocalStorage('keypadDisabled');
                    if (savedKeypadDisabled === 'true') {
                        disableKeypad();
                    } else {
                        enableKeypad();
                    }
                }
                
                updateKeypadPage();
                
                // 시간대 버튼 표시/숨김 업데이트
                updateTimePeriodButtons();
                
                // 시간대 버튼 텍스트 업데이트 (키패드 페이지가 표시된 후)
                setTimeout(() => {
                    updateTimePeriodButtonLabels();
                }, 100);
            }
        }
    </script>
</body>
</html>
</html>